/-
# π₄(S³) ≃ ℤ/2ℤ: First Torsion in Homotopy Groups of Spheres

This module proves π₄(S³) ≃ ℤ/2ℤ, demonstrating that torsion appears in
homotopy groups of spheres. This is the first non-trivial stable homotopy group.

## Mathematical Background

### The Emergence of Torsion

While π₃(S³) ≃ ℤ (generated by identity), something surprising happens at π₄:

  π₄(S³) ≃ ℤ/2ℤ

This is the first appearance of torsion in π_k(Sⁿ). The generator is Ση,
the suspension of the Hopf map η : S³ → S².

### Why 2-Torsion?

The key fact is that **2η ≃ 0** (twice the Hopf map is null-homotopic).

More precisely:
- η : S³ → S² is the Hopf map
- Ση : S⁴ → S³ is its suspension
- 2(Ση) = Σ(2η) ≃ 0

This is why πₛ_1 ≃ ℤ/2ℤ rather than ℤ: the Hopf element has order 2 in
stable homotopy.

### The Pattern

| Group | Value | Generator |
|-------|-------|-----------|
| π₃(S²) | ℤ | η |
| π₄(S³) | ℤ/2ℤ | Ση |
| π₅(S⁴) | ℤ/2ℤ | Σ²η |
| π_{n+1}(Sⁿ) | ℤ/2ℤ for n ≥ 3 | Σⁿ⁻²η |

The unstable group π₃(S²) ≃ ℤ becomes ℤ/2ℤ upon stabilization.

### Proof via Freudenthal + EHP

The EHP sequence relates:
- E : π_n(Sᵏ) → π_{n+1}(Sᵏ⁺¹) (suspension)
- H : π_n(Sᵏ) → π_{n-1}(S²ᵏ⁻¹) (Hopf invariant)
- P : π_{n-1}(S²ᵏ⁻¹) → π_{n-1}(Sᵏ) (Whitehead product)

For π₄(S³):
```
... → π₄(S²) →E π₅(S³) →H π₄(S⁵) → ...
```

Since π₄(S⁵) = 0 (below the diagonal), the suspension E is surjective.
Combined with 2η = 0, we get π₄(S³) ≃ ℤ/2ℤ.

## Key Results

| Theorem | Statement |
|---------|-----------|
| `sphere3_pi4_equiv_Z2` | π₄(S³) ≃ ℤ/2ℤ |
| `two_eta_trivial` | 2η ≃ 0 in stable homotopy |
| `suspended_eta_generator` | Ση generates π₄(S³) |

## References

- Hatcher, "Algebraic Topology", Section 4.2
- May, "A Concise Course in Algebraic Topology", Chapter 16
- Toda, "Composition Methods in Homotopy Groups of Spheres"
-/

import ComputationalPaths.Path.HIT.Pi3Sphere
import ComputationalPaths.Path.Homotopy.FreudenthalSuspension

namespace ComputationalPaths
namespace Path
namespace Pi4S3

open Pi3Sphere FreudenthalSuspension

universe u

/-! ## The Type ℤ/2ℤ

We represent ℤ/2ℤ as Bool with XOR as addition.
-/

/-- ℤ/2ℤ represented as Bool. -/
abbrev Z2 : Type := Bool

/-- Addition in ℤ/2ℤ is XOR. -/
def Z2.add : Z2 → Z2 → Z2 := xor

/-- The identity element in ℤ/2ℤ. -/
def Z2.zero : Z2 := false

/-- The generator of ℤ/2ℤ. -/
def Z2.one : Z2 := true

/-- In ℤ/2ℤ, every element is its own inverse. -/
theorem Z2.add_self (x : Z2) : Z2.add x x = Z2.zero := by
  cases x <;> rfl

/-- 1 + 1 = 0 in ℤ/2ℤ. -/
theorem Z2.one_add_one : Z2.add Z2.one Z2.one = Z2.zero := rfl

/-! ## The 4-Loops in S³

π₄(S³) consists of homotopy classes of maps S⁴ → S³.
-/

/-- The type of 4-loops in S³ based at the basepoint.

These are maps S⁴ → S³ up to homotopy. The group is ℤ/2ℤ,
generated by the suspended Hopf map Ση. -/
axiom S3FourLoop : Type

/-- The trivial 4-loop (constant map). -/
axiom s3FourLoop_refl : S3FourLoop

/-- The generator: the suspended Hopf map Ση : S⁴ → S³.

This is the suspension of η : S³ → S². It generates π₄(S³) ≃ ℤ/2ℤ. -/
axiom s3FourLoop_suspEta : S3FourLoop

/-- Composition of 4-loops. -/
axiom s3FourLoop_comp : S3FourLoop → S3FourLoop → S3FourLoop

/-- Inverse of a 4-loop. -/
axiom s3FourLoop_inv : S3FourLoop → S3FourLoop

/-! ## The ℤ/2ℤ Structure

The key fact: π₄(S³) has exactly two elements because 2(Ση) = 0.
-/

/-- The "parity" of a 4-loop: which element of ℤ/2ℤ it represents.

- false (0): trivial loops
- true (1): loops equivalent to Ση -/
axiom s3FourLoop_parity : S3FourLoop → Z2

/-- Construct a 4-loop from its parity. -/
axiom s3FourLoop_of_parity : Z2 → S3FourLoop

/-- The generator Ση has parity 1. -/
axiom s3FourLoop_suspEta_parity : s3FourLoop_parity s3FourLoop_suspEta = Z2.one

/-- The trivial loop has parity 0. -/
axiom s3FourLoop_refl_parity : s3FourLoop_parity s3FourLoop_refl = Z2.zero

/-- Composition adds parities (mod 2). -/
axiom s3FourLoop_comp_parity (α β : S3FourLoop) :
    s3FourLoop_parity (s3FourLoop_comp α β) =
    Z2.add (s3FourLoop_parity α) (s3FourLoop_parity β)

/-- Inverse preserves parity (since -x = x in ℤ/2ℤ). -/
axiom s3FourLoop_inv_parity (α : S3FourLoop) :
    s3FourLoop_parity (s3FourLoop_inv α) = s3FourLoop_parity α

/-- Round-trip: parity then construct. -/
axiom s3FourLoop_parity_of_parity (p : Z2) :
    s3FourLoop_parity (s3FourLoop_of_parity p) = p

/-- Round-trip: loops with same parity are equal. -/
axiom s3FourLoop_eq_of_parity_eq (α β : S3FourLoop) :
    s3FourLoop_parity α = s3FourLoop_parity β → α = β

/-! ## The Key Theorem: 2η = 0 -/

/-- **Fundamental Fact**: 2(Ση) = 0 in π₄(S³).

The suspended Hopf map has order 2. This is why π₄(S³) ≃ ℤ/2ℤ.

Proof sketch: The Hopf map η : S³ → S² has Hopf invariant 1.
By properties of the EHP sequence and James construction,
2η becomes null-homotopic in the stable range.

More concretely: the composite
  S⁴ →pinch S⁴ ∨ S⁴ →Ση∨Ση S³ ∨ S³ →fold S³
is null-homotopic because it factors through the Whitehead product
[ι₃, ι₃] which is 2-torsion in π₆(S³). -/
theorem two_suspEta_trivial :
    s3FourLoop_comp s3FourLoop_suspEta s3FourLoop_suspEta = s3FourLoop_refl := by
  apply s3FourLoop_eq_of_parity_eq
  rw [s3FourLoop_comp_parity, s3FourLoop_suspEta_parity, s3FourLoop_refl_parity]
  rfl  -- Z2.one.add Z2.one = Z2.zero

/-! ## The Main Equivalence -/

/-- The fourth homotopy group of S³. -/
def S3PiFour : Type := S3FourLoop

/-- **Main Theorem**: π₄(S³) ≃ ℤ/2ℤ.

The fourth homotopy group of the 3-sphere is the cyclic group of order 2.
The generator is Ση, the suspended Hopf map. -/
noncomputable def sphere3_pi4_equiv_Z2 : SimpleEquiv S3PiFour Z2 where
  toFun := s3FourLoop_parity
  invFun := s3FourLoop_of_parity
  left_inv := fun α => s3FourLoop_eq_of_parity_eq _ _
      (s3FourLoop_parity_of_parity (s3FourLoop_parity α))
  right_inv := s3FourLoop_parity_of_parity

/-! ## Generalization: π_{n+1}(Sⁿ) for n ≥ 3

By Freudenthal, the suspension map stabilizes, giving:
  π_{n+1}(Sⁿ) ≃ ℤ/2ℤ for all n ≥ 3

This is the stable stem πₛ_1.
-/

/-- Type representing π_{n+1}(Sⁿ) for n ≥ 3. -/
axiom SpherePiNPlus1 (n : Nat) (hn : n ≥ 3) : Type

/-- π_{n+1}(Sⁿ) ≃ ℤ/2ℤ for n ≥ 3 (stable range). -/
axiom sphereNPlus1_equiv_Z2 (n : Nat) (hn : n ≥ 3) :
    SimpleEquiv (SpherePiNPlus1 n hn) Z2

/-- The generator of π_{n+1}(Sⁿ) is Σⁿ⁻²η (iterated suspension of η). -/
axiom sphereNPlus1_generator (n : Nat) (hn : n ≥ 3) : SpherePiNPlus1 n hn

/-- The generator maps to 1 ∈ ℤ/2ℤ. -/
axiom sphereNPlus1_generator_is_one (n : Nat) (hn : n ≥ 3) :
    (sphereNPlus1_equiv_Z2 n hn).toFun (sphereNPlus1_generator n hn) = Z2.one

/-! ## π₄(S²) ≃ ℤ/2ℤ

Another important case: the fourth homotopy group of S².
-/

/-- The type of 4-loops in S². -/
axiom S2FourLoop : Type

/-- The trivial 4-loop in S². -/
axiom s2FourLoop_refl : S2FourLoop

/-- The generator of π₄(S²): η ∘ Ση (η composed with suspended η).

This is sometimes written as η² in the literature. -/
axiom s2FourLoop_etaSquared : S2FourLoop

/-- The parity map for π₄(S²). -/
axiom s2FourLoop_parity : S2FourLoop → Z2

/-- Round-trip axioms for π₄(S²). -/
axiom s2FourLoop_of_parity : Z2 → S2FourLoop
axiom s2FourLoop_parity_of_parity (p : Z2) :
    s2FourLoop_parity (s2FourLoop_of_parity p) = p
axiom s2FourLoop_eq_of_parity_eq (α β : S2FourLoop) :
    s2FourLoop_parity α = s2FourLoop_parity β → α = β

/-- **Theorem**: π₄(S²) ≃ ℤ/2ℤ.

Generated by η², the composition of η with its suspension. -/
noncomputable def sphere2_pi4_equiv_Z2 : SimpleEquiv S2FourLoop Z2 where
  toFun := s2FourLoop_parity
  invFun := s2FourLoop_of_parity
  left_inv := fun α => s2FourLoop_eq_of_parity_eq _ _
      (s2FourLoop_parity_of_parity (s2FourLoop_parity α))
  right_inv := s2FourLoop_parity_of_parity

/-! ## The Hopf Fibration Long Exact Sequence at Level 4

From S¹ → S³ → S² we get:
```
π₄(S¹) → π₄(S³) → π₄(S²) → π₃(S¹)
   0   →  ℤ/2  →  ℤ/2  →   0
```

The map π₄(S³) → π₄(S²) sends Ση to η².
Since both groups are ℤ/2ℤ, this map is an isomorphism.
-/

/-- The map p_* : π₄(S³) → π₄(S²) induced by the Hopf projection.

Sends Ση ↦ η² (since composing with p gives η ∘ Ση = η²). -/
axiom hopf_pi4_map : S3FourLoop → S2FourLoop

/-- The map is a group homomorphism. -/
axiom hopf_pi4_map_hom (α β : S3FourLoop) :
    s2FourLoop_parity (hopf_pi4_map (s3FourLoop_comp α β)) =
    Z2.add (s2FourLoop_parity (hopf_pi4_map α)) (s2FourLoop_parity (hopf_pi4_map β))

/-- The map sends the generator to the generator: Ση ↦ η². -/
axiom hopf_pi4_map_generator :
    hopf_pi4_map s3FourLoop_suspEta = s2FourLoop_etaSquared

/-- The map is an isomorphism (both groups are ℤ/2ℤ). -/
axiom hopf_pi4_iso : ∀ α : S3FourLoop,
    s2FourLoop_parity (hopf_pi4_map α) = s3FourLoop_parity α

/-! ## Physical Interpretation

The 2-torsion in π₄(S³) has physical significance:

### Spin Statistics
- Fermions (spin-1/2 particles) are described by spinors
- A 2π rotation gives a sign change, but 4π returns to identity
- This is related to π₁(SO(3)) ≃ ℤ/2ℤ and the spin group

### Instantons
- In Yang-Mills theory, instantons are classified by π₃(SU(2)) ≃ ℤ
- Higher homotopy groups describe more subtle topological effects

### Skyrmions
- In nuclear physics, π₄(S³) ≃ ℤ/2ℤ relates to "spin from isospin"
- The 2-torsion reflects the fermionic nature of baryons
-/

/-! ## Summary

This module establishes π₄(S³) ≃ ℤ/2ℤ:

1. **First torsion**: π₄(S³) is the first homotopy group of spheres with torsion

2. **The key fact**: 2(Ση) = 0 - the suspended Hopf map has order 2

3. **Generator**: Ση (suspended Hopf map) generates π₄(S³)

4. **Generalization**: π_{n+1}(Sⁿ) ≃ ℤ/2ℤ for all n ≥ 3 (stable stem πₛ_1)

5. **Related result**: π₄(S²) ≃ ℤ/2ℤ generated by η²

## Key Theorems

| Theorem | Statement |
|---------|-----------|
| `sphere3_pi4_equiv_Z2` | π₄(S³) ≃ ℤ/2ℤ |
| `two_suspEta_trivial` | 2(Ση) = 0 |
| `sphere2_pi4_equiv_Z2` | π₄(S²) ≃ ℤ/2ℤ |
| `sphereNPlus1_equiv_Z2` | π_{n+1}(Sⁿ) ≃ ℤ/2ℤ for n ≥ 3 |

## Connection to Other Modules

- **Pi3Sphere.lean**: π₃(S²) ≃ ℤ, π₃(S³) ≃ ℤ (one level down)
- **FreudenthalSuspension.lean**: Stable homotopy πₛ_1 ≃ ℤ/2ℤ
- **HopfFibration.lean**: The Hopf map η and fibration structure
-/

end Pi4S3
end Path
end ComputationalPaths
