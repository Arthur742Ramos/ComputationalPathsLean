% !TEX program = pdflatex
% Computational Paths as Proof-Relevant Equality
% Target venue: LICS / POPL / ITP
\documentclass[acmsmall,screen,review]{acmart}

% ── packages ──────────────────────────────────────────────────────────
\usepackage{amsmath,amssymb,amsthm}
\usepackage{mathpartir}
\usepackage{stmaryrd}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{url}
\usepackage{hyperref}
\usepackage{tikz-cd}
\usepackage{enumitem}

% ── theorem environments ──────────────────────────────────────────────
\newtheorem{proposition}[theorem]{Proposition}

% ── macros ────────────────────────────────────────────────────────────
\newcommand{\Path}{\mathsf{Path}}
\newcommand{\Step}{\mathsf{Step}}
\newcommand{\RwEq}{\mathsf{RwEq}}
\newcommand{\Rw}{\mathsf{Rw}}
\newcommand{\Deriv}[1]{\mathsf{Derivation}_{#1}}
\newcommand{\refl}{\mathsf{refl}}
\newcommand{\sym}{\mathsf{symm}}
\newcommand{\trs}{\mathsf{trans}}
\newcommand{\cmpA}{\mathbin{\cdot}}
\newcommand{\invA}{\mathord{(\text{--})}^{-1}}
\newcommand{\wl}{\mathbin{\triangleright}}
\newcommand{\wr}{\mathbin{\triangleleft}}
\newcommand{\hcomp}{\mathbin{\star}}
\newcommand{\vcomp}{\mathbin{\bullet}}
\newcommand{\Ty}{\mathsf{Type}}
\newcommand{\Prop}{\mathsf{Prop}}
\newcommand{\Lean}{\textsc{Lean\,4}}
\newcommand{\ogrpd}{\omega\text{-}\mathsf{Gpd}}
\newcommand{\UIP}{\mathsf{UIP}}
\newcommand{\Eq}{\mathsf{Eq}}

% ── listings ──────────────────────────────────────────────────────────
\lstset{
  language=,
  basicstyle=\ttfamily\small,
  keywordstyle=\bfseries\color{blue!70!black},
  commentstyle=\itshape\color{green!50!black},
  columns=flexible,
  keepspaces=true,
  mathescape=true,
  literate={→}{$\to$}1 {←}{$\leftarrow$}1 {∀}{$\forall$}1 {∃}{$\exists$}1
           {α}{$\alpha$}1 {β}{$\beta$}1 {γ}{$\gamma$}1 {ω}{$\omega$}1
           {≃}{$\simeq$}1 {⟨}{$\langle$}1 {⟩}{$\rangle$}1
}

% ── metadata ──────────────────────────────────────────────────────────
\title{Computational Paths as Proof-Relevant Equality:\\
  Confluence, Coherence, and Weak $\omega$-Groupoids}

\author{Arthur Ramos}
\affiliation{%
  \institution{Universidade Federal da Para\'iba}
  \country{Brazil}}
\email{arthur@ci.ufpb.br}

\begin{document}

\begin{abstract}
We present a comprehensive Lean~4 formalization of \emph{computational paths}:
a proof-relevant framework for propositional equality in which different
derivations of the same equation carry distinct computational content.
The framework is organized around three layers:
(1) a \emph{Path/Step} rewrite system whose symmetric--transitive closure
$\RwEq$ lives in $\Ty\;u$ (not $\Prop$), preserving proof relevance;
(2) explicit \emph{coherence} data---pentagon, triangle, interchange, and
Eckmann--Hilton---established through $\Step$ chains and $\RwEq$ witnesses; and
(3) a \emph{weak $\omega$-groupoid} structure in the sense of
Batanin--Leinster, where contractibility at dimensions $\ge 3$ is
\emph{derived} from Church--Rosser confluence rather than postulated.
We additionally formalize a Seifert--van Kampen theorem at the path level,
a partial univalence principle for 1-types, and a strict 2-category instance
with Godement interchange.
The entire development comprises over 150 Lean~4 modules and ${\sim}45{,}000$
lines of code.  We discuss the design trade-offs of working in a
proof-irrelevant kernel while maintaining proof-relevant rewrite traces,
and compare our approach with HoTT identity types and Squier's homotopical
algebra of rewriting.
\end{abstract}

\keywords{computational paths, proof relevance, weak $\omega$-groupoids,
  confluence, coherence, Lean~4 formalization}

\maketitle

% ======================================================================
\section{Introduction}\label{sec:intro}
% ======================================================================

The identity type of Martin-L\"of type theory has two complementary
readings.  In the \emph{intensional} reading, typified by Homotopy Type
Theory (HoTT)~\cite{UFP2013}, the identity type $\mathsf{Id}_A(a,b)$ is
a rich higher-dimensional structure: its elements are paths, paths between
paths form homotopies, and the resulting tower gives every type the
structure of a weak $\omega$-groupoid~\cite{Lumsdaine2010,vdBG2011}.
In the \emph{extensional} reading---and in proof assistants such as
Lean~4 and Coq whose kernels validate UIP---propositional equalities are
proof-irrelevant: any two proofs of $a = b$ are themselves equal.

The theory of \emph{computational paths}, introduced by de~Queiroz and
de~Oliveira~\cite{deQueiroz1994,deQueirozGabbay1994,RQGO2016} and
developed by Ramos et al.~\cite{RamosQueiroz2022,RamosQueiroz2024},
pursues a third option.  We work inside a proof-irrelevant kernel
(Lean~4's $\Eq$), but we \emph{record} the sequence of rewrite steps
that produces an equality as metadata.  The resulting structure---the
\emph{rewrite equivalence} $\RwEq$---is valued in $\Ty\;u$ rather than
$\Prop$, so different derivations are distinguishable even though the
underlying equalities are not.  This design gives us proof relevance
\emph{where it matters} (at the level of rewrite traces) while retaining
full compatibility with the classical metatheory of Lean~4.

\paragraph{Contributions.}
This paper presents the first comprehensive account of a large-scale
Lean~4 formalization of computational paths.  Our main results are:

\begin{enumerate}[label=(\roman*),nosep]
\item A \textbf{Path/Step/RwEq framework} (\S\ref{sec:framework}) in
  which $\RwEq : \Path\;a\;b \to \Path\;a\;b \to \Ty\;u$ is the
  proof-relevant symmetric--transitive closure of rewrite steps.

\item \textbf{Explicit coherence} (\S\ref{sec:coherence}): pentagon,
  triangle, interchange, and inverse-cancellation witnesses constructed
  as $\Step$ chains, together with a proof of the Eckmann--Hilton
  theorem for 2-path loops.

\item A \textbf{strict 2-category instance} (\S\ref{sec:twocat}) with
  Godement horizontal composition, whiskering naturality, and the
  interchange law.

\item A \textbf{weak $\omega$-groupoid theorem}
  (\S\ref{sec:omega}) in the Batanin--Leinster sense, where
  contractibility at dimension $\ge 3$ is \emph{derived} from
  Church--Rosser confluence of the rewrite system, not axiomatized.

\item A \textbf{Seifert--van Kampen theorem} at the computational-path
  level (\S\ref{sec:svk}).

\item A \textbf{partial univalence principle} for 1-types
  (\S\ref{sec:univalence}): the map
  $\mathsf{idToEquiv} : \Path\;A\;B \to \mathsf{PathEquiv}\;A\;B$ is
  injective up to $\RwEq$ when types are 1-truncated, while full
  univalence provably fails.

\item An \textbf{Eckmann--Hilton} commutativity proof
  (\S\ref{sec:coherence}) via the interchange law on 2-cells.
\end{enumerate}

\noindent
The full formalization is available at
\url{https://github.com/Arthur742Ramos/ComputationalPathsLean}.

\paragraph{Proof relevance vs.\ UIP.}
A potential concern is whether our use of $\RwEq : \Ty\;u$ is
undermined by Lean~4's proof irrelevance.  It is not.
$\mathsf{Subsingleton.elim}$ applies only to inhabitants of
$\mathsf{Prop}$; since $\RwEq$ is defined as an inductive family in
$\Ty\;u$, the kernel never identifies distinct $\RwEq$ witnesses.
UIP acts only on Lean's built-in $\Eq$ (which lives in $\Prop$),
and we exploit this \emph{deliberately}: coherence proofs at the
2-path level (equalities between equalities of $\Path$ values) are
proof-irrelevant because they are propositions, while the $\RwEq$
witnesses connecting distinct paths are proof-relevant because they
live in $\Ty$.

% ======================================================================
\section{The Path/Step/RwEq Framework}\label{sec:framework}
% ======================================================================

\subsection{Paths and Steps}

Let $A : \Ty\;u$.  A \emph{computational path} from $a$ to $b$ in $A$
is a pair consisting of a propositional equality $a = b$ (living in
$\Prop$) and a list of elementary rewrite steps (living in $\Ty$):

\begin{lstlisting}
structure Path {A : Type u} (a b : A) where
  steps : List (Step A)
  proof : a = b
\end{lstlisting}

\noindent
An \emph{elementary step} records a source, target, and justifying
equality:

\begin{lstlisting}
structure Step (A : Type u) where
  src : A
  tgt : A
  proof : src = tgt
\end{lstlisting}

\noindent
The key design decision is the separation of concerns: the
\texttt{proof} field provides semantic correctness (sound with respect
to Lean's kernel), while the \texttt{steps} list is a computational
trace that carries intensional information about \emph{how} the
equality was derived.

\begin{definition}[Path operations]
The following operations are defined by structural recursion on step
lists:
\begin{align*}
  \refl(a) &\triangleq (\texttt{[]},\, \mathsf{rfl}) \\
  \trs(p, q) &\triangleq (p.\mathit{steps} \mathbin{+\!+} q.\mathit{steps},\,
    p.\mathit{proof}.\mathsf{trans}\; q.\mathit{proof}) \\
  \sym(p) &\triangleq (p.\mathit{steps}.\mathsf{reverse}.\mathsf{map}\;\Step.\sym,\,
    p.\mathit{proof}.\mathsf{symm})
\end{align*}
\end{definition}

\begin{theorem}[Weak groupoid laws on $\Path$]\label{thm:weak-groupoid-laws}
The following hold as definitional equalities on step lists (and hence as
propositional equalities on $\Path$ values):
\begin{enumerate}[nosep]
  \item $\trs(\refl(a),\, p) = p$ \quad (left unit)
  \item $\trs(p,\, \refl(b)) = p$ \quad (right unit)
  \item $\trs(\trs(p,q),r) = \trs(p,\trs(q,r))$ \quad (associativity)
  \item $\sym(\sym(p)) = p$ \quad (involution)
\end{enumerate}
\end{theorem}

\begin{proof}
Each reduces to list identities: \texttt{[] ++ xs = xs},
\texttt{xs ++ [] = xs}, associativity of \texttt{++}, and the
involution $\Step.\sym \circ \Step.\sym = \mathsf{id}$.
\end{proof}

\subsection{Rewrite Steps and Rewrite Equivalence}

The 1-dimensional rewrite system operates on $\Path$ values.
A \emph{rewrite step} $\Step\;p\;q$ (at the level of paths) witnesses
that $p$ can be rewritten to~$q$ by a single rule application---for
instance, $\beta$-reduction, $\eta$-expansion, or an associativity
rewrite.

\begin{definition}[Rewrite equivalence $\RwEq$]
The \emph{rewrite equivalence} is the smallest Type-valued relation
containing elementary steps and closed under reflexivity, symmetry,
and transitivity:
\begin{lstlisting}
inductive RwEq {A : Type u} {a b : A} :
    Path a b $\to$ Path a b $\to$ Type u
  | refl (p : Path a b) : RwEq p p
  | step {p q} : Step p q $\to$ RwEq p q
  | symm {p q} : RwEq p q $\to$ RwEq q p
  | trans {p q r} : RwEq p q $\to$ RwEq q r $\to$ RwEq p r
\end{lstlisting}
\end{definition}

\noindent
\textbf{Crucially}, $\RwEq$ is an inductive family in $\Ty\;u$, not in
$\Prop$.  This means that two distinct sequences of rewrite steps
connecting the same pair of paths yield \emph{distinguishable}
$\RwEq$ witnesses.  Lean's $\mathsf{Subsingleton.elim}$ cannot
collapse them, because it applies only to types in $\Prop$.

For interfacing with $\mathsf{Setoid}$ and quotient machinery (which
require $\Prop$-valued relations), we define the \emph{propositional
wrapper}:
\[
  \mathsf{RwEqProp}\;p\;q \;\triangleq\; \mathsf{Nonempty}(\RwEq\;p\;q)
  \;:\; \Prop
\]
This deliberate two-level design---$\RwEq$ in $\Ty$ for proof-relevant
reasoning, $\mathsf{RwEqProp}$ in $\Prop$ for quotient
construction---is the central architectural choice of the formalization.

\subsection{Congruence and Functoriality}

$\RwEq$ is a congruence with respect to path operations:

\begin{proposition}[Bifunctoriality of $\trs$]\label{prop:congr}
If $\RwEq\;p\;p'$ and $\RwEq\;q\;q'$, then
$\RwEq\;(\trs\;p\;q)\;(\trs\;p'\;q')$.
\end{proposition}

\noindent
This is established by two lemmas \texttt{rweq\_trans\_congr\_left} and
\texttt{rweq\_trans\_congr\_right}, combined as
\texttt{rweq\_trans\_congr}.  The proof proceeds by induction on the
$\RwEq$ derivation, lifting each $\Step$ through the congruence
combinators $\Step.\mathsf{trans\_congr\_left}$ and
$\Step.\mathsf{trans\_congr\_right}$.

\subsection{Confluence and Church--Rosser}

The rewrite-engineering layer is formalized in
\texttt{GroupoidConfluence.lean}, where expressions are interpreted into a
free-group normal form via \texttt{toRW}.  Two technical ingredients are
central: (i) \texttt{toRW\_invariant}, showing each rewrite step preserves
the interpretation, and (ii) \texttt{reach\_canon}, showing every
expression reaches the canonical normal form \texttt{canon}.  Together they
yield confluence and Church--Rosser, which are then used in
\S\ref{sec:omega} to derive high-dimensional contractibility
(Theorem~\ref{thm:contract}) and in \S\ref{sec:svk} to control loop normal
forms in pushout decompositions.

\begin{theorem}[Confluence of the completed groupoid TRS]\label{thm:groupoid-confluence}
Let \texttt{Expr} be the path-expression syntax and \texttt{CRTC} the
reflexive--transitive closure of completed rewrite steps \texttt{CStep}.  For
all expressions $a,b,c$:
\[
  \mathsf{CRTC}(a,b)\;\wedge\;\mathsf{CRTC}(a,c)
  \;\Longrightarrow\;
  \exists d,\;\mathsf{CRTC}(b,d)\;\wedge\;\mathsf{CRTC}(c,d).
\]
In Lean this is theorem \texttt{confluence} in
\texttt{Path/Rewrite/GroupoidConfluence.lean}.
\end{theorem}

\begin{proof}[Proof idea]
Interpret every expression $e$ as a reduced word $\mathsf{toRW}(e)$ in the
free group.  The theorem \texttt{toRW\_invariant} proves each rewrite step
preserves that interpretation; therefore any two descendants $b,c$ of $a$
have equal free-group image.  The theorem \texttt{reach\_canon} sends both
$b$ and $c$ to a common canonical representative
$\mathsf{canon}(b)=\mathsf{canon}(c)$, yielding the join.
\end{proof}

\begin{theorem}[Church--Rosser via free-group interpretation]\label{thm:groupoid-church-rosser}
For expressions $e_1,e_2$, if $\mathsf{toRW}(e_1)=\mathsf{toRW}(e_2)$ then
there exists $d$ such that
\[
  \mathsf{CRTC}(e_1,d)\;\wedge\;\mathsf{CRTC}(e_2,d).
\]
Equivalently, semantic equality in the free-group model implies syntactic
joinability.  In Lean this is theorem \texttt{church\_rosser} in
\texttt{GroupoidConfluence.lean}.
\end{theorem}

\begin{proof}[Proof idea]
Both expressions reduce to their canonical form: $e_i \to^\ast
\mathsf{canon}(e_i)$.  If \texttt{toRW} values agree, the canonical forms
are definitionally equal by construction of \texttt{canon}.  Taking that
common normal form as $d$ gives a Church--Rosser witness.  The
\texttt{church\_rosser\_explicit} variant additionally records reduction
lengths, used in resource-sensitive normalization arguments.
\end{proof}

% ======================================================================
\section{Coherence}\label{sec:coherence}
% ======================================================================

The coherence laws of higher category theory---pentagon, triangle,
interchange---are proved as explicit $\RwEq$ witnesses rather than
by appeal to proof irrelevance.

\subsection{The Associator and the Pentagon}

The associator is implemented by explicit step chains, not by a
meta-level conversion rule.  Concretely, the route combinators
\texttt{pentagon\_right\_route} and \texttt{pentagon\_left\_route} in
\texttt{OmegaGroupoid/GroupoidProofs.lean} witness the two Mac Lane paths.
This section connects those concrete witnesses with the global coherence
narrative used later in \S\ref{sec:twocat} and \S\ref{sec:omega}.

\begin{definition}[Associator]
For composable paths $p, q, r$:
\[
  \alpha_{p,q,r} : \RwEq\;\big(\trs(\trs(p,q),r)\big)\;\big(\trs(p,\trs(q,r))\big)
\]
constructed via the rewrite step \texttt{rweq\_tt} corresponding to
list associativity.
\end{definition}

\begin{theorem}[Pentagon coherence]\label{thm:pentagon}
For four composable paths $p, q, r, s$, the two canonical routes from
$((p \cmpA q) \cmpA r) \cmpA s$ to $p \cmpA (q \cmpA (r \cmpA s))$
yield the same underlying equality:
\[
  \mathsf{rweq\_toEq}(\text{left route}) =
  \mathsf{rweq\_toEq}(\text{right route}).
\]
\end{theorem}

\begin{proof}
This is theorem \texttt{pentagon\_coherence}.  Both sides are equalities in
$\Prop$ after applying \texttt{rweq\_toEq}; hence proof irrelevance closes
the target proposition while preserving distinct intensional witnesses before
projection.
\end{proof}

\begin{theorem}[Mac Lane coherence (fivefold reassociation)]\label{thm:mac-lane-coherence}
For composable paths $p,q,r,s,t$, every parenthesization of the fivefold
composite $p\cmpA q\cmpA r\cmpA s\cmpA t$ is connected to the fully
right-associated form by a canonical $\RwEq$ witness, and all such routes
induce the same underlying equality in $\Eq$.
In Lean this is realized by \texttt{mac\_lane\_coherence} in
\texttt{MonoidalCoherence.lean}.
\end{theorem}

\begin{proof}[Proof sketch]
The explicit witness \texttt{rweq\_mac\_lane\_five\_split} composes
instances of associativity (\texttt{rweq\_tt}) and congruence
(\texttt{rweq\_trans\_congr\_left/right}).  Equality of alternate route
projections follows exactly as in Theorem~\ref{thm:pentagon}.  This theorem is
the coherence bridge used by the strict/weak interface in
Section~\ref{sec:twocat}.
\end{proof}

\subsection{Interchange and Eckmann--Hilton}

Two-cells admit both vertical and horizontal composition.  In the
computational-path presentation, horizontal composition is implemented via
whiskering (\texttt{trans\_congr\_left/right}), and the interchange law is a
compatibility statement between whiskering orders.

\begin{theorem}[Interchange]\label{thm:interchange}
For 2-cells $\alpha_1, \alpha_2, \beta_1, \beta_2$:
\[
  (\alpha_1 \vcomp \alpha_2) \hcomp (\beta_1 \vcomp \beta_2)
  = (\alpha_1 \hcomp \beta_1) \vcomp (\alpha_2 \hcomp \beta_2).
\]
\end{theorem}

\noindent
At the propositional wrapper level (\texttt{RwEqProp}), this equality is
propositional; at the raw \texttt{RwEq} level, the corresponding witness
families are exposed as \texttt{godement\_left/right} and
\texttt{interchange\_hv/vh} in \texttt{TwoCategoryStructure.lean}.

\begin{corollary}[Eckmann--Hilton]\label{cor:EH}
For any element $a : A$, the monoid of 2-cells
$\mathsf{LoopTwoCell}(a) = \mathsf{TwoCell}(\refl\;a,\,\refl\;a)$
is commutative:
\[
  \alpha \vcomp \beta = \beta \vcomp \alpha.
\]
\end{corollary}

\begin{theorem}[Eckmann--Hilton commutativity, formal route statement]\label{thm:eckmann-hilton-commutativity}
Let $\alpha,\beta : \mathsf{LoopTwoCell}(a)$.  The commutativity equality is
obtained by the composite:
\[
  \alpha \vcomp \beta
  \xRightarrow[\text{unitors}]{}\;
  \alpha \hcomp \beta
  \xRightarrow[\text{interchange}]{}\;
  \beta \hcomp \alpha
  \xRightarrow[\text{unitors}]{}\;
  \beta \vcomp \alpha.
\]
In Lean this is instantiated by \texttt{eckmann\_hilton\_two\_cells} in
\texttt{OmegaGroupoid/CoherencePaths.lean}.
\end{theorem}

\begin{proof}[Proof sketch]
The key input is Theorem~\ref{thm:interchange}; unitors identify horizontal
and vertical composition on endo-2-cells.  The computational-path
formalization records this as explicit route equalities before collapsing to
the extensional equality in $\Prop$.
\end{proof}

\subsection{Unit, Inverse, and Naturality Coherence}

This is the part that was previously too terse.  We now state the exact formal
laws implemented in \texttt{GroupoidProofs.lean},
\texttt{CoherenceDerived.lean}, and
\texttt{OmegaGroupoid/TwoCategoryStructure.lean}.

\begin{proposition}[Left unit law]\label{prop:left-unit-law}
For composable $p : \Path\,a\,b$ and $q : \Path\,b\,c$:
\[
  \RwEq\!\big(\trs(\trs(\refl\,a,p),q),\;\trs(p,q)\big).
\]
This is \texttt{rweq\_left\_unit\_coherence}.
\end{proposition}

\begin{proposition}[Right unit law]\label{prop:right-unit-law}
For composable $p : \Path\,a\,b$ and $q : \Path\,b\,c$:
\[
  \RwEq\!\big(\trs(\trs(p,\refl\,b),q),\;\trs(p,q)\big).
\]
This is \texttt{rweq\_right\_unit\_coherence}.
\end{proposition}

\begin{theorem}[Triangle coherence]\label{thm:triangle-coherence-formal}
For composable $p : \Path\,a\,b$ and $q : \Path\,b\,c$, the two standard
routes from $(p\cmpA \refl(b))\cmpA q$ to $p\cmpA q$ induce the same
underlying equality:
\[
  \mathsf{rweq\_toEq}(\text{triangle left route}) =
  \mathsf{rweq\_toEq}(\text{triangle right route}).
\]
This is theorem \texttt{triangle\_coherence}.
\end{theorem}

\begin{theorem}[Inverse coherence]\label{thm:inverse-coherence}
For every $p : \Path\,a\,b$, the two cancellation routes from
$(p\cmpA p^{-1})\cmpA p$ to $p$ agree after projection:
\[
  \mathsf{rweq\_toEq}(\text{assoc-then-cancel}) =
  \mathsf{rweq\_toEq}(\text{cancel-then-unit}).
\]
This is theorem \texttt{inverse\_coherence}.
\end{theorem}

\begin{theorem}[Double inverse coherence]\label{thm:double-inverse-coherence}
For every $p : \Path\,a\,b$, two rewrite routes reducing
$(p^{-1})^{-1}\cmpA p^{-1}$ to a reflexive path induce the same equality:
\[
  \mathsf{rweq\_toEq}(\text{double\_inv\_route1}) =
  \mathsf{rweq\_toEq}(\text{double\_inv\_route2}).
\]
This is theorem \texttt{double\_inverse\_coherence}.
\end{theorem}

\begin{theorem}[Contravariance coherence]\label{thm:contravariance-coherence}
For composable $p,q,r$, the two decompositions of
$(p\cmpA(q\cmpA r))^{-1}$ to $(r^{-1}\cmpA q^{-1})\cmpA p^{-1}$ yield
equal projected proofs:
\[
  \mathsf{rweq\_toEq}(\text{contravariance route 1}) =
  \mathsf{rweq\_toEq}(\text{contravariance route 2}).
\]
This is theorem \texttt{contravariance\_coherence}.
\end{theorem}

\begin{proposition}[Naturality of associator]\label{prop:associator-naturality}
The associator is natural in at least the first and third variables:
for $\alpha : f \Rightarrow f'$ and $\gamma : h \Rightarrow h'$,
\[
  \mathsf{rweq\_toEq}(\texttt{assoc\_natural\_first\_route1}) =
  \mathsf{rweq\_toEq}(\texttt{assoc\_natural\_first\_route2}),
\]
\[
  \mathsf{rweq\_toEq}(\texttt{assoc\_natural\_third\_route1}) =
  \mathsf{rweq\_toEq}(\texttt{assoc\_natural\_third\_route2}).
\]
These are \texttt{assoc\_natural\_first\_toEq} and
\texttt{assoc\_natural\_third\_toEq}.
\end{proposition}

\begin{proposition}[Naturality of unitors]\label{prop:unitor-naturality}
Whiskering by identities is coherent with unit cancellation:
\[
  \mathsf{rweq\_toEq}(\texttt{whiskerRight\_refl}\;\alpha) =
  \mathsf{rweq\_toEq}(\texttt{whiskerRight\_refl\_factored}\;\alpha),
\]
\[
  \mathsf{rweq\_toEq}(\texttt{whiskerLeft\_refl}\;\beta) =
  \mathsf{rweq\_toEq}(\texttt{whiskerLeft\_refl\_factored}\;\beta).
\]
These are \texttt{whiskerRight\_refl\_coherence} and
\texttt{whiskerLeft\_refl\_coherence}.
\end{proposition}

\noindent
Theorems~\ref{thm:triangle-coherence-formal},
\ref{thm:inverse-coherence}, \ref{thm:double-inverse-coherence}, and
\ref{thm:contravariance-coherence} are precisely the coherence ingredients
used by the strict 2-categorical interface in Section~\ref{sec:twocat}, while
Propositions~\ref{prop:associator-naturality} and
\ref{prop:unitor-naturality} supply the naturality squares needed for
whiskering functoriality.

% ======================================================================
\section{Two-Categorical Structure}\label{sec:twocat}
% ======================================================================

We now make the strict 2-categorical interface explicit.  The implementation
is in \texttt{TwoCategoryInstances.lean} and
\texttt{OmegaGroupoid/TwoCategoryStructure.lean}, and it is linked to the
coherence results of \S\ref{sec:coherence} via whiskering and interchange.

\begin{definition}[Strict 2-category \texttt{EqTwoCat}]
The strict 2-category $\mathcal{C}$ has:
\begin{itemize}[nosep]
  \item 0-cells: types $A : \Ty\;u$
  \item 1-cells: functions $f : A \to B$
  \item 2-cells: $\mathsf{PLift}(f = g) : \Ty\;0$
\end{itemize}
with vertical composition given by transitivity, horizontal composition
(Godement product) by function composition congruence, and the
interchange law by proof irrelevance of $\mathsf{PLift}$.
\end{definition}

\begin{theorem}[Strict 2-category instance \texttt{EqTwoCat}]\label{thm:eqtwocat-instance}
The data \texttt{EqTwoCat} defines an instance of
\texttt{StrictTwoCategory} with:
\[
  \mathrm{Obj}=\Ty\,u,\qquad
  \mathrm{Hom}(A,B)=A\to B,\qquad
  \mathrm{TwoHom}(f,g)=\mathsf{PLift}(f=g),
\]
and satisfies strict associativity/unit laws for 1-cells together with
vertical and horizontal 2-cell compositions.
\end{theorem}

\begin{proof}[Proof sketch]
The Lean definition is \texttt{noncomputable def EqTwoCat}.  Vertical
composition is equality transitivity; horizontal composition is by congruence
of function composition.  The theorems
\texttt{eqTwoCat\_vcomp\_id\_left},
\texttt{eqTwoCat\_vcomp\_id\_right}, and
\texttt{eqTwoCat\_vcomp\_assoc\_explicit} provide explicit unit/associativity
computations, while typeclass instances
\texttt{instHasVcompAssoc\_EqTwoCat},
\texttt{instHasHcompFunctorial\_EqTwoCat}, and
\texttt{instHasInterchange\_EqTwoCat} close the remaining axioms.
\end{proof}

\begin{theorem}[Godement interchange]\label{thm:godement-interchange}
The horizontal composition $\hcomp$ satisfies the interchange law
with vertical composition $\vcomp$:
\[
  (\alpha_1 \vcomp \alpha_2) \hcomp (\beta_1 \vcomp \beta_2) =
  (\alpha_1 \hcomp \beta_1) \vcomp (\alpha_2 \hcomp \beta_2)
\]
\end{theorem}

\begin{proof}
$\mathsf{PLift}(f = g)$ is a subsingleton; any two elements are equal.
\end{proof}

\noindent
Beyond the propositional version above, the computational-path layer carries
explicit route witnesses \texttt{godement\_left}, \texttt{godement\_right},
and \texttt{godement\_interchange\_toEq} (Section~\ref{sec:coherence}).
We additionally verify whiskering naturality:

\begin{proposition}[Whiskering naturality]\label{prop:whisker-nat}
For 2-paths $h : p = p'$ and $k : q = q'$:
\[
  (p \wr k) \cdot (h \wl q') = (h \wl q) \cdot (p' \wr k)
\]
where $\wl$ and $\wr$ denote left and right whiskering.
\end{proposition}

% ======================================================================
\section{The Weak $\omega$-Groupoid Theorem}\label{sec:omega}
% ======================================================================

The central structural result of the formalization is that
computational paths, together with their higher rewrite derivations,
form a weak $\omega$-groupoid in the sense of
Batanin~\cite{Batanin1998} and Leinster~\cite{Leinster2004}.

\subsection{The Cell Tower}

We define a tower of higher cells:

\begin{definition}[Cell tower]
\begin{align*}
  \text{Level 0:} &\quad \text{Elements } a : A \\
  \text{Level 1:} &\quad \Path\;a\;b \\
  \text{Level 2:} &\quad \Deriv{2}\;p\;q \;\triangleq\; \RwEq\;p\;q
    \quad\text{(rewrite derivations)} \\
  \text{Level 3:} &\quad \Deriv{3}\;d_1\;d_2
    \quad\text{(meta-steps between derivations)} \\
  \text{Level 4:} &\quad \Deriv{4}\;m_1\;m_2
    \quad\text{(cells between 3-cells)} \\
  \text{Level } n \ge 5: &\quad \mathsf{DerivationHigh}\;(n-5)\;c_1\;c_2
\end{align*}
\end{definition}

\noindent
Each level carries composition (vertical), identity, and inverses.
Levels 2 and above also carry whiskering (left/right) and horizontal
composition.

\subsection{Contractibility from Confluence}

The key property distinguishing a weak $\omega$-groupoid from a mere
$\omega$-category is \emph{contractibility}: at sufficiently high
dimensions, all parallel cells are connected.

\begin{theorem}[Contractibility at dimension $\ge 3$]\label{thm:contract}
\leavevmode
\begin{enumerate}[nosep]
  \item At level~3: for any parallel $d_1, d_2 : \Deriv{2}\;p\;q$,
    there exists $m : \Deriv{3}\;d_1\;d_2$.
  \item At level~4: for any parallel $m_1, m_2 : \Deriv{3}\;d_1\;d_2$,
    there exists $c : \Deriv{4}\;m_1\;m_2$.
  \item At level $n \ge 5$: contractibility propagates by construction.
\end{enumerate}
\end{theorem}

\begin{proof}
Level~3 contractibility reduces to showing that any two $\RwEq$
witnesses between the same pair of paths are connected by a 3-cell.
The $\RwEq$ type records rewrite derivations; by Church--Rosser
confluence of the underlying rewrite system, any two derivations of the
same rewrite equivalence can be joined.  Concretely, the
\texttt{Join} structure provides:
\begin{lstlisting}
structure Join {A : Type u} {a b : A}
    (p q : Path a b) where
  meet : Path a b
  left : Rw p meet
  right : Rw q meet
\end{lstlisting}
The confluence join, combined with the symmetric closure of $\Rw$,
yields the required 3-cell.  Level~4 and above follow because
$\Deriv{3}$ is defined so that its inhabitants carry propositional
payload ($d_1.\mathsf{toRwEq} = d_2.\mathsf{toRwEq}$, an equality in
$\Prop$), making higher cells automatically contractible by proof
irrelevance.
\end{proof}

\begin{remark}
Contractibility does \emph{not} hold at level~2.  Two parallel paths
$p, q : \Path\;a\;b$ with different step lists may have no rewrite
derivation connecting them.  This is essential: if level~2 were
contractible, all fundamental groups would be trivial, contradicting
e.g.\ $\pi_1(S^1) \cong \mathbb{Z}$.
\end{remark}

\subsection{The $\omega$-Groupoid Data}

Following Batanin~\cite{Batanin1998}, a \emph{weak $\omega$-groupoid}
on a globular set consists of composition, identity, and inverse
operations at each dimension, satisfying associativity and unit laws up
to coherent higher cells, with contractibility ensuring that all
coherence conditions are connected at sufficiently high dimension.

\begin{theorem}[Weak $\omega$-groupoid]\label{thm:omega-gpd}
For any type $A : \Ty\;u$, the cell tower
$\big(A,\, \Path,\, \Deriv{2},\, \Deriv{3},\, \ldots\big)$
carries the structure of a weak $\omega$-groupoid with:
\begin{enumerate}[nosep]
  \item Composition at each level (horizontal/vertical).
  \item Identities and inverses at each level.
  \item Coherence witnesses (pentagon, triangle, interchange) at
    level~2.
  \item Contractibility at levels $\ge 3$ (Theorem~\ref{thm:contract}).
  \item Globular identities: source/target maps commute with all
    structure maps.
\end{enumerate}
\end{theorem}

\noindent
This should be compared with the foundational results of
Lumsdaine~\cite{Lumsdaine2010} and van den Berg--Garner~\cite{vdBG2011},
who showed that the identity types of intensional MLTT form a weak
$\omega$-groupoid.  Our result is an \emph{analogue} in a
proof-irrelevant setting: the $\omega$-groupoid structure lives on the
rewrite system, not on the identity type itself.

\begin{theorem}[1-truncation as \texttt{PathRwQuot}]\label{thm:pathrwquot-truncation}
For each $A : \Ty\,u$ and $a,b : A$, the quotient
\[
  \mathsf{PathRwQuot}\;A\;a\;b \;\coloneqq\;
  \mathsf{Quot}(\mathsf{RwEqProp})
\]
is the 1-truncated hom-space of computational paths: composition, units, and
inverses descend strictly, yielding a strict groupoid
\texttt{StrictGroupoid.quotient A}.  In particular:
\[
  \mathsf{trans\_refl\_left},\;
  \mathsf{trans\_refl\_right},\;
  \mathsf{trans\_symm},\;
  \mathsf{symm\_trans}
\]
hold judgmentally on quotient classes.
\end{theorem}

\begin{proof}[Proof sketch]
The construction is formalized in \texttt{Rewrite/Quot.lean} and
\texttt{Path/Groupoid.lean}.  The operations \texttt{PathRwQuot.trans},
\texttt{PathRwQuot.refl}, and \texttt{PathRwQuot.symm} are defined by nested
\texttt{Quot.lift} calls using congruence lemmas from \S\ref{sec:framework}.
The strict laws are exactly the theorems
\texttt{PathRwQuot.trans\_refl\_left},
\texttt{PathRwQuot.trans\_refl\_right},
\texttt{PathRwQuot.trans\_symm}, and
\texttt{PathRwQuot.symm\_trans}.  This provides the quotient-level algebra
used in Seifert--van Kampen (\S\ref{sec:svk}) and partial univalence
(\S\ref{sec:univalence}).
\end{proof}

% ======================================================================
\section{Seifert--van Kampen}\label{sec:svk}
% ======================================================================

This section now states the theorem in the same formal shape used in the Lean
codebase.  The construction is centered on a pushout diagram
\[
  C \xrightarrow{f} A,\qquad C \xrightarrow{g} B,\qquad
  P \coloneqq \mathsf{Pushout}(A,B,C,f,g),
\]
with basepoint $c_0 : C$ and chosen glue naturality witnesses ensuring that
loops in $C$ map coherently to loops in $A$ and $B$.  The computational
content is an encode--decode pair between:
\begin{enumerate}[nosep]
  \item loops in $\pi_1(P,\mathsf{inl}(f(c_0)))$, represented as
    \texttt{PathRwQuot} classes (\S\ref{sec:omega}, Theorem~\ref{thm:pathrwquot-truncation});
  \item words in the amalgamated free product generated by
    $\pi_1(A,f(c_0))$ and $\pi_1(B,g(c_0))$ modulo relations from
    $\pi_1(C,c_0)$.
\end{enumerate}

\begin{theorem}[Seifert--van Kampen equivalence for pushouts]\label{thm:svk-formal}
Assume the pushout SVK encode/decode interfaces
\texttt{HasPushoutSVKEncodeQuot},
\texttt{HasPushoutSVKDecodeEncode}, and
\texttt{HasPushoutSVKEncodeDecode}.  Then there is a simple equivalence
\[
  \pi_1\!\big(\mathsf{Pushout}(A,B,C,f,g),\mathsf{inl}(f(c_0))\big)
  \;\simeq\;
  \mathsf{AmalgamatedFreeProduct}
  \big(\pi_1(A,f(c_0)),\pi_1(B,g(c_0)),\pi_1(C,c_0)\big),
\]
formalized as \texttt{seifertVanKampenEquiv} in
\texttt{Path/CompPath/PushoutPaths.lean}.
\end{theorem}

\begin{proof}[Proof sketch]
The map \texttt{pushoutEncodeAmalg} sends a loop class in the pushout to an
alternating word of loop classes from $A$ and $B$ with glued boundary
segments from $C$.  The inverse \texttt{pushoutDecodeAmalg} folds such words
back to pushout loops.  The two round-trip obligations are exactly
\texttt{pushoutDecodeEncodeAxiom} and \texttt{pushoutEncodeDecodeAxiom},
proved by quotient induction and compatibility with $\RwEq$.  Confluence
(Theorem~\ref{thm:groupoid-confluence}) guarantees normal-form stability of
rewriting inside each segment before quotienting.
\end{proof}

\paragraph{Full variant and generalized interfaces.}
The file also provides the stronger
\texttt{seifertVanKampenFullEquiv}, where the codomain is a
``full'' amalgamated free product that combines amalgamation with free-group
reduction in one quotient.  A choice-based interface
\texttt{seifertVanKampenFullEquiv\_of\_decodeFullAmalg\_bijective} derives
the same equivalence from Prop-level bijectivity hypotheses alone.

\paragraph{Generalized and wedge specializations.}
\texttt{VanKampenGeneralized.lean} exposes
\texttt{vanKampenGeneralizedEquiv} and an encode-free variant
\texttt{vanKampenGeneralizedEquiv\_of\_decodeAmalg\_bijective}; the
\texttt{Unit}-intersection specialization yields wedge decompositions as
free products.  These specializations are used to connect the abstract SVK
construction to concrete $\pi_1$ computations (circle, figure-eight, torus)
and feed directly into the group-calculation narrative in the larger library.

\paragraph{Relation to coherence and 2-cells.}
SVK relies not only on quotient-level equality but also on coherence of
concatenation and whiskering.  The triangle and inverse laws
(Theorems~\ref{thm:triangle-coherence-formal} and
\ref{thm:inverse-coherence}) are invoked when simplifying decode-composite
loops; associator naturality (Proposition~\ref{prop:associator-naturality})
controls how glued segments reassociate under fold/unfold operations.

% ======================================================================
\section{Partial Univalence}\label{sec:univalence}
% ======================================================================

The univalence axiom of HoTT asserts that the canonical map
$\mathsf{idToEquiv} : (A =_{\mathcal{U}} B) \to (A \simeq B)$ is an
equivalence.  We investigate the computational-paths analog by replacing
identity proofs with explicit computational paths in $\Ty$, then quotienting
only where needed (Theorem~\ref{thm:pathrwquot-truncation}).

\begin{definition}[Path equivalence]
A \emph{path equivalence} $\mathsf{PathEquiv}\;A\;B$ consists of maps
$f : A \to B$ and $g : B \to A$ with path round-trip witnesses
$\forall x,\, \Path\;(g(f(x)))\;x$ and
$\forall y,\, \Path\;(f(g(y)))\;y$.
\end{definition}

\begin{definition}
$\mathsf{idToEquiv}(p) \triangleq$ the path equivalence induced by
transport along~$p$.
\end{definition}

\begin{theorem}[$\mathsf{idToEquiv}$ is well-defined on rewrite classes]\label{thm:idtoequiv-well-defined}
For $p,q : \Path\;A\;B$, if $\RwEq\;p\;q$ then:
\[
  (\mathsf{idToEquiv}(p)).\mathsf{toFun}
  = (\mathsf{idToEquiv}(q)).\mathsf{toFun},
  \qquad
  (\mathsf{idToEquiv}(p)).\mathsf{invFun}
  = (\mathsf{idToEquiv}(q)).\mathsf{invFun}.
\]
In Lean this is the pair of theorems
\texttt{idToEquiv\_toFun\_of\_rweq} and
\texttt{idToEquiv\_invFun\_of\_rweq}, with one-type corollary
\texttt{idToEquiv\_well\_defined\_on\_one\_types}.
\end{theorem}

\begin{proof}[Proof sketch]
Each component is proved by transport compatibility with \texttt{rweq\_toEq}:
if two paths are rewrite-equivalent, they induce definitionally equal
transport maps after forgetting trace metadata.  This is exactly the
bridge from proof-relevant rewrites to extensional function equality.
\end{proof}

\begin{theorem}[Failure of full univalence]\label{thm:no-univalence}
There exist types $A, B$ and distinct paths $p \ne q : \Path\;A\;B$
such that $\mathsf{idToEquiv}(p) = \mathsf{idToEquiv}(q)$ as path
equivalences but $p$ and $q$ are not $\RwEq$-equivalent.
Hence $\mathsf{idToEquiv}$ is not injective (and a fortiori not an
equivalence) in general.
\end{theorem}

\begin{theorem}[Partial univalence for 1-types]\label{thm:partial-ua}
When $A$ and $B$ are 1-truncated (i.e., their path spaces are sets),
the map $\mathsf{idToEquiv}$ is injective up to $\RwEq$.
\end{theorem}

\noindent
This echoes the HoTT situation: univalence holds in full generality
there, but our rewrite-trace framework imposes finer distinctions that
collapse only when higher path structure is trivial.  Combined with
Theorem~\ref{thm:idtoequiv-well-defined}, this yields a precise
``best possible'' statement: $\mathsf{idToEquiv}$ is class-function-like on
rewrite classes, but globally non-univalent by
Theorem~\ref{thm:no-univalence}.

\subsection{Cross-sectional dependency map}\label{sec:dependency-map}

For readability of a large formalization, we summarize how the main theorem
statements depend on one another.  This subsection is intentionally explicit:
it acts as a proof-navigation layer between the abstract narrative and the
Lean file graph.

\paragraph{D1. Rewriting backbone.}
Theorems~\ref{thm:groupoid-confluence} and
\ref{thm:groupoid-church-rosser} provide the normalization/joinability
backbone.  Everything that requires ``coherent comparison of distinct routes''
depends on these two statements, either directly (normal-form comparison) or
indirectly (contractibility at higher dimensions).

\paragraph{D2. Coherence at dimension 2.}
Theorems~\ref{thm:pentagon}, \ref{thm:mac-lane-coherence},
\ref{thm:triangle-coherence-formal}, and \ref{thm:interchange} form the
classical coherence square:
\[
  \text{associativity}\;+\;\text{unit}\;+\;\text{interchange}
  \;\Longrightarrow\; \text{2-dimensional coherence control}.
\]
In our setting, each edge is an explicit \texttt{Step}-chain witness.

\paragraph{D3. Loop-level commutativity.}
Theorem~\ref{thm:eckmann-hilton-commutativity} uses
Theorem~\ref{thm:interchange} plus unit coherence
(Propositions~\ref{prop:left-unit-law}, \ref{prop:right-unit-law}) to obtain
loop-2-cell commutativity.  Corollary~\ref{cor:EH} is then the compact
algebraic form.

\paragraph{D4. Inversion and contravariance package.}
Theorems~\ref{thm:inverse-coherence},
\ref{thm:double-inverse-coherence}, and
\ref{thm:contravariance-coherence} control interaction between
associativity, inversion, and symmetry.  These theorems are the
``rewrite-algebra'' side conditions used whenever decode maps simplify
composite loops (especially in \S\ref{sec:svk}).

\paragraph{D5. Naturality bridge.}
Propositions~\ref{prop:associator-naturality} and
\ref{prop:unitor-naturality} connect local coherence lemmas to functorial
whiskering.  This bridge is operationally important in the strict
2-categorical instance (\S\ref{sec:twocat}) and in route comparison arguments
inside pushout encodings.

\paragraph{D6. Strict interface from weak data.}
Theorem~\ref{thm:eqtwocat-instance} packages a strict 2-category where
2-cells are propositionally truncated equalities (\texttt{PLift}).  Theorem
\ref{thm:godement-interchange} and Proposition~\ref{prop:whisker-nat} show
that the strict interface is not ad hoc: it is compatible with the
proof-relevant route-level story of \S\ref{sec:coherence}.

\paragraph{D7. Passage to quotients.}
Theorem~\ref{thm:pathrwquot-truncation} isolates the 1-truncation boundary:
raw computational paths are proof-relevant, but quotient hom-spaces are strict
groupoid hom-sets.  This is the exact interface consumed by both
Seifert--van Kampen (\S\ref{sec:svk}) and partial univalence
(\S\ref{sec:univalence}).

\paragraph{D8. Global higher structure.}
Theorems~\ref{thm:contract} and \ref{thm:omega-gpd} combine D1--D7 into a
single weak $\omega$-groupoid theorem.  A useful mental model is:
\[
  \text{explicit 2D coherence} + \text{confluence}
  \Rightarrow \text{contractibility above dimension 2}.
\]
This mirrors homotopical rewriting principles in the Squier--Guiraud--Malbos
line while remaining fully constructive in Lean's kernel.

\paragraph{D9. Van Kampen layer.}
Theorem~\ref{thm:svk-formal} depends on quotient-level groupoid operations
(Theorem~\ref{thm:pathrwquot-truncation}) and on coherence simplifications
from D4--D5.  It is also where the practical benefit of the entire
architecture appears: decomposition of nontrivial $\pi_1$ calculations into
modular loop-word reasoning.

\paragraph{D10. Univalence layer.}
Theorem~\ref{thm:idtoequiv-well-defined} is a quotient-compatibility theorem;
Theorems~\ref{thm:no-univalence} and \ref{thm:partial-ua} delimit the exact
boundary between HoTT-style univalence and computational-path trace
sensitivity.  The dependency is one-way: univalence results rely on quotient
and rewrite theory, not conversely.

\paragraph{D11. File-level wayfinding.}
For readers navigating the repository, a practical route is:
\begin{enumerate}[nosep]
  \item \texttt{Path/Rewrite/GroupoidConfluence.lean}
    (Theorems~\ref{thm:groupoid-confluence},
    \ref{thm:groupoid-church-rosser});
  \item \texttt{Path/OmegaGroupoid/GroupoidProofs.lean}
    (triangle/inverse/contravariance coherence);
  \item \texttt{Path/OmegaGroupoid/TwoCategoryStructure.lean}
    (Godement, whiskering, associator/unitor naturality);
  \item \texttt{Path/Rewrite/Quot.lean} and \texttt{Path/Groupoid.lean}
    (Theorem~\ref{thm:pathrwquot-truncation});
  \item \texttt{Path/CompPath/PushoutPaths.lean}
    (Theorem~\ref{thm:svk-formal});
  \item \texttt{Comparison/UnivalenceAnalog.lean}
    (Theorem~\ref{thm:idtoequiv-well-defined} and
    Theorem~\ref{thm:partial-ua}).
\end{enumerate}

\paragraph{D12. Why this structure scales.}
The central engineering principle is separation of layers:
\[
  \texttt{Path/Step}\;\rightarrow\;\texttt{RwEq}\;\rightarrow\;
  \texttt{PathRwQuot}\;\rightarrow\;\text{algebraic interfaces}.
\]
Because each theorem states clearly which layer it inhabits, proofs remain
stable under refactoring.  This layer discipline is essential for sustaining a
formalization of this size while preserving inspectable computational content.

% ======================================================================
\section{Related Work}\label{sec:related}
% ======================================================================

\paragraph{Computational paths and term rewriting.}
The computational-paths program originates with de~Queiroz and
Gabbay~\cite{deQueirozGabbay1994}, who proposed treating
normalisation sequences as first-class objects in a theory of equality.
De~Queiroz, Ramos, and de~Oliveira~\cite{RQGO2016} developed the
algebraic theory of paths (LNDEQ), showing that the groupoid structure
of paths mirrors the structure of rewrite sequences modulo
Church--Rosser.  Our Lean~4 formalization extends this line of work
with machine-checked proofs and higher-dimensional generalizations.

\paragraph{HoTT and $\omega$-groupoids.}
Lumsdaine~\cite{Lumsdaine2010} and van den Berg--Garner~\cite{vdBG2011}
independently showed that the identity types of intensional MLTT form
weak $\omega$-groupoids.  Brunerie~\cite{Brunerie2016} carried out
extensive computations in HoTT, and Kraus--von Raumer~\cite{KrausRaumer2019}
formalized parts of the $\omega$-groupoid structure in Agda.
Our work differs in that we work in a proof-irrelevant setting and
derive the $\omega$-groupoid structure from confluence rather than from
the elimination principle of the identity type.

\paragraph{Squier's theorem and rewriting.}
Squier~\cite{Squier1994} showed that a finitely-presented monoid with
solvable word problem admits a finite complete rewriting system only if
its third homology group vanishes.  The homotopical interpretation
of rewriting has been developed extensively by
Guiraud--Malbos~\cite{GuiraudMalbos2012} via \emph{polygraphs}
(computads).  Our approach can be seen as a type-theoretic analogue:
the step lists in $\Path$ are 1-cells of a polygraph, $\RwEq$
witnesses are 2-cells, and the Church--Rosser property ensures 3-cell
contractibility---precisely the higher Squier condition.

\paragraph{Lean formalizations.}
Mathlib~\cite{Mathlib2020} provides an extensive library for Lean~4 but
does not formalize proof-relevant rewriting or $\omega$-groupoid
structures.  The closest related formalization is the HoTT library for
Lean~3~\cite{AvraamidesFH2017}, which axiomatizes univalence rather
than deriving coherence from confluence.

\paragraph{Proof-relevant equality.}
Altenkirch--Kaposi~\cite{AltenkirchKaposi2016} study quotient inductive-inductive
types (QIITs) for syntax with binding, which share the concern of
tracking equality witnesses.  Observational Type Theory
(OTT)~\cite{AltenkirchMcBrideSwierstra2007} and Cubical Type
Theory~\cite{CCHM2018} provide alternative approaches to proof-relevant
equality.  Our framework is distinguished by operating \emph{within} a
proof-irrelevant kernel, using the rewrite trace as an orthogonal
dimension of proof relevance.

% ======================================================================
\section{Conclusion}\label{sec:conclusion}
% ======================================================================

We have presented a large-scale Lean~4 formalization of computational
paths that bridges proof-relevant equality, confluence in rewriting, and
higher categorical coherence.  The main technical insight is that the
$\omega$-groupoid structure of types can be recovered from the
Church--Rosser property of a rewrite system, without axiomatizing
univalence or working in an intensional type theory.

Several directions remain open:
\begin{itemize}[nosep]
  \item \textbf{Computational content of 3-cells.} Our current 3-cells
    are obtained from confluence joins; extracting explicit rewrite
    sequences between derivations would give a more intensional
    $\omega$-groupoid.
  \item \textbf{Decidability.} The word problem for the path rewrite
    system (deciding $\RwEq\;p\;q$) is related to confluence and
    termination; we have partial results for specific rewrite systems
    but not a general decision procedure.
  \item \textbf{Connection with cubical models.} The step-list
    representation of paths is reminiscent of De Morgan algebra
    operations in cubical type theory; making this connection precise
    would clarify the relationship between computational paths and
    cubical sets.
  \item \textbf{Integration with Mathlib.} Embedding our weak
    $\omega$-groupoid structure into Mathlib's category theory library
    would enable applications to algebraic topology.
\end{itemize}

% ======================================================================
% References
% ======================================================================
\bibliographystyle{ACM-Reference-Format}

\begin{thebibliography}{99}

\bibitem{AltenkirchKaposi2016}
T.~Altenkirch and A.~Kaposi.
\newblock Type theory in type theory using quotient inductive types.
\newblock In \emph{POPL}, 2016.

\bibitem{AltenkirchMcBrideSwierstra2007}
T.~Altenkirch, C.~McBride, and W.~Swierstra.
\newblock Observational equality, now!
\newblock In \emph{PLPV}, 2007.

\bibitem{AvraamidesFH2017}
F.~van Doorn, J.~von Raumer, and U.~Buchholtz.
\newblock Homotopy type theory in {Lean}.
\newblock In \emph{ITP}, 2017.

\bibitem{Batanin1998}
M.~Batanin.
\newblock Monoidal globular categories as a natural environment for the theory
  of weak $n$-categories.
\newblock \emph{Advances in Mathematics}, 136(1):39--103, 1998.

\bibitem{Brown2006}
R.~Brown.
\newblock \emph{Topology and Groupoids}.
\newblock BookSurge, 3rd edition, 2006.

\bibitem{Brunerie2016}
G.~Brunerie.
\newblock On the homotopy groups of spheres in homotopy type theory.
\newblock PhD thesis, Universit\'e de Nice, 2016.

\bibitem{CCHM2018}
C.~Cohen, T.~Coquand, S.~Huber, and A.~M\"ortberg.
\newblock Cubical type theory: a constructive interpretation of the univalence
  axiom.
\newblock \emph{Journal of Automated Reasoning}, 60(2):199--241, 2018.

\bibitem{deQueiroz1994}
R.~J.~G.~B. de~Queiroz.
\newblock Normalisation and language-theory.
\newblock \emph{Dialectica}, 48(2):83--123, 1994.

\bibitem{deQueirozGabbay1994}
R.~J.~G.~B. de~Queiroz and D.~M. Gabbay.
\newblock Equality in labelled deductive systems and the functional
  interpretation of propositional equality.
\newblock In \emph{Proceedings of the 9th Amsterdam Colloquium}, 1994.

\bibitem{GuiraudMalbos2012}
Y.~Guiraud and P.~Malbos.
\newblock Higher-dimensional normalisation strategies for acyclicity.
\newblock \emph{Advances in Mathematics}, 231(3--4):2294--2351, 2012.

\bibitem{KrausRaumer2019}
N.~Kraus and J.~von Raumer.
\newblock Path spaces of higher inductive types in homotopy type theory.
\newblock In \emph{LICS}, 2019.

\bibitem{Leinster2004}
T.~Leinster.
\newblock \emph{Higher Operads, Higher Categories}.
\newblock London Mathematical Society Lecture Note Series 298. Cambridge
  University Press, 2004.

\bibitem{Lumsdaine2010}
P.~L. Lumsdaine.
\newblock Weak $\omega$-categories from intensional type theory.
\newblock \emph{Logical Methods in Computer Science}, 6(3), 2010.

\bibitem{Mathlib2020}
The mathlib Community.
\newblock The {Lean} mathematical library.
\newblock In \emph{CPP}, 2020.

\bibitem{RamosQueiroz2022}
A.~Ramos and R.~J.~G.~B. de~Queiroz.
\newblock Computational paths --- a weak groupoid.
\newblock \emph{Journal of Logic and Computation}, 2022.

\bibitem{RamosQueiroz2024}
A.~Ramos and R.~J.~G.~B. de~Queiroz.
\newblock Computational paths and the fundamental groupoid of a type.
\newblock \emph{Logical Methods in Computer Science}, 2024.

\bibitem{RQGO2016}
R.~J.~G.~B. de~Queiroz, A.~G. de~Oliveira, and A.~F. Ramos.
\newblock Propositional equality, identity types, and direct computational
  paths.
\newblock \emph{South American Journal of Logic}, 2(2):245--296, 2016.

\bibitem{Squier1994}
C.~Squier.
\newblock A finiteness condition for rewriting systems.
\newblock \emph{Theoretical Computer Science}, 131(2):271--294, 1994.

\bibitem{UFP2013}
The {Univalent Foundations Program}.
\newblock \emph{Homotopy Type Theory: Univalent Foundations of Mathematics}.
\newblock Institute for Advanced Study, 2013.

\bibitem{vdBG2011}
B.~van~den Berg and R.~Garner.
\newblock Types are weak $\omega$-groupoids.
\newblock \emph{Proceedings of the London Mathematical Society},
  102(2):370--394, 2011.

\end{thebibliography}

\end{document}
