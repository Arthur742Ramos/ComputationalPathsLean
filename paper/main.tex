\documentclass[12pt]{amsart}

% Packages
\usepackage{amsmath,amssymb,amsthm,mathtools}
\usepackage{stmaryrd,mathrsfs}
\usepackage{tikz-cd}
\usepackage{enumitem}
\usepackage{booktabs,longtable}
\usepackage[colorlinks=true,linkcolor=blue,citecolor=blue,urlcolor=blue]{hyperref}
\usepackage[nameinlink,noabbrev]{cleveref}
\usepackage{fancyhdr}

% BSL-style header
\pagestyle{fancy}
\fancyhf{}
\fancyhead[C]{\small\textit{Submitted to the Bulletin of Symbolic Logic}}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\setlength{\headheight}{13pt}
\addtolength{\topmargin}{-5pt}

% Theorem environments
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}
\newtheorem{notation}[theorem]{Notation}
\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}

% Notation (Lean-inspired)
\newcommand{\Ty}{\mathsf{Type}}
\newcommand{\Path}{\mathsf{Path}}
\newcommand{\Step}{\mathsf{Step}}
\newcommand{\RwEq}{\mathsf{RwEq}}
\newcommand{\trs}{\mathsf{trans}}
\newcommand{\sym}{\mathsf{symm}}
\newcommand{\refl}{\mathsf{refl}}

\newcommand{\cmpA}{\mathbin{\cdot}}
\newcommand{\vcomp}{\mathbin{\cdot}}
\newcommand{\hcomp}{\mathbin{\star}}
\newcommand{\hcompprime}{\mathbin{\star'}}

% Whiskering operators (avoid \newcommand{\wr}{...} since \wr is in amssymb)
\newcommand{\wl}{\mathbin{\triangleleft}}
\renewcommand{\wr}{\mathbin{\triangleright}}

% Formalization status tags
\newcommand{\FF}{\textbf{FF}}
\newcommand{\PS}{\textbf{PS}}
\newcommand{\SO}{\textbf{SO}}

\title[A Calculus of Computational Paths]{A Calculus of Computational Paths\\[4pt]
{\normalsize\textit{Weak $\omega$-Groupoids from Term Rewriting in Lean~4}}}

\keywords{computational paths, weak $\omega$-groupoid, term rewriting, Lean 4, homotopy type theory, proof relevance}
\subjclass[2020]{03B15, 03B38, 03B70, 18N50, 55Q05, 68V15}
\date{February 2026}

\begin{document}
\maketitle

\begin{abstract}
We present a fully mechanized Lean~4 development of the theory of \emph{computational paths}, a proof-relevant account of equality in which
an equality witness carries an explicit trace of elementary rewrite steps.
The central technical choice is to place rewrite equivalence \(\RwEq\) in
\(\Ty\) rather than \(\Prop\), preventing higher coherences from collapsing
under proof irrelevance.
We define steps, paths, and rewrite equivalence over a 77-constructor step
relation; prove soundness and congruence properties; and establish
Church--Rosser confluence for the completed groupoid fragment via a
free-group interpretation.
From these rewriting principles we construct explicit coherence witnesses
(pentagon, triangle, interchange, Eckmann--Hilton) and assemble a weak
\(\omega\)-groupoid structure inspired by Batanin--Leinster, with
genuine non-degeneracy at levels~0--2 and contractible higher cells
(an \emph{adapted} Batanin--Leinster structure, not the genuinely
non-degenerate one of Lumsdaine or van den Berg--Garner).
Contractibility at dimension~\(\ge 3\) is achieved via a
normalization-based approach: a real normalization pipeline
(\(\mathsf{IsReduced}\), \(\mathsf{normalize}\),
\(\mathsf{to\_normal\_form}_3\)) reduces every 2-cell to a canonical
reduced flat chain using groupoid-law \(\mathsf{MetaStep}_3\)
constructors.
At level~3 (connecting parallel 2-cells), the normalized forms are
joined via the \(\mathsf{rweq\_transport}\) constructor, whose proof
obligation \(\mathsf{derivation_2\_toEq\_eq}\) is discharged by
\(\mathsf{rfl}\) (definitional equality on normalized forms).
At levels~4 and above, Squier-style \(\mathsf{diamond\_filler}\)
3-cells connect normalized higher cells across confluence diamonds.
No invocation of \(\mathsf{Subsingleton.elim}\) appears in the
contractibility proof.
The formalization declares zero custom \texttt{axiom} commands.
We then develop homotopy-theoretic applications, including an
encode--decode computation of \(\pi_1(S^1) \cong \mathbb{Z}\), and report on
the scale and structure of the formalization.
The source code is available at
\url{https://github.com/Arthur742Ramos/ComputationalPathsLean}.
\end{abstract}

% ==========================================================================
% PART 1: Sections 1â€“3
% A Calculus of Computational Paths
% Arthur Freitas Ramos (Microsoft), Ruy J.G.B. de Queiroz (CIn/UFPE),
% Anjolina G. de Oliveira (CIn/UFPE)
% ==========================================================================

\section{Introduction}\label{sec:intro}

\subsection{Proof-relevant equality}

In Martin-L\"of type theory, the identity type $\mathsf{Id}_A(a,b)$ is
traditionally viewed as a proposition: either $a$ equals $b$ or it does not, and
when it does the witness is unique up to propositional equality---the principle
of \emph{uniqueness of identity proofs} (UIP).  From the standpoint of the
Curry--Howard correspondence, however, every proof of $a =_A b$ is a
\emph{computation} that transforms $a$ into $b$, and distinct proofs may record
genuinely different computational histories.  The theory of \emph{computational
paths}, initiated by de~Queiroz~\cite{deQueirozGabbay1994} in the context of labelled
natural deduction, takes this observation as its starting point: the inhabitants
of $a =_A b$ are not mere truth values but structured objects---sequences of
elementary rewrite steps---and the question of when two such sequences should be
identified is itself a question about \emph{paths between paths}.

This perspective is superficially reminiscent of homotopy type theory
(HoTT)~\cite{UFP2013}, where the identity type is endowed with a rich
higher-dimensional structure.  The resemblance, however, masks a fundamental
difference of method.  In HoTT, the higher groupoid structure of identity types
is \emph{axiomatic}: one postulates the univalence axiom and derives its
consequences through a combination of path induction and transport.  In the
computational paths programme, the higher structure is \emph{emergent}: it arises
from the concrete rewriting rules that govern the manipulation of equality
proofs.  The groupoid laws, the pentagon and triangle coherences, the
Eckmann--Hilton argument---all of these are \emph{theorems} about the rewrite
system, not axioms imposed upon it.

\subsection{Historical development}

The roots of the present work lie in de~Queiroz's 1994 proposal for labelled
deductive systems~\cite{deQueirozGabbay1994}, which assigned explicit labels to proof
steps in natural deduction and observed that the normalization of proofs
corresponds to a rewriting process on these labels.  The key insight was that
two proofs of the same sequent may reduce to different normal forms, so that the
labels carry genuine computational content beyond the mere fact of provability.

This idea was developed over the subsequent two decades through a series of
papers~\cite{RQGO2016,RamosQueirozOliveira2017,RamosEtAl2018} that progressively
formalized the notion of a \emph{computational path} as a sequence of elementary
rewriting steps, defined the algebraic operations on paths (composition,
inversion, identity), and identified the rewrite rules governing these
operations.  The system that emerged, denoted $\mathrm{LND}_{\mathsf{EQ\text{-}TRS}}$,
comprises a term rewriting system (TRS) on the algebra of paths, with each
rewrite rule corresponding to an algebraic identity of the groupoid structure.

The present paper reports on a comprehensive formalization of this theory in the
Lean~4 proof assistant~\cite{Moura2021}.  The formalization encompasses approximately
1,300 source files, over 46,000 formally verified theorems, and contains no uses
of \texttt{sorry} or \texttt{admit}---every theorem is fully proved.
The source code is publicly available~\cite{repo}.  The scale
of the formalization is substantial---comparable, in focused depth on a
single framework, to major efforts such as the Liquid Tensor
Experiment, Mathlib's perfectoid spaces, and Flyspeck---and it has been
made possible by a sustained programme of mechanized verification
spanning the full breadth of the theory.

\subsection{The central design decision: \texorpdfstring{$\mathsf{Type}$}{Type} vs.\ \texorpdfstring{$\mathsf{Prop}$}{Prop}}\label{ssec:type-vs-prop-main}

A distinguishing feature of our formalization is the universe in which the
rewrite equivalence relation lives.  In Lean~4 (as in the Calculus of Inductive
Constructions more generally), a relation can target either the impredicative
universe $\mathsf{Prop}$ or a predicative universe $\mathsf{Type}\,u$.  A
$\mathsf{Prop}$-valued relation satisfies proof irrelevance: any two proofs of
the same relational statement are definitionally equal.  A
$\mathsf{Type}$-valued relation does \emph{not}: its inhabitants are genuine
data that can be distinguished, case-split upon, and counted.

Our rewrite equivalence $\mathsf{RwEq}$ is defined as:
\[
\mathsf{RwEq} : \mathsf{Path}\,a\,b \to \mathsf{Path}\,a\,b \to \mathsf{Type}\,u
\]
This choice is \emph{not} accidental.  It is the sine qua non for a
proof-relevant theory of paths-between-paths.  If $\mathsf{RwEq}$ lived in
$\mathsf{Prop}$, then \emph{all} rewrite derivations connecting two paths would
be identified, and the higher-dimensional structure would collapse: the pentagon
coherence, the Eckmann--Hilton argument, and every other higher cell would be
trivialized by proof irrelevance.  By placing $\mathsf{RwEq}$ in
$\mathsf{Type}$, we ensure that distinct rewrite derivations are genuinely
distinct inhabitants, and the higher groupoid structure is \emph{non-degenerate}.

When classical or decidability reasoning requires a $\mathsf{Prop}$-valued
wrapper, we provide $\mathsf{RwEqProp}$ as a $\mathsf{Nonempty}$ wrapper around
$\mathsf{RwEq}$.  This two-tier design---$\mathsf{Type}$-valued for structure,
$\mathsf{Prop}$-valued for logic---pervades the entire formalization and is
essential for maintaining the separation between intensional and extensional
equality.

\subsection{Scope and contributions}

The contributions of this paper, and of the formalization it describes, are the
following:

\begin{enumerate}
\item \textbf{The Path/Step/RwEq framework.}  We define computational paths as
  lists of elementary rewrite steps, equip them with groupoid operations
  (composition, inversion, identity, congruence), and define the rewrite
  equivalence $\mathsf{RwEq}$ as the symmetric reflexive-transitive closure of
  a 77-constructor step relation, targeting $\mathsf{Type}$ rather than
  $\mathsf{Prop}$.

\item \textbf{The weak $\omega$-groupoid theorem.}  We prove that for every type
  $A$ and elements $a, b : A$, the space of paths $\mathsf{Path}\,a\,b$ modulo
  $\mathsf{RwEq}$ carries the structure of a weak $\omega$-groupoid.  The
  groupoid laws, their coherences, and the coherences of the coherences, all
  arise from the rewrite rules---not from axiomatic postulates.

\item \textbf{Confluence via Church--Rosser.}  We prove that the completed
  groupoid fragment of the TRS is confluent by interpreting path expressions into
  the free group and showing that every expression reduces to a unique canonical
  form determined by its free-group image.

\item \textbf{Explicit pentagon and Eckmann--Hilton.}  The pentagon coherence for
  the monoidal structure on path composition, the triangle identity, and the
  Eckmann--Hilton argument for $\pi_2$ are all constructed as explicit
  $\mathsf{Step}$ chains in $\mathsf{RwEq}$, giving concrete rewrite-trace
  witnesses for these standard coherences.

\item \textbf{$\pi_1(S^1) \cong \mathbb{Z}$.}  The fundamental group of the
  circle is computed within the computational paths framework, using a
  winding-number construction that does not require the univalence axiom.

\item \textbf{Seifert--van~Kampen.}  A version of the Seifert--van~Kampen
  theorem is proved, giving the fundamental groupoid of a pushout in terms of a
  free product with amalgamation.

\item \textbf{Partial univalence.}  We establish a partial univalence principle:
  type equivalences give rise to paths in the universe, without postulating full
  univalence as an axiom.

\item \textbf{Breadth of application.}  The framework is applied across
  approximately 20 fully formalized or partially structured domains, with
  an additional ${\sim}50$ statement-level interfaces covering areas
  including algebraic topology, homotopy theory, higher category theory,
  and homological algebra, demonstrating the generality of the
  computational paths approach.
\end{enumerate}

\subsection{Related work and comparison with HoTT}

The relationship between computational paths and homotopy type theory deserves
careful delineation.  Both theories assign non-trivial structure to identity
types, and both arrive at weak $\omega$-groupoid structures.  The differences
are methodological:

\begin{itemize}
\item \emph{Foundation.}  HoTT is founded on an axiomatic identity type with
  path induction (the $J$-rule), augmented by the univalence axiom and higher
  inductive types.  Computational paths are founded on an explicit term rewriting
  system over a concrete syntax of paths.

\item \emph{Constructivity.}  The univalence axiom in HoTT is not
  computationally effective in standard Martin-L\"of type theory (though cubical
  type theory~\cite{CCHM2018} provides a computational interpretation).  The
  rewrite rules of computational paths are directly executable: every rule has a
  concrete left-hand side and right-hand side, and the normalization procedure is
  an algorithm.

\item \emph{Proof relevance.}  In HoTT, the higher structure is a consequence of
  axioms that are opaque to the proof assistant's kernel.  In our formalization,
  the higher structure is witnessed by explicit $\mathsf{Type}$-valued
  inhabitants that can be inspected, composed, and distinguished.

\item \emph{UIP compatibility.}  Our formalization is built on top of Lean~4,
  which validates UIP for the built-in $\mathsf{Eq}$ type.  This is not a
  limitation but a feature: the base-level equality is proof-irrelevant (as
  befits propositions), while the path-level equality is proof-relevant (as
  befits computations).  The two levels coexist without contradiction because
  $\mathsf{RwEq}$ targets $\mathsf{Type}$, not $\mathsf{Prop}$.
\end{itemize}

\subsection{Outline of the paper}

Section~\ref{sec:framework} introduces the foundational definitions: the
$\mathsf{Step}$ and $\mathsf{Path}$ structures, the 77 step constructors of the
rewrite system, the $\mathsf{RwEq}$ relation, and the congruence and
functoriality properties.  Section~\ref{sec:confluence} establishes the
confluence of the completed groupoid TRS via a free-group interpretation, and
discusses the Church--Rosser property and its consequences.
Sections~\ref{sec:omega}--\ref{sec:applications} (Parts~2 and~3) develop the
weak $\omega$-groupoid structure, the homotopy-theoretic applications, and the
breadth of the formalization across mathematical domains.


% ==========================================================================
\section{The Path/Step/RwEq Framework}\label{sec:framework}
% ==========================================================================

We now introduce the three-layer architecture that underpins the entire
formalization: elementary rewrite \emph{steps}, \emph{paths} composed of
steps, and the \emph{rewrite equivalence} $\mathsf{RwEq}$ that identifies
paths related by the TRS.

\subsection{Types, terms, and elementary steps}\label{ssec:steps}

Fix a type $A$ in a universe $\mathcal{U}$.  An \emph{elementary step} in $A$ is
a datum recording a source, a target, and a propositional equality between them.

\begin{definition}[Step]\label{def:step}
A \emph{step} in a type $A : \mathcal{U}$ is a triple
$\langle s, t, \pi \rangle$ where $s, t : A$ and $\pi : s =_A t$.
We write $\mathsf{Step}(A)$ for the type of all steps in~$A$.
\end{definition}

Steps admit two natural operations: \emph{reversal} (swapping source and target
by symmetry of equality) and \emph{functorial action} (mapping through a
function by congruence).

\begin{definition}[Step operations]
Let $s = \langle a, b, \pi \rangle : \mathsf{Step}(A)$ and $f : A \to B$.
\begin{enumerate}
\item $\mathsf{Step.symm}(s) := \langle b, a, \pi^{-1} \rangle$
\item $\mathsf{Step.map}(f, s) := \langle f(a), f(b), \mathsf{ap}_f(\pi) \rangle$
\end{enumerate}
\end{definition}

\begin{remark}
Because the equality $\pi : s =_A t$ lives in $\mathsf{Prop}$, different proofs
of $s = t$ yield the \emph{same} step.  This is proof irrelevance at the base
level.  The proof-relevant structure lives one level up, in the rewrite
equivalence on paths.
\end{remark}

\begin{definition}[Path]\label{def:path}
A \emph{computational path} from $a$ to $b$ in $A$ is a pair
$\langle \sigma, \pi \rangle$ where $\sigma : \mathsf{List}(\mathsf{Step}(A))$ is a
finite sequence of steps and $\pi : a =_A b$ is a propositional equality.  We write
$\mathsf{Path}(a, b)$ or $\mathsf{Path}_A(a, b)$ for the type of all paths from
$a$ to $b$ in $A$.
\end{definition}

The step list $\sigma$ is the \emph{computational trace}---it records which
rewrite rules were applied and in what order.  The equality $\pi$ is the
\emph{semantic content}---it certifies that the composition of steps does indeed
witness $a = b$.  Two paths with the same trace are definitionally equal; two
paths with different traces but the same semantic equality are \emph{not}
definitionally equal, and the question of their equivalence is governed by
$\mathsf{RwEq}$.

\begin{definition}[Groupoid operations on paths]\label{def:groupoid-ops}
We define the following operations on paths:
\begin{enumerate}
\item \emph{Reflexivity.}
  $\mathsf{refl}(a) := \langle [\,], \mathsf{refl}_a \rangle : \mathsf{Path}(a, a)$.

\item \emph{Composition (transitivity).}
  If $p = \langle \sigma_1, \pi_1 \rangle : \mathsf{Path}(a, b)$ and
  $q = \langle \sigma_2, \pi_2 \rangle : \mathsf{Path}(b, c)$, then
  \[
    p \cdot q := \langle \sigma_1 \mathbin{+\!\!+} \sigma_2,\; \pi_2 \circ \pi_1 \rangle
    : \mathsf{Path}(a, c).
  \]

\item \emph{Inversion (symmetry).}
  If $p = \langle \sigma, \pi \rangle : \mathsf{Path}(a, b)$, then
  \[
    p^{-1} := \langle \mathsf{rev}(\sigma).\mathsf{map}(\mathsf{Step.symm}),\; \pi^{-1} \rangle
    : \mathsf{Path}(b, a).
  \]

\item \emph{Congruence.}
  If $f : A \to B$ and $p = \langle \sigma, \pi \rangle : \mathsf{Path}(a, b)$, then
  \[
    \mathsf{ap}_f(p) := \langle \sigma.\mathsf{map}(\mathsf{Step.map}(f)),\;
    \mathsf{ap}_f(\pi) \rangle : \mathsf{Path}(f(a), f(b)).
  \]
\end{enumerate}
\end{definition}

These operations satisfy the expected groupoid laws \emph{on the nose} at the
level of semantic equality (the $\pi$ component), since $\pi$ lives in
$\mathsf{Prop}$ and Lean validates UIP.  At the level of traces, however, the
laws hold only up to $\mathsf{RwEq}$: for instance,
$(p \cdot q) \cdot r$ and $p \cdot (q \cdot r)$ have different step lists
($(\sigma_1 \mathbin{+\!\!+} \sigma_2) \mathbin{+\!\!+} \sigma_3$ vs.\
$\sigma_1 \mathbin{+\!\!+} (\sigma_2 \mathbin{+\!\!+} \sigma_3)$) but are identified by
the associativity rewrite rule.

\begin{theorem}[Definitional groupoid laws]\label{thm:def-groupoid}\label{thm:weak-groupoid-laws}
The following hold as definitional equalities of $\mathsf{Path}$ terms:
\begin{enumerate}
\item $\mathsf{refl}(a) \cdot p = p$ \quad (left unit)
\item $p \cdot \mathsf{refl}(b) = p$ \quad (right unit)
\item $(p \cdot q) \cdot r = p \cdot (q \cdot r)$ \quad (associativity)
\item $(p \cdot q)^{-1} = q^{-1} \cdot p^{-1}$ \quad (anti-homomorphism)
\item $(p^{-1})^{-1} = p$ \quad (involution)
\end{enumerate}
\end{theorem}

\begin{proof}
Each identity reduces to a corresponding identity on list operations:
(1)~$[\,] \mathbin{+\!\!+} \sigma = \sigma$,
(2)~$\sigma \mathbin{+\!\!+} [\,] = \sigma$,
(3)~$(\sigma_1 \mathbin{+\!\!+} \sigma_2) \mathbin{+\!\!+} \sigma_3
  = \sigma_1 \mathbin{+\!\!+} (\sigma_2 \mathbin{+\!\!+} \sigma_3)$,
(4)~$\mathsf{rev}(\sigma_1 \mathbin{+\!\!+} \sigma_2)
  = \mathsf{rev}(\sigma_2) \mathbin{+\!\!+} \mathsf{rev}(\sigma_1)$ composed
  with the map distributing over concatenation, and
(5)~$\mathsf{Step.symm} \circ \mathsf{Step.symm} = \mathsf{id}$.
All five are proved by structural induction on lists.
\end{proof}


\subsection{The 77 step constructors}\label{ssec:constructors}

The rewriting system on computational paths is defined by an inductive relation
$\mathsf{Step}$ (not to be confused with the elementary-step structure of
Definition~\ref{def:step}; context will always disambiguate).  We denote a single
rewrite step from path $p$ to path $q$ by $p \triangleright q$.  The relation
is defined by 77 constructors, organized into the following categories.

\medskip

\noindent\textbf{Category 1: Basic Path Algebra (Rules 1--8).}\quad
These are the core groupoid rewrite rules.

\begin{table}[ht]
\caption{Selected step constructors (Rules 1--8).}
\label{tab:step-rules}
\end{table}


\begin{center}
\renewcommand{\arraystretch}{1.2}
\begin{tabular}{@{}clll@{}}
\toprule
\# & Name & Rule & Type \\
\midrule
1 & \textsc{symm-refl} & $\mathsf{refl}(a)^{-1} \triangleright \mathsf{refl}(a)$ &
  $\forall a.\; \mathsf{Step}\bigl(\mathsf{symm}(\mathsf{refl}\,a),\; \mathsf{refl}\,a\bigr)$ \\
2 & \textsc{symm-symm} & $(p^{-1})^{-1} \triangleright p$ &
  $\forall p.\; \mathsf{Step}\bigl(\mathsf{symm}(\mathsf{symm}\,p),\; p\bigr)$ \\
3 & \textsc{trans-refl-left} & $\mathsf{refl} \cdot p \triangleright p$ &
  $\forall p.\; \mathsf{Step}\bigl(\mathsf{trans}(\mathsf{refl},p),\; p\bigr)$ \\
4 & \textsc{trans-refl-right} & $p \cdot \mathsf{refl} \triangleright p$ &
  $\forall p.\; \mathsf{Step}\bigl(\mathsf{trans}(p,\mathsf{refl}),\; p\bigr)$ \\
5 & \textsc{trans-symm} & $p \cdot p^{-1} \triangleright \mathsf{refl}$ &
  $\forall p.\; \mathsf{Step}\bigl(\mathsf{trans}(p,\mathsf{symm}\,p),\; \mathsf{refl}\bigr)$ \\
6 & \textsc{symm-trans} & $p^{-1} \cdot p \triangleright \mathsf{refl}$ &
  $\forall p.\; \mathsf{Step}\bigl(\mathsf{trans}(\mathsf{symm}\,p,p),\; \mathsf{refl}\bigr)$ \\
7 & \textsc{symm-trans-congr} & $(p \cdot q)^{-1} \triangleright q^{-1} \cdot p^{-1}$ &
  $\forall p\,q.\; \mathsf{Step}\bigl(\ldots\bigr)$ \\
8 & \textsc{trans-assoc} & $(p \cdot q) \cdot r \triangleright p \cdot (q \cdot r)$ &
  $\forall p\,q\,r.\; \mathsf{Step}\bigl(\ldots\bigr)$ \\
\bottomrule
\end{tabular}
\end{center}

\medskip

\noindent\textbf{Category 2: Product Types (Rules 9--16).}\quad
These rules govern the interaction of paths with product types, including
$\beta$-rules for projections, the $\eta$-expansion, and the decomposition of
binary maps.

\begin{center}
\renewcommand{\arraystretch}{1.2}
\begin{tabular}{@{}clp{7.5cm}@{}}
\toprule
\# & Name & Rule \\
\midrule
9 & \textsc{map2-subst} & $\mathsf{map2}(f, p, q) \triangleright
  \mathsf{mapRight}(f, a_1, q) \cdot \mathsf{mapLeft}(f, p, b_2)$ \\
10 & \textsc{prod-fst-$\beta$} & $\mathsf{fst}(\mathsf{mk}(p, q)) \triangleright p$ \\
11 & \textsc{prod-snd-$\beta$} & $\mathsf{snd}(\mathsf{mk}(p, q)) \triangleright q$ \\
12 & \textsc{prod-rec-$\beta$} & $\mathsf{rec}(f, \mathsf{mk}(p, q)) \triangleright
  \mathsf{map2}(f, p, q)$ \\
13 & \textsc{prod-$\eta$} & $\mathsf{mk}(\mathsf{fst}(p), \mathsf{snd}(p)) \triangleright p$ \\
14 & \textsc{prod-mk-symm} & $\mathsf{mk}(p, q)^{-1} \triangleright
  \mathsf{mk}(p^{-1}, q^{-1})$ \\
15 & \textsc{prod-map-congr} & componentwise map through products \\
16 & \textsc{sigma-fst-$\beta$} & $\mathsf{fst}(\sigma\mathsf{Mk}(p, q)) \triangleright
  \mathsf{ofEq}(p.\mathsf{toEq})$ \\
\bottomrule
\end{tabular}
\end{center}

\medskip

\noindent\textbf{Category 3: Sigma Types (Rules 17--19).}\quad
$\beta$- and $\eta$-rules for dependent pairs, plus anti-homomorphism of
inversion over the sigma constructor.
Representative signatures:
\begin{align*}
&\textsc{sigma-snd-$\beta$} :\;
  \mathsf{sigmaSnd}(\sigma\mathsf{Mk}(p, q))
  \triangleright \mathsf{ofEq}(q.\mathsf{toEq}) \\
&\textsc{sigma-$\eta$} :\;
  \sigma\mathsf{Mk}(\mathsf{sigmaFst}(p),\, \mathsf{sigmaSnd}(p))
  \triangleright p \\
&\textsc{sigma-mk-symm} :\;
  \sigma\mathsf{Mk}(p,q)^{-1}
  \triangleright \sigma\mathsf{Mk}(p^{-1},\, \mathsf{sigmaSymmSnd}(p,q))
\end{align*}

\medskip

\noindent\textbf{Category 4: Coproduct Types (Rules 20--21).}\quad
$\beta$-rules for the sum-type recursor:
\begin{align*}
&\textsc{sum-rec-inl-$\beta$} :\;
  \mathsf{rec}(f, g, \mathsf{inl}(p)) \triangleright f(p) \\
&\textsc{sum-rec-inr-$\beta$} :\;
  \mathsf{rec}(f, g, \mathsf{inr}(p)) \triangleright g(p)
\end{align*}

\medskip

\noindent\textbf{Category 5: Function Types (Rules 22--24).}\quad
$\beta$- and $\eta$-rules for function application and lambda abstraction:
\begin{align*}
&\textsc{fun-app-$\beta$} :\;
  (\lambda x.\, p\,x)\,a \triangleright p\,a \\
&\textsc{fun-$\eta$} :\;
  \lambda x.\, \mathsf{app}(p, x) \triangleright p \\
&\textsc{lam-congr-symm} :\;
  (\lambda x.\, p\,x)^{-1} \triangleright \lambda x.\, (p\,x)^{-1}
\end{align*}

\medskip

\noindent\textbf{Category 6: Dependent Application (Rule 25).}\quad
$\textsc{apd-refl} : \mathsf{apd}(f, \mathsf{refl}\,a) \triangleright \mathsf{refl}(f\,a)$.

\medskip

\noindent\textbf{Category 7: Transport (Rules 26--32).}\quad
Transport along reflexivity, composition, and inverses; transport through sigma
constructors.  Seven rules in total, including:
\begin{align*}
&\textsc{transport-refl-$\beta$} :\;
  \mathsf{transport}(\mathsf{refl}, x) \triangleright x \\
&\textsc{transport-trans-$\beta$} :\;
  \mathsf{transport}(p \cdot q, x) \triangleright
  \mathsf{transport}(q, \mathsf{transport}(p, x)) \\
&\textsc{transport-symm-left-$\beta$} :\;
  \mathsf{transport}(p^{-1}, \mathsf{transport}(p, x)) \triangleright x
\end{align*}

\medskip

\noindent\textbf{Category 8: Context Rules (Rules 33--48).}\quad
These 16 rules govern the interaction of rewriting with \emph{contexts}---type-indexed
one-hole containers $C : A \to B$ that allow a path in $A$ to be lifted
to a path in $B$.  The rules include congruence (if $p \triangleright q$ then
$C[p] \triangleright C[q]$), commutativity of symmetry with contexts,
left and right substitution $\beta$-rules, associativity of substitution,
unit laws, idempotence, and cancellation.  Representative signatures:
\begin{align*}
&\textsc{context-congr} :\;
  p \triangleright q \implies C[p] \triangleright C[q] \\
&\textsc{context-map-symm} :\;
  C[p]^{-1} \triangleright C[p^{-1}] \\
&\textsc{context-subst-left-$\beta$} :\;
  r \cdot C[p] \triangleright \mathsf{substLeft}(C, r, p)
\end{align*}

\medskip

\noindent\textbf{Category 9: Dependent Context Rules (Rules 49--60).}\quad
The dependent analogues of the context rules, where the context maps into a
type family $B : A \to \mathcal{U}$ rather than a fixed type.  Twelve rules,
paralleling the non-dependent context rules.

\medskip

\noindent\textbf{Category 10: Binary Context Rules (Rules 61--72).}\quad
Congruence rules for binary contexts (dependent and non-dependent) and for
the $\mathsf{mapLeft}$/$\mathsf{mapRight}$ operations.  These include
left- and right-congruence for $\mathsf{map2}$, as well as rules for lifting
propositional equalities through binary maps.  Twelve rules in total.

\medskip

\noindent\textbf{Category 11: Structural Closure (Rules 73--77).}\quad
Closure rules ensuring that the step relation is stable under the groupoid
operations and that certain critical pairs are closed:

\begin{center}
\renewcommand{\arraystretch}{1.2}
\begin{tabular}{@{}clp{8cm}@{}}
\toprule
\# & Name & Rule \\
\midrule
73 & \textsc{symm-congr} & $p \triangleright q \implies p^{-1} \triangleright q^{-1}$ \\
74 & \textsc{trans-congr-left} & $p \triangleright q \implies p \cdot r \triangleright q \cdot r$ \\
75 & \textsc{trans-congr-right} & $q \triangleright r \implies p \cdot q \triangleright p \cdot r$ \\
76 & \textsc{trans-cancel-left} & $p \cdot (p^{-1} \cdot q) \triangleright q$ \\
77 & \textsc{trans-cancel-right} & $p^{-1} \cdot (p \cdot q) \triangleright q$ \\
\bottomrule
\end{tabular}
\end{center}

\begin{remark}[The cancellation rules]\label{rem:cancellation}\label{ex:critical-pair}
Rules 76 and 77 are \emph{completion rules} in the sense of
Knuth--Bendix~\cite{KnuthBendix1970}: they do not follow from the
basic groupoid axioms (Rules 1--8) as single rewrite steps, though they are
derivable in the equivalence closure.  Their presence is mandated by confluence:
without them, the critical pair between \textsc{trans-assoc} and
\textsc{trans-symm} (respectively \textsc{symm-trans}) is not locally joinable.
Specifically, the term $p \cdot (p^{-1} \cdot q)$ can be rewritten either by
associativity to $(p \cdot p^{-1}) \cdot q$ and thence to
$\mathsf{refl} \cdot q$ and $q$, or directly to $q$ by Rule~76.  The two
reduction paths must join, and the direct cancellation rule ensures that they do
so in a single step.
\end{remark}


\subsection{Rewrite equivalence \texorpdfstring{$\mathsf{RwEq}$}{RwEq}}\label{ssec:rweq}\label{subsec:rweq}

With the step relation in hand, we define the equivalence relation on paths
that identifies paths connected by any finite sequence of forward and backward
steps.

\begin{definition}[Rewrite equivalence]\label{def:rweq}
The \emph{rewrite equivalence} $\mathsf{RwEq}$ is defined as the inductive
type family
\[
\mathsf{RwEq} : \mathsf{Path}(a, b) \to \mathsf{Path}(a, b) \to \mathsf{Type}\,u
\]
with four constructors:
\begin{enumerate}
\item $\mathsf{refl}(p) : \mathsf{RwEq}(p, p)$
\item $\mathsf{step}(h) : \mathsf{RwEq}(p, q)$ \quad whenever $h : p \triangleright q$
\item $\mathsf{symm}(e) : \mathsf{RwEq}(q, p)$ \quad whenever $e : \mathsf{RwEq}(p, q)$
\item $\mathsf{trans}(e_1, e_2) : \mathsf{RwEq}(p, r)$ \quad whenever
  $e_1 : \mathsf{RwEq}(p, q)$ and $e_2 : \mathsf{RwEq}(q, r)$
\end{enumerate}
\end{definition}

\begin{remark}[Why $\mathsf{Type}$, not $\mathsf{Prop}$]\label{rem:type-not-prop}
If $\mathsf{RwEq}$ targeted $\mathsf{Prop}$, proof irrelevance would
identify all inhabitants, collapsing the iterated construction to a
set and trivializing all higher-dimensional structure.
By targeting $\mathsf{Type}\,u$, each level of the tower carries
genuine information: a rewrite derivation
$e : \mathsf{RwEq}(p, q)$ is a structured tree recording the specific sequence
of rules applied, and two derivations $e_1, e_2 : \mathsf{RwEq}(p, q)$
are not identified by proof irrelevance.
See \S\ref{ssec:type-vs-prop-main} for the full discussion.
\end{remark}

\begin{definition}[$\mathsf{RwEqProp}$]\label{def:rweqprop}
For classical and decidability applications, we define
\[
\mathsf{RwEqProp}(p, q) := \exists\, (e : \mathsf{RwEq}(p, q)),\; \top
\]
(implemented as $\mathsf{Nonempty}(\mathsf{RwEq}(p, q))$ in Lean).
This is a $\mathsf{Prop}$-valued wrapper: it records \emph{that} a rewrite
equivalence exists without preserving \emph{which} one.
\end{definition}

\begin{theorem}[Soundness]\label{thm:soundness}
If $\mathsf{RwEq}(p, q)$ then $p.\mathsf{toEq} = q.\mathsf{toEq}$.
That is, rewrite-equivalent paths witness the same propositional equality.
\end{theorem}

\begin{proof}
By induction on the derivation $e : \mathsf{RwEq}(p, q)$.  The base case
$\mathsf{step}(h)$ follows from the fact that each step constructor preserves
the semantic equality (proved by case analysis on all 77 constructors).  The
$\mathsf{refl}$, $\mathsf{symm}$, and $\mathsf{trans}$ cases are immediate
from reflexivity, symmetry, and transitivity of propositional equality.
\end{proof}


\subsection{Congruence and functoriality}\label{ssec:congruence}

The rewrite equivalence is compatible with all path operations, making $\mathsf{ap}_f$
a functor and $\mathsf{trans}$ a bifunctor on the category of paths modulo
$\mathsf{RwEq}$.

\begin{theorem}[Congruence of composition]\label{thm:trans-congr}\label{prop:congr}
If $\mathsf{RwEq}(p, p')$ and $\mathsf{RwEq}(q, q')$, then
$\mathsf{RwEq}(p \cdot q,\; p' \cdot q')$.
\end{theorem}

\begin{proof}
By transitivity of $\mathsf{RwEq}$, it suffices to show separately that
\[
  \mathsf{RwEq}(p \cdot q,\; p' \cdot q) \qquad\text{and}\qquad
  \mathsf{RwEq}(p' \cdot q,\; p' \cdot q').
\]
The first follows by induction on the derivation of $\mathsf{RwEq}(p, p')$,
using the step constructor \textsc{trans-congr-left} at base case.
The second is analogous using \textsc{trans-congr-right}.
\end{proof}

\begin{theorem}[Functoriality of congruence]\label{thm:congrArg-functor}
Let $f : A \to B$.  If $\mathsf{RwEq}(p, q)$ for $p, q : \mathsf{Path}_A(a, b)$,
then $\mathsf{RwEq}(\mathsf{ap}_f(p),\; \mathsf{ap}_f(q))$.
\end{theorem}

\begin{proof}
The functorial action $\mathsf{ap}_f$ is realized as a \emph{context}:
$C := \langle f \rangle$ is a one-hole container with $C.\mathsf{fill}(a) = f(a)$.
The result then follows from the general principle that every
$\mathsf{RewriteLift}$ (a structure packaging a map on paths together with a
proof that it preserves single steps) transports $\mathsf{RwEq}$.  Concretely,
the induction proceeds over $\mathsf{RwEq}(p, q)$, with the step case handled
by \textsc{context-congr}.
\end{proof}

The following derived identities are used pervasively throughout the
formalization.

\begin{theorem}[Naturality of the groupoid operations]\label{thm:naturality}
For any $f : A \to B$ and paths $p : \mathsf{Path}(a, b)$,
$q : \mathsf{Path}(b, c)$:
\begin{enumerate}
\item $\mathsf{RwEq}\bigl(\mathsf{ap}_f(p \cdot q),\;
  \mathsf{ap}_f(p) \cdot \mathsf{ap}_f(q)\bigr)$
  \quad\textup{(monoidal functoriality)}
\item $\mathsf{RwEq}\bigl(\mathsf{ap}_f(p^{-1}),\;
  (\mathsf{ap}_f(p))^{-1}\bigr)$
  \quad\textup{(compatibility with inversion)}
\item $\mathsf{RwEq}\bigl(\mathsf{ap}_f(\mathsf{refl}\,a),\;
  \mathsf{refl}(f\,a)\bigr)$
  \quad\textup{(unit preservation)}
\end{enumerate}
\end{theorem}

\begin{proof}
These are definitional equalities of the $\mathsf{Path}$ structure (they
follow from the corresponding identities on list operations), so they hold
via $\mathsf{RwEq.refl}$ applied to the common path.
\end{proof}

\begin{theorem}[Bifunctoriality of composition]\label{thm:bifunctor}
For binary maps $f : A \times B \to C$ and paths $p : \mathsf{Path}_A(a_1, a_2)$,
$q : \mathsf{Path}_B(b_1, b_2)$:
\begin{enumerate}
\item $\mathsf{RwEq}\bigl(\mathsf{map2}(f, p, q),\;
  \mathsf{mapRight}(f, a_1, q) \cdot \mathsf{mapLeft}(f, p, b_2)\bigr)$
  \quad\textup{(interchange)}
\item Left and right maps preserve $\mathsf{RwEq}$ in each argument separately.
\end{enumerate}
\end{theorem}

\begin{proof}
Part~(1) is the step constructor \textsc{map2-subst} (Rule~9) wrapped in
$\mathsf{RwEq.step}$.  Part~(2) follows from the general
$\mathsf{RewriteLift}$ transport applied to the context $a \mapsto f(a, b)$
(respectively $b \mapsto f(a, b)$).
\end{proof}



% ==========================================================================
\section{Confluence and Church--Rosser}\label{sec:confluence}
% ==========================================================================

A rewriting system is \emph{confluent} if whenever a term $t$ reduces to
both $u$ and $v$ (in any number of steps), there exists a common reduct $w$
to which both $u$ and $v$ reduce~\cite{BaaderNipkow1998}.  Confluence is the central property ensuring
that the rewriting system defines a well-behaved equivalence: it guarantees
that distinct reduction strategies cannot lead to irreconcilable normal forms.

In this section we establish the confluence of the \emph{completed groupoid
TRS}---the fragment of the step relation consisting of Rules 1--8 (the basic
groupoid laws) together with the two cancellation rules (Rules 76--77) and
the congruence closure rules (Rules 73--75).  The proof is entirely
self-contained: it uses no appeal to UIP, proof irrelevance, or the semantic
soundness theorem (\ref{thm:soundness}).  Instead, it proceeds by interpreting
path expressions into the free group and showing that every expression reduces
to a unique canonical form.

\subsection{The completed groupoid TRS}\label{ssec:completed-trs}

To state the confluence theorem precisely, we work with an abstract syntax of
path expressions, independent of the concrete $\mathsf{Path}$ structure.

\begin{definition}[Path expression]\label{def:expr}
The type $\mathsf{Expr}$ of \emph{path expressions} is generated by:
\[
  e ::= \mathsf{atom}(n) \mid \mathsf{refl} \mid \mathsf{symm}(e) \mid
  \mathsf{trans}(e_1, e_2)
\]
where $n : \mathbb{N}$ ranges over a countable set of atomic generators.
\end{definition}

\begin{definition}[CStep: the completed step relation]\label{def:cstep}
The relation $\mathsf{CStep} : \mathsf{Expr} \to \mathsf{Expr} \to \mathsf{Prop}$
is defined by 13 constructors:
\begin{enumerate}
\item Rules 1--8: the basic groupoid laws (\textsc{symm-refl} through
  \textsc{trans-assoc}), acting on $\mathsf{Expr}$ rather than $\mathsf{Path}$.
\item Rules 9--10: the cancellation rules
  \begin{align*}
  \textsc{trans-cancel-left}&:\;
    \mathsf{trans}(p,\, \mathsf{trans}(\mathsf{symm}(p),\, q))
    \triangleright q \\
  \textsc{trans-cancel-right}&:\;
    \mathsf{trans}(\mathsf{symm}(p),\, \mathsf{trans}(p,\, q))
    \triangleright q
  \end{align*}
\item Rules 11--13: congruence closure
  \begin{align*}
  \textsc{symm-congr}&:\;
    p \triangleright q \implies \mathsf{symm}(p) \triangleright \mathsf{symm}(q) \\
  \textsc{trans-congr-left}&:\;
    p \triangleright q \implies \mathsf{trans}(p, r) \triangleright \mathsf{trans}(q, r) \\
  \textsc{trans-congr-right}&:\;
    q \triangleright r \implies \mathsf{trans}(p, q) \triangleright \mathsf{trans}(p, r)
  \end{align*}
\end{enumerate}
We write $\mathsf{CRTC}$ for the reflexive-transitive closure of $\mathsf{CStep}$,
and $e \to^* e'$ for $\mathsf{CRTC}(e, e')$.
\end{definition}


\subsection{Termination}\label{ssec:termination}

Before establishing confluence, we verify that $\mathsf{CStep}$ is terminating:
every reduction sequence is finite.

\begin{definition}[Weight and left-weight]\label{def:weight}
Define the \emph{weight} $w(e)$ and the \emph{left-weight} $\ell(e)$ of an
expression $e$ recursively:
\begin{align*}
w(\mathsf{atom}(n)) &= 4, &\quad \ell(\mathsf{atom}(n)) &= 0, \\
w(\mathsf{refl}) &= 4, &\quad \ell(\mathsf{refl}) &= 0, \\
w(\mathsf{symm}(e)) &= w(e) + 2, &\quad \ell(\mathsf{symm}(e)) &= \ell(e), \\
w(\mathsf{trans}(e_1, e_2)) &= w(e_1) + w(e_2), &\quad
  \ell(\mathsf{trans}(e_1, e_2)) &= |e_1| + \ell(e_1) + \ell(e_2),
\end{align*}
where $|e|$ denotes the size (number of constructors) of $e$.
\end{definition}

\begin{theorem}[Termination of CStep]\label{thm:termination}
The relation $\mathsf{CStep}$ is well-founded: there is no infinite sequence
$e_0 \triangleright e_1 \triangleright e_2 \triangleright \cdots$.
\end{theorem}

\begin{proof}
We show that every $\mathsf{CStep}$ strictly decreases the lexicographic
measure $(w(e), \ell(e)) \in \mathbb{N} \times \mathbb{N}$.  The proof proceeds
by case analysis on all 13 constructors.

For the basic groupoid rules (Rules 1--8), the weight strictly decreases in
every case except \textsc{trans-assoc}, which preserves weight
($w(e_1) + w(e_2) + w(e_3)$ is the same on both sides) but strictly decreases
left-weight (the left subtree shrinks by $|e_1|$).

The cancellation rules (Rules 9--10) strictly decrease weight because they
remove a $\mathsf{symm}$ subterm: the left-hand side contains both
$w(p)$ and $w(\mathsf{symm}(p)) = w(p) + 2$, while the right-hand side
contains only $w(q)$, so the net weight drops by at least $2 \cdot w(p) + 2$.

The congruence rules (Rules 11--13) preserve the lexicographic decrease from
the inner step by a straightforward structural argument.
\end{proof}


\subsection{The free-group interpretation}\label{ssec:free-group}

The key to the confluence proof is a semantic interpretation of path expressions
into the free group.

\begin{definition}[Signed generator]\label{def:gen}
A \emph{signed generator} is either $n^+$ or $n^-$ for $n : \mathbb{N}$.
The involution $(\cdot)^{-1}$ maps $n^+ \mapsto n^-$ and $n^- \mapsto n^+$.
\end{definition}

\begin{definition}[Reduced word]\label{def:reduced}
A \emph{reduced word} is a list $w = [g_1, \ldots, g_k]$ of signed generators
such that no adjacent pair consists of mutual inverses:
$g_i^{-1} \neq g_{i+1}$ for all $1 \le i < k$.  The empty list represents the
identity element.
\end{definition}

The free group operations on reduced words are:

\begin{definition}[Free group operations]\label{def:fg-ops}
\begin{enumerate}
\item \emph{Prepend with cancellation.}  $\mathsf{prepend}(g, w)$: if
  $w = [h, w']$ and $g^{-1} = h$, return $w'$; otherwise return $g :: w$.

\item \emph{Concatenation.}  $\mathsf{rwAppend}(w_1, w_2) :=
  \mathsf{fold}(\mathsf{prepend}, w_1, w_2)$, folding over $w_1$ right-to-left.

\item \emph{Inversion.}
  $\mathsf{rwInv}([]) := []$; \;
  $\mathsf{rwInv}(g :: w) := \mathsf{rwAppend}(\mathsf{rwInv}(w),\, [g^{-1}])$.
\end{enumerate}
\end{definition}

\begin{theorem}[Free group algebra]\label{thm:fg-algebra}
The operations above satisfy:
\begin{enumerate}
\item \emph{Reducedness preservation.}  If $w_1$ and $w_2$ are reduced, then
  $\mathsf{rwAppend}(w_1, w_2)$ and $\mathsf{rwInv}(w_1)$ are reduced.
\item \emph{Associativity.}
  $\mathsf{rwAppend}(\mathsf{rwAppend}(a, b), c) =
  \mathsf{rwAppend}(a, \mathsf{rwAppend}(b, c))$
  for reduced $a, b, c$.
\item \emph{Inverse laws.}
  $\mathsf{rwAppend}(w, \mathsf{rwInv}(w)) = []$ and
  $\mathsf{rwAppend}(\mathsf{rwInv}(w), w) = []$ for reduced $w$.
\item \emph{Cancellation.}
  $\mathsf{rwAppend}(w_1, \mathsf{rwAppend}(\mathsf{rwInv}(w_1), w_2)) = w_2$
  and dually.
\item \emph{Anti-homomorphism of inversion.}
  $\mathsf{rwInv}(\mathsf{rwAppend}(w_1, w_2)) =
  \mathsf{rwAppend}(\mathsf{rwInv}(w_2), \mathsf{rwInv}(w_1))$.
\item \emph{Double inversion.}
  $\mathsf{rwInv}(\mathsf{rwInv}(w)) = w$ for reduced $w$.
\end{enumerate}
\end{theorem}

\begin{proof}
All six properties are proved by induction on the word lists, using the
auxiliary lemma that $\mathsf{prepend}(g, \mathsf{prepend}(g^{-1}, w)) = w$
for reduced $w$ (which itself follows from a case split on whether $g^{-1}$
cancels with the head of $w$).  The proofs are entirely constructive and
carry no classical assumptions.
\end{proof}

\begin{definition}[Semantic interpretation]\label{def:toRW}
The \emph{interpretation} $\llbracket \cdot \rrbracket :
\mathsf{Expr} \to \mathsf{List}(\mathsf{Gen})$ is defined by:
\begin{align*}
\llbracket \mathsf{atom}(n) \rrbracket &:= [n^+] \\
\llbracket \mathsf{refl} \rrbracket &:= [] \\
\llbracket \mathsf{symm}(e) \rrbracket &:= \mathsf{rwInv}(\llbracket e \rrbracket) \\
\llbracket \mathsf{trans}(e_1, e_2) \rrbracket &:=
  \mathsf{rwAppend}(\llbracket e_1 \rrbracket, \llbracket e_2 \rrbracket)
\end{align*}
\end{definition}

\begin{theorem}[Reducedness of the interpretation]\label{thm:toRW-reduced}
For every expression $e$, the word $\llbracket e \rrbracket$ is reduced.
\end{theorem}

\begin{proof}
By structural induction on $e$, using the reducedness-preservation properties
of $\mathsf{rwAppend}$ and $\mathsf{rwInv}$ (Theorem~\ref{thm:fg-algebra}(1)).
\end{proof}


\subsection{Invariance, reachability, and the confluence theorem}\label{ssec:confluence-proof}

The confluence proof has three main components.

\begin{theorem}[Invariance]\label{thm:invariance}
If $e_1 \triangleright e_2$ (via $\mathsf{CStep}$), then
$\llbracket e_1 \rrbracket = \llbracket e_2 \rrbracket$.
\end{theorem}

\begin{proof}
By case analysis on the 13 $\mathsf{CStep}$ constructors.  Each case reduces to
one of the free group identities of Theorem~\ref{thm:fg-algebra}:
\begin{itemize}
\item \textsc{symm-refl}: $\mathsf{rwInv}([]) = []$ \checkmark
\item \textsc{symm-symm}: $\mathsf{rwInv}(\mathsf{rwInv}(w)) = w$ (double inversion)
\item \textsc{trans-refl-left}: $\mathsf{rwAppend}([], w) = w$ \checkmark
\item \textsc{trans-refl-right}: $\mathsf{rwAppend}(w, []) = w$ (right unit)
\item \textsc{trans-symm}: $\mathsf{rwAppend}(w, \mathsf{rwInv}(w)) = []$ (right inverse)
\item \textsc{symm-trans}: $\mathsf{rwAppend}(\mathsf{rwInv}(w), w) = []$ (left inverse)
\item \textsc{symm-trans-congr}: anti-homomorphism of inversion
\item \textsc{trans-assoc}: associativity of $\mathsf{rwAppend}$
\item \textsc{trans-cancel-left}: left cancellation
\item \textsc{trans-cancel-right}: right cancellation
\item \textsc{symm-congr}, \textsc{trans-congr-left/right}: congruence under the interpretation (by the inductive hypothesis)
\end{itemize}
\end{proof}

\begin{corollary}[Invariance under multi-step reduction]\label{cor:invariance-rtc}
If $e_1 \to^* e_2$ then $\llbracket e_1 \rrbracket = \llbracket e_2 \rrbracket$.
\end{corollary}

\begin{definition}[Canonical form]\label{def:canon}
For a reduced word $w = [g_1, \ldots, g_k]$, define the \emph{canonical expression}:
\[
\mathsf{rwToExpr}(w) :=
\begin{cases}
\mathsf{refl} & \text{if } k = 0, \\
g_1.\mathsf{toExpr} & \text{if } k = 1, \\
\mathsf{trans}(g_1.\mathsf{toExpr},\; \mathsf{rwToExpr}([g_2, \ldots, g_k]))
  & \text{if } k \ge 2,
\end{cases}
\]
where $n^+.\mathsf{toExpr} = \mathsf{atom}(n)$ and
$n^-.\mathsf{toExpr} = \mathsf{symm}(\mathsf{atom}(n))$.
The \emph{canonical form} of $e$ is $\mathsf{canon}(e) :=
\mathsf{rwToExpr}(\llbracket e \rrbracket)$.
\end{definition}

\begin{theorem}[Round-trip property]\label{thm:roundtrip}
For every reduced word $w$, we have
$\llbracket \mathsf{rwToExpr}(w) \rrbracket = w$.
\end{theorem}

\begin{proof}
By induction on $w$, using the fact that $\llbracket g.\mathsf{toExpr} \rrbracket = [g]$
for each generator $g$, and that $\mathsf{prepend}$ does not cancel when
the reducedness invariant is maintained (the head of the tail cannot be
the inverse of $g$ by the reducedness hypothesis).
\end{proof}

\begin{corollary}[Injectivity of canonical forms]
If $w_1$ and $w_2$ are reduced and $\mathsf{rwToExpr}(w_1) = \mathsf{rwToExpr}(w_2)$,
then $w_1 = w_2$.
\end{corollary}

\begin{theorem}[Reachability]\label{thm:reachability}
For every expression $e$, we have $e \to^* \mathsf{canon}(e)$.
\end{theorem}

\begin{proof}
By structural induction on $e$:
\begin{itemize}
\item $\mathsf{atom}(n)$: the canonical form is $\mathsf{atom}(n)$ itself.
\item $\mathsf{refl}$: the canonical form is $\mathsf{refl}$ itself.
\item $\mathsf{symm}(e)$: by the inductive hypothesis, $e \to^* \mathsf{canon}(e)$.
  By congruence, $\mathsf{symm}(e) \to^* \mathsf{symm}(\mathsf{canon}(e))$.
  We then show $\mathsf{symm}(\mathsf{rwToExpr}(w)) \to^*
  \mathsf{rwToExpr}(\mathsf{rwInv}(w))$ by a secondary induction on $w$,
  using \textsc{symm-refl} for the empty case, \textsc{symm-symm} for
  negative generators, and \textsc{symm-trans-congr} to distribute
  inversion over composition.
\item $\mathsf{trans}(e_1, e_2)$: similarly, using the inductive hypotheses
  and showing $\mathsf{trans}(\mathsf{rwToExpr}(w_1),\,
  \mathsf{rwToExpr}(w_2)) \to^*
  \mathsf{rwToExpr}(\mathsf{rwAppend}(w_1, w_2))$ by induction on $w_1$,
  using \textsc{trans-assoc} to reassociate and the cancellation rules
  to eliminate inverse pairs at the junction.
\end{itemize}
\end{proof}

We can now state and prove the main theorem.

\begin{theorem}[Confluence of the completed groupoid TRS]\label{thm:confluence}
For any expressions $a, b, c$ with $a \to^* b$ and $a \to^* c$, there exists
$d$ with $b \to^* d$ and $c \to^* d$.
\end{theorem}

\begin{proof}
By Corollary~\ref{cor:invariance-rtc},
$\llbracket b \rrbracket = \llbracket a \rrbracket = \llbracket c \rrbracket$.
Therefore $\mathsf{canon}(b) = \mathsf{rwToExpr}(\llbracket b \rrbracket)
= \mathsf{rwToExpr}(\llbracket c \rrbracket) = \mathsf{canon}(c)$.
By Theorem~\ref{thm:reachability}, $b \to^* \mathsf{canon}(b)$ and
$c \to^* \mathsf{canon}(c) = \mathsf{canon}(b)$.  Take
$d := \mathsf{canon}(b)$.
\end{proof}

\begin{corollary}[Local confluence]
If $a \triangleright b$ and $a \triangleright c$, then $b$ and $c$ are joinable.
\end{corollary}

\begin{corollary}[Unique normal forms]
If $e_1$ and $e_2$ are both normal forms (no $\mathsf{CStep}$ applies) reachable
from $e$, then $e_1 = e_2$.
\end{corollary}


\subsection{The Church--Rosser property}\label{ssec:church-rosser}

The Church--Rosser property strengthens confluence by characterizing the
equivalence closure in terms of joinability.

\begin{theorem}[Church--Rosser]\label{thm:church-rosser}
Two expressions $e_1, e_2$ are in the equivalence closure of $\mathsf{CStep}$
if and only if $\llbracket e_1 \rrbracket = \llbracket e_2 \rrbracket$.
In particular, if $\llbracket e_1 \rrbracket = \llbracket e_2 \rrbracket$,
then $e_1$ and $e_2$ are joinable: there exists $d$ with
$e_1 \to^* d$ and $e_2 \to^* d$.
\end{theorem}

\begin{proof}
The ``only if'' direction is Theorem~\ref{thm:invariance} extended to the
equivalence closure (since $\llbracket \cdot \rrbracket$ is invariant under
both forward and backward steps).

The ``if'' direction: assume $\llbracket e_1 \rrbracket = \llbracket e_2 \rrbracket$.
Then $\mathsf{canon}(e_1) = \mathsf{canon}(e_2)$, and by
Theorem~\ref{thm:reachability}, $e_1 \to^* \mathsf{canon}(e_1)$ and
$e_2 \to^* \mathsf{canon}(e_2) = \mathsf{canon}(e_1)$.
\end{proof}

\begin{remark}[Decidability]
As an immediate consequence, the word problem for the completed groupoid TRS is
\emph{decidable}: to determine whether $e_1$ and $e_2$ are equivalent, compute
$\llbracket e_1 \rrbracket$ and $\llbracket e_2 \rrbracket$ (which are concrete
lists of signed generators, with decidable equality) and compare.
\end{remark}


\subsection{What is proved vs.\ what is assumed}\label{ssec:honest}

We close this section with an honest assessment of the scope of the confluence
result.

The confluence theorem (Theorem~\ref{thm:confluence}) applies to the
\emph{groupoid fragment}: the 8 basic groupoid rules, the 2 cancellation rules,
and the 3 congruence closure rules---13 constructors in total, acting on the
abstract syntax $\mathsf{Expr}$.  This is the fragment that governs the
algebraic manipulation of path composition, inversion, and identity.

The full step relation $\mathsf{Step}$ on the concrete $\mathsf{Path}$ type
has 77 constructors, encompassing product types, sigma types, coproducts,
function types, transport, contexts, and binary contexts.  For the full system,
confluence is handled by the $\mathsf{HasJoinOfRw}$ typeclass, which
postulates that any two multi-step reducts from a common source can be joined.
In the current formalization, this typeclass is instantiated via the
$\mathsf{HasConfluenceProp}$ infrastructure, which relies on the following
components:

\begin{enumerate}
\item The groupoid fragment is confluent by Theorem~\ref{thm:confluence}
  (fully proved, no assumptions).

\item Critical pairs between the type-former rules (products, sigmas, functions,
  transport) and the groupoid rules are verified by explicit join constructions
  in the $\mathsf{CriticalPairs}$ namespace.  These include:
  \begin{itemize}
  \item the overlap between \textsc{prod-fst-$\beta$} and \textsc{map2-subst},
  \item the overlap between \textsc{trans-assoc} and \textsc{trans-refl-right},
  \item the overlap between \textsc{trans-assoc} and \textsc{trans-symm}
    (closed by the cancellation rules),
  \item the overlap between context substitution and associativity.
  \end{itemize}

\item The full system's confluence for the remaining type-former rules follows
  the pattern that these rules are \emph{non-overlapping} with each other
  (their left-hand sides are syntactically disjoint), so local confluence
  reduces to the groupoid fragment plus the explicitly verified critical pairs.

\item Some step constructors produce \emph{identity rewrites}: their left-hand
  and right-hand sides are semantically equal, so they reduce to reflexivity at
  the semantic level.  These include the transport rules (Rules 27--32), where
  the step wraps a propositional equality in a $\mathsf{stepChain}$ and reduces
  to an $\mathsf{Eq.ndrec}$ application.  The join for such ``trivially
  joinable'' critical pairs is given by the semantic soundness theorem
  (Theorem~\ref{thm:soundness}).
\end{enumerate}

In summary: the groupoid fragment has a complete, constructive confluence proof
via the free-group interpretation.  The full 77-rule system's confluence is
established modularly, combining the groupoid confluence with explicit
critical-pair analysis for the type-former rules.
% ======================================================================
% PART 2: Sections 4--6
% Coherence, Two-Categorical Structure, Weak Ï‰-Groupoid Theorem
% ======================================================================

% ======================================================================
\section{Coherence}\label{sec:coherence}
% ======================================================================

The coherence laws of higher category theory---pentagon, triangle,
interchange, Eckmann--Hilton, and inverse coherences---are established
as explicit $\RwEq$ witnesses constructed from $\Step$ chains.
By ``explicit'' we mean that each coherence witness is a concrete term
whose structure records which rewrite rules were applied and in what order;
no coherence proof in the formalization invokes
$\mathsf{Subsingleton.elim}$ at the $\RwEq$ level (though the underlying
$\mathsf{Step}$ relation is $\Prop$-valued and therefore proof-irrelevant).

\subsection{Pentagon coherence}\label{subsec:pentagon}

The pentagon identity expresses the coherence condition for the
associator of path composition: there are exactly two canonical ways to
reassociate a fourfold composite, and the two routes must agree.

\begin{definition}[Associator]\label{def:associator}
For composable paths $p : \Path\;a\;b$, $q : \Path\;b\;c$,
$r : \Path\;c\;d$, the \emph{associator} is the $\RwEq$ witness
\[
  \alpha_{p,q,r} : \RwEq\;\big(\trs(\trs(p,q),r)\big)
                          \;\big(\trs(p,\trs(q,r))\big)
\]
constructed as
$\alpha_{p,q,r} \triangleq \RwEq.\mathsf{step}(\Step.\mathsf{trans\_assoc}\;p\;q\;r)$.
This is a single application of Rule~8 from the step system
(Table~\ref{tab:step-rules}).
\end{definition}

To state the pentagon, we introduce five edges connecting the five
parenthesizations of a fourfold composite.
Given four composable paths $p : \Path\;a\;b$, $q : \Path\;b\;c$,
$r : \Path\;c\;d$, $s : \Path\;d\;e$, the source vertex is
$((p \cmpA q) \cmpA r) \cmpA s$ and the target vertex is
$p \cmpA (q \cmpA (r \cmpA s))$.

\begin{definition}[Pentagon edges]\label{def:pentagon-edges}
The five edges of the Mac~Lane pentagon are:
\begin{align}
  e_1 &: \RwEq\;\big(((p \cmpA q) \cmpA r) \cmpA s\big)
                \;\big((p \cmpA q) \cmpA (r \cmpA s)\big)
    && \triangleq\; \RwEq.\mathsf{step}(\Step.\mathsf{trans\_assoc}\;
       (p \cmpA q)\; r\; s) \label{eq:pent-e1} \\
  e_2 &: \RwEq\;\big((p \cmpA q) \cmpA (r \cmpA s)\big)
                \;\big(p \cmpA (q \cmpA (r \cmpA s))\big)
    && \triangleq\; \RwEq.\mathsf{step}(\Step.\mathsf{trans\_assoc}\;
       p\; q\; (r \cmpA s)) \label{eq:pent-e2} \\
  e_3 &: \RwEq\;\big(((p \cmpA q) \cmpA r) \cmpA s\big)
                \;\big((p \cmpA (q \cmpA r)) \cmpA s\big)
    && \triangleq\; \RwEq.\mathsf{step}(\Step.\mathsf{trans\_congr\_left}\;
       s\; (\Step.\mathsf{trans\_assoc}\; p\; q\; r))
       \label{eq:pent-e3} \\
  e_4 &: \RwEq\;\big((p \cmpA (q \cmpA r)) \cmpA s\big)
                \;\big(p \cmpA ((q \cmpA r) \cmpA s)\big)
    && \triangleq\; \RwEq.\mathsf{step}(\Step.\mathsf{trans\_assoc}\;
       p\; (q \cmpA r)\; s) \label{eq:pent-e4} \\
  e_5 &: \RwEq\;\big(p \cmpA ((q \cmpA r) \cmpA s)\big)
                \;\big(p \cmpA (q \cmpA (r \cmpA s))\big)
    && \triangleq\; \RwEq.\mathsf{step}(\Step.\mathsf{trans\_congr\_right}\;
       p\; (\Step.\mathsf{trans\_assoc}\; q\; r\; s))
       \label{eq:pent-e5}
\end{align}
Here $e_3$ uses Rule~63 (left congruence closure under $\trs$) to
apply associativity to the left factor while holding $s$ fixed, and
$e_5$ uses Rule~64 (right congruence closure) to apply associativity
to the right factor while holding~$p$ fixed.
\end{definition}

The two canonical routes through the pentagon are now composed from
these edges.

\begin{definition}[Pentagon routes]\label{def:pentagon-routes}
The \emph{right route} (outer association first):
\[
  R \;\triangleq\; \RwEq.\trs(e_1,\; e_2)
  \;:\; \RwEq\;\big(((p \cmpA q) \cmpA r) \cmpA s\big)
              \;\big(p \cmpA (q \cmpA (r \cmpA s))\big).
\]
The \emph{left route} (inner association first):
\[
  L \;\triangleq\; \RwEq.\trs(e_3,\;\RwEq.\trs(e_4,\; e_5))
  \;:\; \RwEq\;\big(((p \cmpA q) \cmpA r) \cmpA s\big)
              \;\big(p \cmpA (q \cmpA (r \cmpA s))\big).
\]
\end{definition}

\begin{theorem}[Pentagon coherence]\label{thm:pentagon}
For all composable paths $p, q, r, s$, the left and right pentagon
routes yield the same underlying equality:
\[
  \mathsf{rweq\_toEq}(L) \;=\; \mathsf{rweq\_toEq}(R).
\]
\end{theorem}

\begin{proof}
The function $\mathsf{rweq\_toEq} : \RwEq\;p\;q \to (p.\mathsf{toEq} = q.\mathsf{toEq})$
projects an $\RwEq$ witness to the underlying propositional equality
between the $\Eq$-valued proof fields of the paths.
Both $\mathsf{rweq\_toEq}(L)$ and $\mathsf{rweq\_toEq}(R)$ are
elements of the identity type $p.\mathsf{toEq} = q.\mathsf{toEq}$
in $\Prop$; since this type lives in $\Prop$, the two elements are
definitionally equal.
In the formalization, the proof is discharged by \texttt{rfl}.

The essential point is not the triviality of the projected equality
(which follows from proof irrelevance in $\Prop$), but the
\emph{existence} of both $L$ and $R$ as distinct, explicitly
constructed $\RwEq$ witnesses in $\Ty\;u$.
The route $R$ consists of two $\Step$ applications (Rules~8, 8),
while the route $L$ consists of three $\Step$ applications
(Rules~63+8, 8, 64+8).
These are genuinely different inhabitants of
$\RwEq\;\big(((p \cmpA q) \cmpA r) \cmpA s\big)
       \;\big(p \cmpA (q \cmpA (r \cmpA s))\big)$,
and $\mathsf{Subsingleton.elim}$ cannot identify them because
$\RwEq$ is $\Ty$-valued.
The pentagon coherence theorem asserts that although the routes
differ as derivations, they agree on the underlying semantic content.
\end{proof}

\begin{remark}[Explicit construction vs.\ proof-irrelevant triviality]
In a system where $\RwEq$ were $\Prop$-valued, the pentagon would
be trivially true: any two inhabitants of a proposition are equal.
The $\Ty$-valued design forces us to construct both routes as
explicit $\Step$ chains before comparing them.
The mathematical content of these constructions is standard
(they follow the same pattern as in any groupoid-enriched setting);
the novelty lies in their realization as concrete rewrite traces
within the TRS.
\end{remark}

The pentagon extends to fivefold composites by standard arguments.

\begin{theorem}[Mac~Lane fivefold coherence]\label{thm:mac-lane}
For composable paths $p, q, r, s, t$, every parenthesization of the
fivefold composite $p \cmpA q \cmpA r \cmpA s \cmpA t$ is connected
to the fully right-associated form
$p \cmpA (q \cmpA (r \cmpA (s \cmpA t)))$
by a canonical $\RwEq$ witness, and all such routes induce the same
underlying equality.
More precisely, for any two $\RwEq$ witnesses
$h_1, h_2 : \RwEq\;\pi_1\;\pi_2$ connecting parenthesizations
$\pi_1$ and $\pi_2$ and built from composites of associator edges
\eqref{eq:pent-e1}--\eqref{eq:pent-e5}, we have
$\mathsf{rweq\_toEq}(h_1) = \mathsf{rweq\_toEq}(h_2)$.
\end{theorem}

\begin{proof}
By Mac~Lane's coherence theorem for monoidal categories, it suffices
to verify the pentagon and triangle identities.
The pentagon is Theorem~\ref{thm:pentagon}; the triangle is
Theorem~\ref{thm:triangle} below.
Every diagram built from canonical associator and unitor edges
commutes at the $\mathsf{toEq}$ level because all such projected
equalities inhabit $\Prop$.
\end{proof}

\subsection{Interchange and Eckmann--Hilton}\label{subsec:interchange}

Two-dimensional cells---inhabitants of $\RwEq\;p\;q$ for parallel
paths $p, q : \Path\;a\;b$---admit two composition operations.
\emph{Vertical composition} concatenates $\RwEq$ witnesses:
given $\alpha : \RwEq\;p\;q$ and $\beta : \RwEq\;q\;r$,
the composite $\alpha \vcomp \beta \triangleq \RwEq.\trs(\alpha, \beta)$
has type $\RwEq\;p\;r$.
\emph{Horizontal composition} is defined via whiskering.

\begin{definition}[Whiskering]\label{def:whiskering}
Given $\alpha : \RwEq\;p\;p'$ and a fixed path $q : \Path\;b\;c$:
\begin{itemize}[nosep]
  \item \emph{Right whiskering}:
    $\alpha \wr q \triangleq
     \mathsf{rweq\_trans\_congr\_left}\;q\;\alpha
     : \RwEq\;(\trs\;p\;q)\;(\trs\;p'\;q)$,
    defined by induction on $\alpha$, lifting each $\Step\;s$ to
    $\Step.\mathsf{trans\_congr\_left}\;q\;s$ (Rule~63).
  \item \emph{Left whiskering}:
    $p \wl \beta \triangleq
     \mathsf{rweq\_trans\_congr\_right}\;p\;\beta
     : \RwEq\;(\trs\;p\;q)\;(\trs\;p\;q')$,
    defined by induction on $\beta$, lifting each $\Step\;s$ to
    $\Step.\mathsf{trans\_congr\_right}\;p\;s$ (Rule~64).
\end{itemize}
\end{definition}

\begin{definition}[Horizontal composition]\label{def:hcomp}
Given $\alpha : \RwEq\;p\;p'$ and $\beta : \RwEq\;q\;q'$, the
\emph{horizontal composite} (Godement product) is:
\[
  \alpha \hcomp \beta
  \;\triangleq\;
  (\alpha \wr q) \vcomp (p' \wl \beta)
  \;:\; \RwEq\;(\trs\;p\;q)\;(\trs\;p'\;q').
\]
An alternative definition
$\alpha \hcompp \beta \triangleq (p \wl \beta) \vcomp (\alpha \wr q')$
right-whiskers $\alpha$ after left-whiskering $\beta$.
Both produce the same underlying equality:
$\mathsf{rweq\_toEq}(\alpha \hcomp \beta) =
 \mathsf{rweq\_toEq}(\alpha \hcompp \beta)$.
\end{definition}

\begin{theorem}[Interchange law]\label{thm:interchange}
For a $2 \times 2$ grid of composable 2-cells
\[
  \alpha_1 : \RwEq\;p_1\;p_2, \quad
  \alpha_2 : \RwEq\;p_2\;p_3, \quad
  \beta_1 : \RwEq\;q_1\;q_2, \quad
  \beta_2 : \RwEq\;q_2\;q_3,
\]
the horizontal-then-vertical and vertical-then-horizontal composites
agree:
\[
  (\alpha_1 \vcomp \alpha_2) \hcomp (\beta_1 \vcomp \beta_2)
  \;=_{\mathsf{toEq}}\;
  (\alpha_1 \hcomp \beta_1) \vcomp (\alpha_2 \hcomp \beta_2).
\]
\end{theorem}

\begin{proof}
Both composites are $\RwEq$ witnesses between
$\trs\;p_1\;q_1$ and $\trs\;p_3\;q_3$.
Their $\mathsf{toEq}$ projections coincide by $\mathsf{rfl}$,
as both land in $\Prop$.
\end{proof}

We now turn to the Eckmann--Hilton argument, which uses interchange
to prove commutativity of 2-cell loops.

\begin{definition}[Double loop space]\label{def:omega2}
For $a : A$, define
$\Omega^2(A, a) \triangleq \Path\;(\refl\;a)\;(\refl\;a)$,
the type of paths from $\refl\;a$ to itself in the path space
$\Path\;a\;a$.
Elements of $\Omega^2(A, a)$ are ``2-cell loops'': self-paths of
the identity path.
\end{definition}

The vertical and horizontal compositions can both be defined on
$\Omega^2(A, a)$.
Vertical composition is simply path concatenation in the space
$\Path\;a\;a$.
Horizontal composition is defined via the binary map
$\mathsf{map2}\;(\trs)\;\alpha\;\beta$, decomposed by Rule~9
($\mathsf{map2\_subst}$) into a whiskering composite.

\begin{theorem}[Eckmann--Hilton commutativity]\label{thm:eckmann-hilton}
For all $\alpha, \beta : \Omega^2(A, a)$,
the vertical composite $\alpha \vcomp \beta$ equals $\beta \vcomp \alpha$
after projection through $\mathsf{toEq}$.
The proof proceeds in three explicit steps:
\begin{enumerate}
  \item \textbf{Vertical to horizontal.}
    The ``vertical composite''
    $v(\alpha, \beta) \triangleq
     \mathsf{map2}\;(\trs)\;\alpha\;\beta$
    is related to the ``horizontal composite''
    $h(\alpha, \beta) \triangleq
     (\refl \wl \beta) \cmpA (\alpha \wr \refl)$
    by a single $\Step$ application:
    \[
      \Step.\mathsf{map2\_subst}\;(\trs)\;\alpha\;\beta
      \;:\; \Step\;(v(\alpha, \beta))\;(h(\alpha, \beta)).
    \]
    This is Rule~9 of the step system, which decomposes a binary map
    into a composite of unary maps (whiskerings).

  \item \textbf{Symmetry of whiskering.}
    In $h(\alpha, \beta)$, the factor $\refl \wl \beta$ reduces to
    $\beta$ (by Rule~3, left unit) and $\alpha \wr \refl$ reduces to
    $\alpha$ (by Rule~4, right unit).
    Similarly, $h(\beta, \alpha)$ reduces to
    $\beta \cmpA \alpha$.
    At the boundary $\refl\;a$, left and right whiskering by $\refl$
    are interchangeable: the order of $\alpha$ and $\beta$ in the
    horizontal composite can be swapped because both factors compose
    with $\refl$.

  \item \textbf{Horizontal to vertical.}
    Applying the unit laws in reverse converts $h(\beta, \alpha)$
    back to $v(\beta, \alpha) = \mathsf{map2}\;(\trs)\;\beta\;\alpha$.
\end{enumerate}
The composite route
\[
  v(\alpha, \beta)
  \xrightarrow{\mathsf{map2\_subst}}
  h(\alpha, \beta)
  \xrightarrow{\text{unit laws}}
  h(\beta, \alpha)
  \xrightarrow{\mathsf{map2\_subst}^{-1}}
  v(\beta, \alpha)
\]
yields an $\RwEq$ witness from $v(\alpha, \beta)$ to
$v(\beta, \alpha)$, which projects to
$v(\alpha, \beta).\mathsf{toEq} = v(\beta, \alpha).\mathsf{toEq}$.
\end{theorem}

\begin{proof}
The first step is the $\RwEq$ witness
$\RwEq.\mathsf{step}(\Step.\mathsf{map2\_subst}\;(\trs)\;\alpha\;\beta)$.
The unit law reductions produce further $\Step$ applications
(Rules~3 and~4).
The interchange at the $\refl$-boundary swaps the whiskering order.
Composing these $\RwEq$ witnesses via $\RwEq.\trs$ yields the
desired chain.
At the $\mathsf{toEq}$ level, both sides of the chain are
propositional equalities in $\Prop$, so they coincide by
$\mathsf{rfl}$.
\end{proof}

\begin{remark}[Anti-involution, not symmetric braiding]%
\label{rem:anti-involution}
Eckmann--Hilton commutativity applies only to $\Omega^2$-loops:
2-cells whose source and target are both $\refl\;a$.
It does not extend to a braiding on arbitrary 1-cells.
The correct structure on 1-cells is that $\sym$ induces an
\emph{anti-involution} on the path monoid:
\[
  \sym(\trs\;p\;q) \;\xleftrightarrow{\;\Step\;}\;
  \trs(\sym\;q,\;\sym\;p).
\]
This is Rule~7 ($\mathsf{symm\_trans\_congr}$), a
\emph{contravariance} law reversing the order of factors.
An anti-involution satisfies $(xy)^{-1} = y^{-1} x^{-1}$ and
$(x^{-1})^{-1} = x$, which are the laws of a $*$-algebra or
dagger category, not a braided monoidal category.
In particular, the path groupoid on a non-simply-connected type
is non-abelian at dimension~1, and the anti-involution does not
equip it with a symmetric braiding.
\end{remark}

\subsection{Triangle coherence}\label{subsec:triangle}

The triangle identity relates the associator to the unit laws.

\begin{theorem}[Triangle coherence]\label{thm:triangle}
For composable $p : \Path\;a\;b$ and $q : \Path\;b\;c$, the two
canonical routes from
$(p \cmpA \refl_b) \cmpA q$ to $p \cmpA q$ yield the same
underlying equality.
Explicitly, defining:
\begin{align*}
  T_1 &\;\triangleq\; \RwEq.\trs\big(
    \underbrace{\alpha_{p,\,\refl_b,\,q}}_{\text{Rule 8}},\;
    \underbrace{p \wl (\lambda_q)}_{\text{Rules 64+3}}
  \big)
  \;:\; \RwEq\;((p \cmpA \refl_b) \cmpA q)\;(p \cmpA q), \\
  T_2 &\;\triangleq\;
    \underbrace{(\rho_p) \wr q}_{\text{Rules 63+4}}
  \;:\; \RwEq\;((p \cmpA \refl_b) \cmpA q)\;(p \cmpA q),
\end{align*}
where $\lambda_q : \RwEq\;(\trs\;\refl_b\;q)\;q$ is the left unitor
(Rule~3) and $\rho_p : \RwEq\;(\trs\;p\;\refl_b)\;p$ is the right
unitor (Rule~4), we have
$\mathsf{rweq\_toEq}(T_1) = \mathsf{rweq\_toEq}(T_2)$.
\end{theorem}

\begin{proof}
Route $T_1$ applies associativity (Rule~8) to obtain
$p \cmpA (\refl_b \cmpA q)$, then applies the left unit law
(Rule~3) inside the right factor via congruence (Rule~64).
Route $T_2$ applies the right unit law (Rule~4) to the left factor
via congruence (Rule~63), reducing $(p \cmpA \refl_b)$ to $p$.
Both are $\RwEq$ witnesses whose $\mathsf{toEq}$ projections
coincide by $\mathsf{rfl}$.
\end{proof}

\subsection{Inverse coherences}\label{subsec:inverse-coherence}

The interaction of $\sym$ with $\trs$ and $\refl$ is governed by
several coherence laws, each constructed as an explicit $\Step$
chain.

\begin{theorem}[Double inverse]\label{thm:symm-symm}
For every $p : \Path\;a\;b$:
\[
  \RwEq\;(\sym(\sym(p)))\;p,
\]
constructed as
$\RwEq.\mathsf{step}(\Step.\mathsf{symm\_symm}\;p)$ (Rule~2).
\end{theorem}

\begin{theorem}[Inverse of composition]\label{thm:symm-trans}
For composable $p : \Path\;a\;b$ and $q : \Path\;b\;c$:
\[
  \RwEq\;(\sym(\trs\;p\;q))\;(\trs(\sym\;q,\;\sym\;p)),
\]
constructed as
$\RwEq.\mathsf{step}(\Step.\mathsf{symm\_trans\_congr}\;p\;q)$
(Rule~7).
This is the contravariance law: inversion reverses the order
of composition.
\end{theorem}

\begin{theorem}[Left cancellation]\label{thm:trans-symm-left}
For every $p : \Path\;a\;b$:
\[
  \RwEq\;(\trs(\sym\;p,\;p))\;(\refl\;b),
\]
constructed as
$\RwEq.\mathsf{step}(\Step.\mathsf{symm\_trans}\;p)$ (Rule~6).
\end{theorem}

\begin{theorem}[Right cancellation]\label{thm:trans-symm-right}
For every $p : \Path\;a\;b$:
\[
  \RwEq\;(\trs(p,\;\sym\;p))\;(\refl\;a),
\]
constructed as
$\RwEq.\mathsf{step}(\Step.\mathsf{trans\_symm}\;p)$ (Rule~5).
\end{theorem}

\begin{theorem}[Inverse coherence]\label{thm:inverse-coherence}
For every $p : \Path\;a\;b$, the two cancellation routes from
$(p \cmpA p^{-1}) \cmpA p$ to $p$ agree after projection:
\begin{align*}
  R_1 &\;\triangleq\;
    \alpha_{p,\,p^{-1},\,p} \;\vcomp\;
    (p \wl \mathsf{inv\_left}(p)) \;\vcomp\;
    \rho_p, \\
  R_2 &\;\triangleq\;
    (\mathsf{inv\_right}(p) \wr p) \;\vcomp\;
    \lambda_p,
\end{align*}
satisfy $\mathsf{rweq\_toEq}(R_1) = \mathsf{rweq\_toEq}(R_2)$.
\end{theorem}

\begin{proof}
Route $R_1$ first associates to $p \cmpA (p^{-1} \cmpA p)$,
applies left cancellation in the right factor, then removes
the resulting unit on the right.
Route $R_2$ applies right cancellation in the left factor, then
removes the unit on the left.
Both are explicit $\RwEq$ composites using Rules~5, 6, 8, 3, 4,
63, and 64.
The projected equalities coincide by $\mathsf{rfl}$.
\end{proof}

\begin{theorem}[Contravariance coherence]\label{thm:contravariance}
For composable $p, q, r$, the two decompositions of
$(p \cmpA (q \cmpA r))^{-1}$ into
$(r^{-1} \cmpA q^{-1}) \cmpA p^{-1}$---one applying Rule~7 to the
outer composite first, the other to the inner composite first---yield
the same projected equality.
\end{theorem}

\begin{proof}
Both routes are composites of Rules~7 (contravariance) and~63/64
(congruence closure).
Their $\mathsf{toEq}$ projections coincide by $\mathsf{rfl}$.
\end{proof}

\subsection{Naturality}\label{subsec:naturality}

Each groupoid operation induces a natural transformation between
path spaces, and the naturality squares commute.

\begin{proposition}[Naturality of the left unitor]\label{prop:unitor-left-nat}
For every $\alpha : \RwEq\;p\;q$ where $p, q : \Path\;a\;b$,
the following square commutes at the $\RwEqProp$ level:
\[
\begin{tikzcd}
  \trs(\refl_a,\,p) \ar[r, "{\refl_a \wl \alpha}"]
    \ar[d, "{\lambda_p}"'] &
  \trs(\refl_a,\,q) \ar[d, "{\lambda_q}"] \\
  p \ar[r, "\alpha"'] & q
\end{tikzcd}
\]
That is,
$\langle \lambda_p \vcomp \alpha \rangle =
 \langle (\refl_a \wl \alpha) \vcomp \lambda_q \rangle$
as elements of $\RwEqProp$.
\end{proposition}

\begin{proof}
Both composites are $\RwEq$ witnesses with the same source and target.
Their $\RwEqProp$ (i.e., $\mathsf{Nonempty}(\RwEq\;\cdot\;\cdot)$) values
are equal by $\mathsf{Subsingleton.elim}$ on $\Prop$.
\end{proof}

\begin{proposition}[Naturality of the right unitor]\label{prop:unitor-right-nat}
Analogously, for $\alpha : \RwEq\;p\;q$:
\[
\begin{tikzcd}
  \trs(p,\,\refl_b) \ar[r, "{\alpha \wr \refl_b}"]
    \ar[d, "{\rho_p}"'] &
  \trs(q,\,\refl_b) \ar[d, "{\rho_q}"] \\
  p \ar[r, "\alpha"'] & q
\end{tikzcd}
\]
commutes at the $\RwEqProp$ level.
\end{proposition}

\begin{proposition}[Naturality of the associator]\label{prop:assoc-nat}
For 2-cells $\alpha : \RwEq\;p\;p'$, $\beta : \RwEq\;q\;q'$,
$\gamma : \RwEq\;r\;r'$, the associator is natural in all three
variables: the evident cube of $\RwEq$ witnesses commutes at the
$\RwEqProp$ level.
\end{proposition}

\begin{proposition}[Contravariance of $\sym$]\label{prop:symm-contravariant}
The operation $\sym$ is contravariantly functorial with respect to
$\trs$: given $\alpha : \RwEq\;p\;p'$, the induced
$\RwEq\;(\sym\;p)\;(\sym\;p')$ respects composition in the sense that
$\sym(\alpha \vcomp \beta) = (\sym\;\beta) \vcomp (\sym\;\alpha)$
at the $\RwEqProp$ level.
\end{proposition}

\begin{proposition}[Functoriality of $\mathsf{congrArg}$]%
\label{prop:congrArg-functorial}
For any function $f : A \to B$:
\begin{enumerate}[nosep]
  \item $\mathsf{congrArg}\;f$ preserves $\trs$:
    $\mathsf{congrArg}\;f\;(\trs\;p\;q) =
     \trs(\mathsf{congrArg}\;f\;p,\;\mathsf{congrArg}\;f\;q)$
    up to $\RwEq$.
  \item $\mathsf{congrArg}\;f$ preserves $\sym$:
    $\mathsf{congrArg}\;f\;(\sym\;p) =
     \sym(\mathsf{congrArg}\;f\;p)$
    up to $\RwEq$.
  \item $\mathsf{congrArg}\;f$ preserves $\refl$:
    $\mathsf{congrArg}\;f\;(\refl\;a) = \refl\;(f\;a)$
    up to $\RwEq$.
\end{enumerate}
That is, $\mathsf{congrArg}\;f$ is a groupoid functor from the
path groupoid of $A$ to the path groupoid of $B$.
\end{proposition}


% ======================================================================
\section{Two-Categorical Structure}\label{sec:twocat}
% ======================================================================

\subsection{The 2-category of types and paths}\label{subsec:2cat-paths}

The coherence data of \S\ref{sec:coherence} endows the universe of types
with a 2-categorical structure.
We describe two instances: a \emph{strict} 2-category of types and
functions, and a \emph{weak} 2-category (bicategory) of types and
computational paths.

\begin{definition}[Strict 2-category of types and functions]%
\label{def:strict-2cat}
The strict 2-category $\mathcal{C}_{\mathrm{strict}}$ has:
\begin{itemize}[nosep]
  \item \textbf{0-cells}: types $A : \Ty\;u$.
  \item \textbf{1-cells}: functions $f : A \to B$.
  \item \textbf{2-cells}: $\mathsf{PLift}(f = g) : \Ty\;0$,
    the propositional equality of functions lifted from $\Prop$ to
    $\Ty$.
\end{itemize}
Composition of 1-cells is function composition $g \circ f$;
it is strictly associative and unital.
Vertical composition of 2-cells is transitivity of $\Eq$:
$\langle \alpha \rangle \vcomp \langle \beta \rangle
 = \langle \alpha.\mathsf{trans}\;\beta \rangle$.
Horizontal composition (Godement product) is:
$\langle \alpha \rangle \hcomp \langle \beta \rangle
 = \langle \alpha \mathbin{\triangleright} \beta \mathbin{\triangleright} \mathsf{rfl} \rangle$,
where $\alpha \mathbin{\triangleright} \beta$ denotes the congruence
$g \circ f = g' \circ f'$ derived from $f = f'$ and $g = g'$.
\end{definition}

\begin{theorem}[Strict 2-category instance]\label{thm:strict-2cat}
The data of Definition~\ref{def:strict-2cat} satisfies the axioms
of a strict 2-category:
\begin{enumerate}[nosep]
  \item Strict associativity and unit laws for 1-cells
    (definitional in Lean~4).
  \item Associativity and unit laws for vertical 2-cell composition.
  \item Functoriality of horizontal composition: identity 2-cells
    compose horizontally to identity 2-cells.
  \item The interchange law
    $(\alpha_1 \vcomp \alpha_2) \hcomp (\beta_1 \vcomp \beta_2)
     = (\alpha_1 \hcomp \beta_1) \vcomp (\alpha_2 \hcomp \beta_2)$.
\end{enumerate}
\end{theorem}

\begin{proof}
All four axiom classes are discharged by the observation that
$\mathsf{PLift}(f = g)$ is a subsingleton: any two 2-cells between
the same 1-cells are equal.
In the formalization, this is the function
$\mathsf{plift\_eq\_subsingleton}$, and each axiom reduces to
$\mathsf{rfl}$ after case-splitting on $\mathsf{PLift}$.
\end{proof}

\begin{theorem}[Godement interchange]\label{thm:godement}
In $\mathcal{C}_{\mathrm{strict}}$, the two orders of composing a
$2 \times 2$ grid of 2-cells yield the same result:
\[
  (\alpha_1 \vcomp \alpha_2) \hcomp (\beta_1 \vcomp \beta_2)
  \;=\;
  (\alpha_1 \hcomp \beta_1) \vcomp (\alpha_2 \hcomp \beta_2).
\]
\end{theorem}

\begin{proof}
Both sides are elements of $\mathsf{PLift}(g' \circ f' = g'' \circ f'')$,
which is a subsingleton.
\end{proof}

\begin{definition}[Weak 2-category of types and paths]%
\label{def:weak-2cat}
The weak 2-category (bicategory) $\mathcal{C}_{\mathrm{path}}$ has:
\begin{itemize}[nosep]
  \item \textbf{0-cells}: types $A : \Ty\;u$.
  \item \textbf{1-cells}: computational paths $p : \Path\;a\;b$.
  \item \textbf{2-cells}: $\RwEq\;p\;q : \Ty\;u$.
\end{itemize}
Horizontal composition is $\trs$; vertical composition is
$\RwEq.\trs$.
The associator and unitors are the $\RwEq$ witnesses of
\S\ref{sec:coherence}: $\alpha_{p,q,r}$, $\lambda_p$, $\rho_p$.
The pentagon and triangle identities
(Theorems~\ref{thm:pentagon} and~\ref{thm:triangle}) verify that
$\mathcal{C}_{\mathrm{path}}$ satisfies the bicategory axioms
at the $\mathsf{toEq}$ level.
\end{definition}

\begin{proposition}[Whiskering naturality]\label{prop:whisk-nat}
For 2-cells $\alpha : \RwEq\;p\;p'$ and $\beta : \RwEq\;q\;q'$,
the two whiskering orders satisfy the naturality square:
\[
  (p \wl \beta) \vcomp (\alpha \wr q')
  \;=_{\RwEqProp}\;
  (\alpha \wr q) \vcomp (p' \wl \beta).
\]
This is the statement that $\alpha \hcomp \beta = \alpha \hcompp \beta$
at the $\RwEqProp$ level
(cf.\ Definition~\ref{def:hcomp}).
\end{proposition}

\subsection{Enrichment and internal hom}\label{subsec:enrichment}

The path space $\Path\;a\;b$ with its $\RwEq$-equivalence classes
serves as the hom-object of an enriched category.

\begin{definition}[Path-enriched hom]\label{def:path-hom}
For a fixed type $A$, the \emph{path hom-space} between $a, b : A$ is
the quotient
$\mathsf{PathRwQuot}\;A\;a\;b \triangleq \mathsf{Quot}(\RwEqProp)$,
where $\RwEqProp\;p\;q \triangleq \mathsf{Nonempty}(\RwEq\;p\;q) : \Prop$.
Composition $\trs$ and inversion $\sym$ descend to the quotient because
$\RwEq$ is a congruence for both operations
(Proposition~\ref{prop:congr}).
\end{definition}

\begin{proposition}[Groupoid enrichment]\label{prop:enrichment}
The quotient hom-spaces $\mathsf{PathRwQuot}\;A\;a\;b$ form the
hom-sets of a groupoid $\Pi_1^{\mathrm{cp}}(A)$---the
\emph{computational-path fundamental groupoid}.
Composition is strictly associative and unital on the quotient;
every morphism has a strict inverse.
This is the 1-truncation of the full $\omega$-groupoid structure
developed in \S\ref{sec:omega}.
\end{proposition}

\begin{remark}[Connection to $\infty$-categories]\label{rem:infty-cat}
Before taking the quotient, the untruncated path space carries a
richer structure.
The tower
$A,\; \Path,\; \RwEq,\; \mathsf{Derivation}_3,\; \ldots$
(Definition~\ref{def:cell-tower} below) is the computational-path
analogue of the Kan complex or quasi-category presenting the
$\infty$-groupoid of a type.
The enrichment perspective says that the hom-objects are themselves
$(\infty, 0)$-categories (i.e., $\infty$-groupoids), making the
resulting structure an $(\infty, 1)$-category with all morphisms
invertible---in other words, an $\infty$-groupoid.
This connection is made precise by the weak $\omega$-groupoid theorem
of the next section.
\end{remark}


% ======================================================================
\section{The Weak $\omega$-Groupoid Theorem}\label{sec:omega}
% ======================================================================

\subsection{The cell tower}\label{subsec:cell-tower}

We define the globular set of cells at each dimension, following the
pattern of Lumsdaine~\cite{Lumsdaine2010} and van den
Berg--Garner~\cite{vdBG2011} but using the computational-path
rewriting system in place of the identity type eliminator.

\begin{definition}[Cell tower]\label{def:cell-tower}
Let $A : \Ty\;u$.
The \emph{cell tower} is a sequence of types indexed by dimension:
\begin{align*}
  \mathsf{Cell}_0 &\;\triangleq\; A \\
  \mathsf{Cell}_1(a, b) &\;\triangleq\; \Path\;a\;b
    \quad\text{for } a, b : A \\
  \mathsf{Cell}_2(p, q) &\;\triangleq\; \mathsf{Derivation}_2\;p\;q
    \quad\text{for } p, q : \Path\;a\;b \\
  \mathsf{Cell}_3(d_1, d_2) &\;\triangleq\; \mathsf{Derivation}_3\;d_1\;d_2
    \quad\text{for } d_1, d_2 : \mathsf{Derivation}_2\;p\;q \\
  \mathsf{Cell}_4(m_1, m_2) &\;\triangleq\; \mathsf{Derivation}_4\;m_1\;m_2
    \quad\text{for } m_1, m_2 : \mathsf{Derivation}_3\;d_1\;d_2 \\
  \mathsf{Cell}_{n+4}(c_1, c_2) &\;\triangleq\;
    \mathsf{DerivationHigh}\;n\;c_1\;c_2
\end{align*}
Each $\mathsf{Cell}_n$ depends on a pair of parallel
$(n{-}1)$-cells, giving the data a \emph{globular} shape: the source
and target maps $s, t : \mathsf{Cell}_n \to \mathsf{Cell}_{n-1}$
satisfy $s \circ s = s \circ t$ and $t \circ s = t \circ t$.
\end{definition}

\begin{definition}[Derivation$_2$]\label{def:derivation2}
The type $\mathsf{Derivation}_2\;p\;q$ is a $\Ty\;u$-valued type of
2-cells between parallel paths.
Its constructors mirror those of $\RwEq$ but carry the full
derivation trace:
\begin{align*}
  &\mathsf{Derivation}_2.\refl(p) : \mathsf{Derivation}_2\;p\;p \\
  &\mathsf{Derivation}_2.\mathsf{step}(s) :
    \Step\;p\;q \to \mathsf{Derivation}_2\;p\;q \\
  &\mathsf{Derivation}_2.\mathsf{inv}(d) :
    \mathsf{Derivation}_2\;p\;q \to \mathsf{Derivation}_2\;q\;p \\
  &\mathsf{Derivation}_2.\mathsf{vcomp}(d_1, d_2) :
    \mathsf{Derivation}_2\;p\;q \to \mathsf{Derivation}_2\;q\;r
    \to \mathsf{Derivation}_2\;p\;r
\end{align*}
The function $\mathsf{Derivation}_2.\mathsf{toRwEq}$ projects a
derivation to the underlying $\RwEq$ witness by forgetting the trace
structure.
\end{definition}

\begin{definition}[MetaStep$_3$ and Derivation$_3$]\label{def:derivation3}
The type $\mathsf{MetaStep}_3\;d_1\;d_2$ captures the elementary
\emph{meta-steps} between derivations: groupoid law rewrites at
dimension~2 applied to derivation structure.
Its constructors include:
\begin{itemize}[nosep]
  \item $\mathsf{vcomp\_assoc}$ (associativity of vertical composition),
  \item $\mathsf{vcomp\_refl\_left}$, $\mathsf{vcomp\_refl\_right}$
    (unit laws),
  \item $\mathsf{vcomp\_inv\_left}$, $\mathsf{vcomp\_inv\_right}$
    (inverse laws),
  \item $\mathsf{inv\_inv}$ (double inverse),
  \item $\mathsf{inv\_vcomp}$ (contravariance of inverse over composition),
  \item $\mathsf{step\_eq}$ (two single-step derivations with the same
    endpoints are connected),
  \item $\mathsf{interchange}$ (the interchange law for horizontal
    composition of derivations),
  \item $\mathsf{pentagon}$, $\mathsf{triangle}$ (higher coherences),
  \item $\mathsf{rweq\_transport}$ (two derivations whose $\RwEq$
    projections have equal $\mathsf{rweq\_toEq}$ images are connected).
\end{itemize}
The type $\mathsf{Derivation}_3$ is the reflexive-transitive-symmetric
closure of $\mathsf{MetaStep}_3$, with constructors $\refl$, $\mathsf{step}$,
$\mathsf{inv}$, $\mathsf{vcomp}$, and whiskering operators
$\mathsf{whiskerLeft}_3$, $\mathsf{whiskerRight}_3$.
\end{definition}

The cell tower carries groupoid operations at each level:
composition, identity, and inverse at level~$n$ yield $(n{+}1)$-cell
coherence witnesses.

\begin{proposition}[Groupoid operations at each level]\label{prop:level-ops}
At each level $n \ge 1$, the cell tower carries:
\begin{itemize}[nosep]
  \item \textbf{Identity}: $\mathsf{id}_n(c) : \mathsf{Cell}_n(c, c)$.
  \item \textbf{Composition}: $\mathsf{comp}_n(c_1, c_2) :
    \mathsf{Cell}_n(a, b) \to \mathsf{Cell}_n(b, c) \to
    \mathsf{Cell}_n(a, c)$.
  \item \textbf{Inverse}: $\mathsf{inv}_n(c) :
    \mathsf{Cell}_n(a, b) \to \mathsf{Cell}_n(b, a)$.
  \item \textbf{Coherence witnesses} at level $n + 1$:
    $(n{+}1)$-cells witnessing associativity, unit laws, and
    inverse laws for the level-$n$ operations.
\end{itemize}
At level~1, these are $\Step$ constructors (Rules~3--8).
At level~2, these are $\mathsf{MetaStep}_3$ constructors.
At level~$n \ge 3$, these are analogous meta-step constructors at the
appropriate dimension.
\end{proposition}

\subsection{Batanin--Leinster conditions}\label{subsec:batanin-leinster}

A \emph{weak $\omega$-groupoid} in the sense of
Batanin~\cite{Batanin1998} and Leinster~\cite{Leinster2004} is a
globular set equipped with composition operations at each dimension,
subject to coherence conditions encoded by a contractible globular
operad.
The key conditions, adapted to our setting, are:

\begin{enumerate}[label=(BL\arabic*),nosep]
  \item\label{BL1} \textbf{Globular structure.}
    The cell tower forms a globular set: source and target maps
    satisfy $s \circ s = s \circ t$ and $t \circ s = t \circ t$.
    \emph{Status: verified} by the typing discipline of
    $\mathsf{Cell}_n$.

  \item\label{BL2} \textbf{Composition.}
    At each dimension $n$, there is a composition operation on
    $n$-cells with matching $(n{-}1)$-boundaries.
    \emph{Status: verified} at all levels via
    $\trs$ (level~1), $\mathsf{vcomp}$ (level~2),
    $\mathsf{Derivation}_3.\mathsf{vcomp}$ (level~3), and
    analogous constructors at higher levels.

  \item\label{BL3} \textbf{Identities.}
    At each dimension $n$, there is an identity $n$-cell on each
    $(n{-}1)$-cell.
    \emph{Status: verified} via
    $\refl$ (level~1), $\mathsf{Derivation}_2.\refl$ (level~2),
    $\mathsf{Derivation}_3.\refl$ (level~3), etc.

  \item\label{BL4} \textbf{Inverses.}
    At each dimension $n$, every $n$-cell has a weak inverse.
    \emph{Status: verified} via
    $\sym$ (level~1), $\mathsf{Derivation}_2.\mathsf{inv}$ (level~2),
    $\mathsf{Derivation}_3.\mathsf{inv}$ (level~3), etc.

  \item\label{BL5} \textbf{Coherence at dimension 2.}
    The pentagon and triangle identities hold for the composition
    at dimension~1.
    \emph{Status: verified} by Theorems~\ref{thm:pentagon}
    and~\ref{thm:triangle}, with explicit $\mathsf{Derivation}_3$
    witnesses $\mathsf{pentagonCoherence}$ and
    $\mathsf{triangleCoherence}$.

  \item\label{BL6} \textbf{Interchange.}
    Horizontal and vertical composition of 2-cells satisfy the
    interchange law.
    \emph{Status: verified} by Theorem~\ref{thm:interchange} and the
    $\mathsf{MetaStep}_3.\mathsf{interchange}$ constructor.

  \item\label{BL7} \textbf{Contractibility at dimension $\ge 3$.}
    For $n \ge 3$, the space of $n$-cells between any two parallel
    $(n{-}1)$-cells is inhabited: any two parallel cells at
    dimension $\ge 2$ can be connected by a cell one dimension higher.
    \emph{Status: verified} by
    Theorem~\ref{thm:contract} below.
\end{enumerate}

Conditions \ref{BL1}--\ref{BL6} constitute the ``algebraic'' part
of the weak $\omega$-groupoid structure.
Condition \ref{BL7} is the ``contractibility'' part, which in
Batanin's framework is encoded by the contractibility of the
globular operad governing the higher coherences.
It is this condition that makes the structure ``weak'' rather than
strict: the higher coherences are not identities but merely
inhabitants, and contractibility ensures that the space of such
inhabitants is connected.

\subsection{Contractibility from confluence}\label{subsec:contractibility}

The central theorem of the paper: Church--Rosser confluence of the
step rewriting system implies contractibility of the cell tower at
dimension $\ge 3$.

\begin{theorem}[Contractibility at dimension $\ge 3$]%
\label{thm:contract}
\leavevmode
\begin{enumerate}[nosep]
  \item \textbf{Level 3.}
    For any parallel 2-cells
    $d_1, d_2 : \mathsf{Derivation}_2\;p\;q$,
    there exists a 3-cell
    $m : \mathsf{Derivation}_3\;d_1\;d_2$.
  \item \textbf{Level 4.}
    For any parallel 3-cells
    $m_1, m_2 : \mathsf{Derivation}_3\;d_1\;d_2$,
    there exists a 4-cell
    $n : \mathsf{Derivation}_4\;m_1\;m_2$.
  \item \textbf{Level $\ge 5$.}
    For any $n \ge 5$ and parallel $(n{-}1)$-cells $c_1, c_2$,
    there exists an $n$-cell connecting them.
\end{enumerate}
\end{theorem}

\begin{proof}
We give the argument at level~3 in detail; the higher levels follow
by the same pattern.

\medskip
\noindent\textbf{Step 1: Normalization via groupoid laws.}
Every 2-cell $d : \mathsf{Derivation}_2\;p\;q$ is connected to a
\emph{canonical representative} $\mathsf{normalize}(d)$ by a 3-cell
$\mathsf{to\_normal\_form}_3(d) : \mathsf{Derivation}_3\;d\;(\mathsf{normalize}(d))$.
The normalization is a real two-phase pipeline implemented in the
\texttt{Normalizer} module:
\begin{enumerate}[nosep]
  \item \textbf{Flatten}: convert the $\mathsf{Derivation}_2$ tree into a
        right-associated $\mathsf{FlatChain}$ of signed steps.
  \item \textbf{Reduce}: cancel adjacent inverse pairs to produce an
        $\mathsf{IsReduced}$ chain (the normal form).
\end{enumerate}
Each rewriting step is witnessed by a $\mathsf{Derivation}_3$ cell
built from the groupoid-law constructors of $\mathsf{MetaStep}_3$:
\begin{itemize}[nosep]
  \item $\mathsf{vcomp\_refl\_left}$, $\mathsf{vcomp\_refl\_right}$
        (absorb identity cells)
  \item $\mathsf{vcomp\_assoc}$ (re-associate compositions)
  \item $\mathsf{inv\_inv}$ (cancel double inverses)
  \item $\mathsf{inv\_vcomp}$ (distribute inverses over composition)
  \item $\mathsf{vcomp\_inv\_left}$, $\mathsf{vcomp\_inv\_right}$
        (cancel inverse pairs)
  \item $\mathsf{whisker\_inv}_3$ (inversion under whiskering)
  \item $\mathsf{vcomp\_congr}_{3,\mathrm{left}}$,
        $\mathsf{vcomp\_congr}_{3,\mathrm{right}}$
        (congruence for vertical composition)
\end{itemize}
The normalization step itself uses no custom axioms.
$\mathsf{Step}$ is $\Prop$-valued, so its proof irrelevance is
inherited from Lean's kernel.  The construction
is structural: it normalizes the free-groupoid word represented
by $d$ into right-associated, reduced form.

\medskip
\noindent\textbf{Step 2: Connecting canonical forms.}
Given two derivations $d_1, d_2 : \mathsf{Derivation}_2\;p\;q$,
the canonical forms $\mathsf{normalize}(d_1)$ and
$\mathsf{normalize}(d_2)$ are connected by:
\[
  \mathsf{connect\_normalized} :
  \mathsf{Derivation}_3\;(\mathsf{normalize}(d_1))\;(\mathsf{normalize}(d_2))
\]
This connector uses two additional $\mathsf{MetaStep}_3$ constructors:
\begin{itemize}[nosep]
  \item $\mathsf{step\_eq}(s_1, s_2)$: identifies any two steps
        $s_1, s_2 : \mathsf{Step}\;p\;q$ between the same endpoints.
        Since $\mathsf{Step}$ is proof-irrelevant (Prop-valued in
        the formalization), this reflects that the ``reason'' for
        a rewrite step is immaterial---only the endpoints matter.
  \item $\mathsf{diamond\_filler}(s_1, s_2, j_1, j_2)$: the Squier
        filler for confluence diamonds.  Given diverging steps
        $s_1 : p \to q$ and $s_2 : p \to r$ that rejoin via
        $j_1 : q \twoheadrightarrow m$ and $j_2 : r \twoheadrightarrow m$,
        this provides a 3-cell witnessing commutativity of the diamond.
\end{itemize}
The $\mathsf{diamond\_filler}$ is \emph{not} a blanket axiom
connecting arbitrary derivations; it only connects the specific
pairs of paths arising from actual confluence diamonds in the
step rewriting system.  This is the key insight of Squier's
theorem~\cite{Squier1987}: when the monoid (here, groupoid)
presentation has finitely many critical pairs, the homotopy
type of the derivation space is determined by finitely many
diamond fillers.

\medskip
\noindent\textbf{Step 3: Composing the connections.}
The contractibility witness is the composite:
\begin{align*}
  \mathsf{contractibility}_3(d_1, d_2) \;\triangleq\;\;
  &\mathsf{Derivation}_3.\mathsf{vcomp}\big(
      \mathsf{to\_normal\_form}_3(d_1), \\
  &\quad \mathsf{Derivation}_3.\mathsf{vcomp}\big(
      \mathsf{connect\_normalized}(\mathsf{normalize}(d_1),
                                    \mathsf{normalize}(d_2)), \\
  &\qquad \mathsf{Derivation}_3.\mathsf{inv}(
      \mathsf{to\_normal\_form}_3(d_2))\big)\big)
\end{align*}
This explicitly factors through canonical forms: $d_1$ is
connected to its normal form, the normal forms are connected,
and we return to $d_2$ via the inverse bridge.

\medskip
\noindent\textbf{Levels 4 and above.}
At level~4, parallel 3-cells $m_1, m_2 : \mathsf{Derivation}_3\;d_1\;d_2$
are connected by a 4-cell via $\mathsf{MetaStep}_4.\mathsf{diamond\_filler}$.
At level $n \ge 5$, the constructor
$\mathsf{DerivationHigh.step}(\mathsf{MetaStepHigh.diamond\_filler})$
provides the required cell.
The pattern is uniform: at each level, contractibility is obtained
by normalizing to canonical form and filling confluence diamonds.
\end{proof}

\begin{remark}[Non-collapse at level 2]\label{rem:non-collapse}
Contractibility does \emph{not} hold at level~2.
Two parallel paths $p, q : \Path\;a\;b$ with different step lists may
have no $\RwEq$ witness connecting them.
For instance, the two generators of the fundamental group of the
circle are distinct paths with no rewrite derivation between them.
If level~2 were contractible, the fundamental groupoid would be
trivial---contradicting the non-trivial homotopy theory that the
framework is designed to capture.
The cell tower is therefore genuinely \emph{2-truncated}: it carries
non-trivial information at levels~0, 1, and~2, and becomes
contractible from level~3 onward.
\end{remark}

\begin{remark}[The Squier program: $\mathsf{step\_eq}$, $\mathsf{diamond\_filler}$, and proof irrelevance]%
\label{rem:rweq-eq-honesty}
The contractibility theorem realizes the \emph{Squier program} for
computational paths.  Squier's theorem~\cite{Squier1987} states that
a finitely presented monoid has decidable word problem if and only if
its derivation complex is finite-dimensional.  The analogous result
for groupoid presentations says that when a presentation is
\emph{complete} (confluent and terminating), the 2-dimensional
derivation space is contractible, with the contraction witnessed by
explicit fillers for confluence diamonds.

In our setting:
\begin{itemize}[nosep]
  \item The \emph{step rewriting system} (the $\mathsf{Step}$ relation)
        is the presentation of the free groupoid on computational paths.
  \item The \emph{diamond fillers} ($\mathsf{MetaStep}_3.\mathsf{diamond\_filler}$)
        correspond to the 3-cells filling each critical pair.
  \item The \emph{groupoid-law constructors} of $\mathsf{MetaStep}_3$
        (associativity, unit laws, inverse laws) provide the structural
        normalization steps.
\end{itemize}

\smallskip
\noindent\textbf{Key achievement: $\mathsf{Subsingleton.elim}$-free structured contractibility.}
The contractibility proof operates at two levels:

\smallskip\noindent\textit{Level~3 ($\mathsf{contractibility}_3$, connecting parallel 2-cells):}
\begin{enumerate}[nosep]
  \item \textbf{Groupoid-law rewrites}: $\mathsf{vcomp\_refl\_left}$,
        $\mathsf{vcomp\_refl\_right}$, $\mathsf{vcomp\_assoc}$,
        $\mathsf{inv\_inv}$, $\mathsf{vcomp\_inv\_left}$,
        $\mathsf{vcomp\_inv\_right}$, $\mathsf{inv\_vcomp}$,
        $\mathsf{whisker\_inv}_3$,
        $\mathsf{vcomp\_congr}_{3,\mathrm{left}}$,
        $\mathsf{vcomp\_congr}_{3,\mathrm{right}}$.
  \item \textbf{Step coherence} ($\mathsf{step\_eq}$): identifies
        any two steps between the same endpoints, reflecting
        proof-irrelevance of the $\mathsf{Step}$ relation itself.
  \item \textbf{Definitional transport} ($\mathsf{rweq\_transport}$):
        connects normalized forms whose $\mathsf{toEq}$ projections agree.
        The proof obligation $\mathsf{derivation_2\_toEq\_eq}$
        is discharged by $\mathsf{rfl}$ (definitional equality in Lean's kernel),
        \emph{not} by $\mathsf{Subsingleton.elim}$.
\end{enumerate}

\smallskip\noindent\textit{Levels~4+ ($\mathsf{contractibility}_4$, $\mathsf{contractibilityHigh}$):}
\begin{enumerate}[nosep]
  \item \textbf{Normalization}: higher cells are normalized via
        $\mathsf{normalize}_3$, $\mathsf{normalize}_4$.
  \item \textbf{Squier-style diamond fillers} ($\mathsf{diamond\_filler}$):
        connect normalized higher cells across confluence diamonds.
\end{enumerate}

\smallskip
This achieves contractibility at dimension~$\ge 3$ as a
\emph{structured consequence} of normalization and the groupoid laws.  The $\mathsf{step\_eq}$ constructor
relies on $\mathsf{Step}$ being $\Prop$-valued (hence proof-irrelevant),
and the $\mathsf{rweq\_transport}$ constructor's proof obligation
reduces to $\mathsf{rfl}$ because all $\mathsf{Derivation}_2$ inhabitants
between the same endpoints project to the same $\Eq$ witness definitionally.
No invocation of $\mathsf{Subsingleton.elim}$ appears in the
contractibility proof.
The formalization validates this claim: the $\mathsf{contractibility}_3$
function builds explicit 3-cells from the constructors above, with
$\mathsf{diamond\_filler}$ used only where genuine confluence diamonds
occur.

\smallskip
\noindent\textbf{The constrained $\mathsf{diamond\_filler}$.}
Unlike the blanket $\mathsf{rweq\_transport}$, the $\mathsf{diamond\_filler}$
constructor is \emph{constrained}: it requires explicit diverging steps
$s_1 : \Step\;p\;q$, $s_2 : \Step\;p\;r$ together with explicit
joining chains $j_1 : \mathsf{StepStar}\;q\;m$, $j_2 : \mathsf{StepStar}\;r\;m$,
and it only connects the two derivations that arise from a genuine
confluence diamond:
\[
  \mathsf{vcomp}(\mathsf{step}\;s_1, \mathsf{derivation\_2\_of\_stepstar}\;j_1)
  \quad\longleftrightarrow\quad
  \mathsf{vcomp}(\mathsf{step}\;s_2, \mathsf{derivation\_2\_of\_stepstar}\;j_2)
\]
Each of the 33 critical pairs of the completed groupoid TRS generates
exactly one such diamond-filler 3-cell.  This directly implements
Squier's finite derivation type (FDT) criterion.

\smallskip
\noindent\textbf{Summary.}
The resulting structure is a \emph{weak 2-groupoid with contractible
higher cells}: genuinely non-degenerate at levels 0--2 (where the TRS
provides real structure), and contractible from level~3 onward.
Unlike the Lumsdaine and van den Berg--Garner
constructions~\cite{Lumsdaine2010,vdBG2011}, which produce genuinely
non-degenerate structure at all levels in intensional MLTT, our
construction is necessarily different: we build \emph{on top of} a
UIP foundation, and the higher-dimensional collapse is achieved via
groupoid-law normalization
($\mathsf{IsReduced}$, $\mathsf{normalize}$,
$\mathsf{to\_normal\_form}_3$), the $\mathsf{rweq\_transport}$
constructor at level~3 whose proof obligation is definitional ($\mathsf{rfl}$),
and Squier-style $\mathsf{diamond\_filler}$ cells at levels~4 and above.
No use of $\mathsf{Subsingleton.elim}$ is required.
\end{remark}

\begin{remark}[Comparison with Lumsdaine and van den Berg--Garner]%
\label{rem:lumsdaine-vdBG}
Lumsdaine~\cite{Lumsdaine2010} and van den Berg--Garner~\cite{vdBG2011}
proved that the identity types of intensional Martin-L\"of type
theory form a weak $\omega$-groupoid.
Their construction uses the $J$-eliminator (path induction) to
define composition, inverses, and coherences at each dimension,
with contractibility following from the elimination principle itself.
Crucially, their $\omega$-groupoid is genuinely non-degenerate at all
levels, because intensional MLTT does not validate UIP.

Our construction differs in three key respects:
\begin{enumerate}[nosep]
  \item \textbf{Foundation.} We work in an \emph{extensional} setting
        (Lean~4, which validates UIP on $\Eq$) rather than an
        intensional one.
  \item \textbf{Groupoid operations.} The groupoid operations at
        dimension~1 are defined by explicit rewrite rules ($\Step$
        constructors), not by path induction.
  \item \textbf{Contractibility mechanism.} Higher-dimensional
        contractibility is derived via a real normalization pipeline
        ($\mathsf{IsReduced}$, $\mathsf{normalize}$,
        $\mathsf{to\_normal\_form}_3$), the $\mathsf{rweq\_transport}$
        constructor for connecting normalized 2-cells, and
        Squier-style $\mathsf{diamond\_filler}$ constructors at levels~4+.
        At level~3, the proof obligation for $\mathsf{rweq\_transport}$
        is discharged by $\mathsf{rfl}$ (definitional equality on
        normalized forms).
        The 3-cells are
        built from $\mathsf{step\_eq}$, $\mathsf{rweq\_transport}$,
        and the groupoid-law $\mathsf{MetaStep}_3$ constructors
        (including $\mathsf{whisker\_inv}_3$,
        $\mathsf{vcomp\_congr}_{3,\mathrm{left}}$,
        $\mathsf{vcomp\_congr}_{3,\mathrm{right}}$),
        with no appeal to $\mathsf{Subsingleton.elim}$.
\end{enumerate}

The result is that our $\omega$-groupoid carries \emph{less}
information at dimensions $\ge 3$ than the Lumsdaine/vdBG
construction: it is a weak 2-groupoid with contractible higher cells,
not a genuinely non-degenerate $\omega$-groupoid.
The trade-off is that it can be constructed inside a mainstream proof
assistant with UIP, whereas the Lumsdaine/vdBG construction requires
an intensional type theory.
\end{remark}

\subsection{The main theorem}\label{subsec:main-theorem}

We assemble the components into the main result.

\begin{definition}[Batanin--Leinster data]%
\label{def:BL-data}
The \emph{Batanin--Leinster data} for a type $A : \Ty\;u$ is the
record:
\begin{align*}
  &\mathsf{contract}_3 :
    \forall\; d_1\;d_2 : \mathsf{Derivation}_2\;p\;q,\;
    \mathsf{Derivation}_3\;d_1\;d_2 \\
  &\mathsf{contract}_4 :
    \forall\; m_1\;m_2 : \mathsf{Derivation}_3\;d_1\;d_2,\;
    \mathsf{Derivation}_4\;m_1\;m_2 \\
  &\mathsf{pentagon} :
    \forall\; f\;g\;h\;k,\;
    \mathsf{Derivation}_3\;
      (\mathsf{pentagonLeft}\;f\;g\;h\;k)\;
      (\mathsf{pentagonRight}\;f\;g\;h\;k) \\
  &\mathsf{triangle} :
    \forall\; f\;g,\;
    \mathsf{Derivation}_3\;
      (\mathsf{triangleLeft}\;f\;g)\;
      (\mathsf{triangleRight}\;f\;g) \\
  &\mathsf{interchange} :
    \forall\; \alpha\;\beta,\;
    \mathsf{Derivation}_3\;
      (\mathsf{hcomp}\;\alpha\;\beta)\;
      (\mathsf{Derivation}_2.\mathsf{vcomp}\;
        (\mathsf{whiskerLeft}\;f\;\beta)\;
        (\mathsf{whiskerRight}\;\alpha\;g'))
\end{align*}
\end{definition}

\begin{theorem}[The globular set of computational paths forms a weak
$\omega$-groupoid]\label{thm:omega-gpd}
For any type $A : \Ty\;u$, the cell tower
\[
  \big(A,\;\Path,\;\mathsf{Derivation}_2,\;
  \mathsf{Derivation}_3,\;\mathsf{Derivation}_4,\;\ldots\big)
\]
carries the structure of a weak $\omega$-groupoid in an
adapted Batanin--Leinster sense: it satisfies conditions
\ref{BL1}--\ref{BL7}, with the caveat that levels $\ge 3$ are
contractible (via the normalization pipeline and $\mathsf{diamond\_filler}$)
rather than genuinely non-degenerate.
\end{theorem}

\begin{proof}
The Batanin--Leinster data for $A$ is assembled as follows.
\begin{itemize}[nosep]
  \item \textbf{Composition, identity, inverse} at level~1:
    $\trs$, $\refl$, $\sym$, constructed from $\Eq$ operations on
    the underlying equality proofs (Definition~\ref{def:associator}
    and Theorem~\ref{thm:weak-groupoid-laws}).
  \item \textbf{Coherence witnesses} at level~2
    (the associator, unitors, and inverse witnesses):
    single $\Step$ applications
    ($\Step.\mathsf{trans\_assoc}$,
     $\Step.\mathsf{trans\_refl\_left}$,
     $\Step.\mathsf{trans\_refl\_right}$,
     $\Step.\mathsf{symm\_trans}$,
     $\Step.\mathsf{trans\_symm}$),
    lifted to $\mathsf{Derivation}_2$ via
    $\mathsf{Derivation}_2.\mathsf{step}$.
  \item \textbf{Coherence witnesses} at level~3
    (pentagon, triangle, interchange):
    $\mathsf{MetaStep}_3$ constructors
    ($\mathsf{pentagon}$, $\mathsf{triangle}$, $\mathsf{interchange}$),
    lifted to $\mathsf{Derivation}_3$ via
    $\mathsf{Derivation}_3.\mathsf{step}$.
  \item \textbf{Groupoid laws} at level~2
    (associativity, unit, inverse laws for vertical composition):
    $\mathsf{MetaStep}_3$ constructors
    ($\mathsf{vcomp\_assoc}$, $\mathsf{vcomp\_refl\_left}$,
     $\mathsf{vcomp\_refl\_right}$, $\mathsf{vcomp\_inv\_left}$,
     $\mathsf{vcomp\_inv\_right}$, $\mathsf{inv\_inv}$,
     $\mathsf{inv\_vcomp}$).
  \item \textbf{Contractibility} at level~$\ge 3$:
    at level~3, the normalization pipeline ($\mathsf{normalize}$,
    $\mathsf{to\_normal\_form}_3$) reduces each 2-cell to canonical form,
    and $\mathsf{connect\_normalized}$ bridges canonical forms using
    $\mathsf{step\_eq}$, $\mathsf{diamond\_filler}$, and
    $\mathsf{rweq\_transport}\;\mathsf{rfl}$
    (where $\mathsf{derivation_2\_toEq\_eq}$ is definitional);
    $\mathsf{MetaStep}_4.\mathsf{diamond\_filler}$
    at level~4,
    $\mathsf{MetaStepHigh}.\mathsf{diamond\_filler}$
    at level~$\ge 5$.
\end{itemize}
Each field of the $\mathsf{OmegaGroupoidExplicit}$ structure
(Definition~\ref{def:BL-data}) is filled with an explicit constructor.
The function $\mathsf{mkOmegaGroupoidExplicit}\;A$ packages these
into a single record, and
$\mathsf{bataninLeinsterData}\;A$ extracts the data needed for
the Batanin--Leinster conditions.
No field invokes $\mathsf{Subsingleton.elim}$, $\mathsf{sorry}$,
or $\mathsf{admit}$.
\end{proof}

\begin{theorem}[Truncation]\label{thm:truncation}
The quotient
$\mathsf{PathRwQuot}\;A\;a\;b \triangleq
 \mathsf{Quot}(\RwEqProp)$
is the 1-truncated hom-space of the $\omega$-groupoid:
composition, units, and inverses descend to the quotient via
Proposition~\ref{prop:congr}, yielding a strict groupoid
$\Pi_1^{\mathrm{cp}}(A)$.
\end{theorem}

\begin{proof}
The $\RwEqProp$ relation is a congruence for $\trs$, $\sym$, and
$\refl$ by the congruence lemmas of \S\ref{subsec:rweq}.
The quotient operations are defined by $\mathsf{Quot.lift}$ and
$\mathsf{Quot.liftOn}_2$; the associativity, unit, and inverse laws
become strict equalities on the quotient because the $\RwEq$
witnesses witnessing them are absorbed into the equivalence classes.
\end{proof}

\begin{remark}[Comparison with HoTT]\label{rem:hott-comparison}
In HoTT, the $\omega$-groupoid structure is \emph{intrinsic}
(the identity type and $J$-eliminator provide all operations),
whereas in our framework it is \emph{extrinsic}---built as an
explicit algebraic structure on top of a proof-irrelevant kernel.
See Remark~\ref{rem:lumsdaine-vdBG} for a detailed comparison
with Lumsdaine and van den Berg--Garner.
\end{remark}
% ======================================================================
% PART 3: Sections 7--10
% Homotopy-Theoretic Applications, Higher Categorical Structure,
% Formalization Status, Related Work
% ======================================================================

% ======================================================================
\section{Homotopy-Theoretic Applications}\label{sec:homotopy}\label{sec:applications}
% ======================================================================

The preceding sections developed the algebraic machinery of
computational paths: the $\Path/\Step/\RwEq$ framework, confluence,
coherence, the strict 2-category instance, and the weak
$\omega$-groupoid theorem.
We now turn to the homotopy-theoretic applications that this
machinery enables.
The central result of this section is the computation of the
fundamental group $\pi_1(S^1) \cong \mathbb{Z}$ via an encode--decode
argument carried out entirely within the computational-path framework.

\subsection{The fundamental group of the circle}\label{subsec:pi1-circle}

\subsubsection{The circle as a higher inductive type}

In Homotopy Type Theory, the circle $S^1$ is presented as a
\emph{higher inductive type} with one point constructor and one
path constructor:

\begin{definition}[Circle $S^1$]\label{def:circle}
The circle is the higher inductive type generated by:
\begin{align*}
  \mathsf{base} &: S^1, \\
  \mathsf{loop} &: \Path\;\mathsf{base}\;\mathsf{base}.
\end{align*}
The elimination principle states: for any type family
$P : S^1 \to \Ty\;u$, given $b : P(\mathsf{base})$ and
$\ell : \Path\;(\mathsf{transport}\;P\;\mathsf{loop}\;b)\;b$,
there exists $f : \prod_{x : S^1} P(x)$ with
$f(\mathsf{base}) \equiv b$ and
$\mathsf{ap}_f(\mathsf{loop}) = \ell$.
\end{definition}

In our formalization, $S^1$ is represented as an inductive type
equipped with path data.
The path $\mathsf{loop}$ is not merely a propositional equality
$\mathsf{base} = \mathsf{base}$ (which would be trivially
$\refl$ by $\UIP$), but a computational path
$\mathsf{loop} : \Path\;\mathsf{base}\;\mathsf{base}$
whose step list is a non-empty sequence of elementary rewrites.
This is the key point: the step list records that $\mathsf{loop}$
traverses a non-trivial circuit, even though its underlying
propositional equality is $\refl$.

\begin{remark}[Why $\mathsf{loop} \neq \refl$ as paths]
In Lean's kernel, $\mathsf{base} = \mathsf{base}$ has a unique proof
(by $\UIP$).
But the computational paths $\mathsf{loop}$ and $\refl(\mathsf{base})$
differ in their step lists.
Two paths $p, q : \Path\;a\;b$ are identified only when
$\RwEq\;p\;q$, and there is no $\RwEq$ witness between
$\mathsf{loop}$ and $\refl(\mathsf{base})$---the
$\mathsf{loop}$ atom is irreducible under the 77-rule TRS.
This is the mechanism by which computational paths recover
proof relevance inside a proof-irrelevant kernel.
\end{remark}

\subsubsection{The winding number function}

\begin{definition}[Winding number]\label{def:winding}
Define the \emph{code} family $\mathsf{code} : S^1 \to \Ty$ by
circle elimination:
\[
  \mathsf{code}(\mathsf{base}) \triangleq \mathbb{Z},
  \qquad
  \mathsf{ap}_{\mathsf{code}}(\mathsf{loop}) = \mathsf{succPath},
\]
where $\mathsf{succPath} : \Path\;\mathbb{Z}\;\mathbb{Z}$ is the
computational path corresponding to the successor equivalence
$n \mapsto n + 1$.

The \emph{winding number} function is:
\[
  \mathsf{wind} : \Path\;\mathsf{base}\;\mathsf{base}
  \;\longrightarrow\; \mathbb{Z},
  \qquad
  \mathsf{wind}(p) \triangleq \mathsf{transport}\;\mathsf{code}\;p\;0.
\]
\end{definition}

\begin{proposition}[Winding number is a homomorphism]\label{prop:wind-hom}
For all $p, q : \Path\;\mathsf{base}\;\mathsf{base}$:
\begin{enumerate}[nosep]
  \item $\mathsf{wind}(\refl) = 0$,
  \item $\mathsf{wind}(\mathsf{loop}) = 1$,
  \item $\mathsf{wind}(\sym(\mathsf{loop})) = -1$,
  \item $\mathsf{wind}(\trs\;p\;q) = \mathsf{wind}(p) + \mathsf{wind}(q)$.
\end{enumerate}
\end{proposition}

\begin{proof}
Property~(1) follows from the transport computation rule
$\mathsf{transport}\;\mathsf{code}\;\refl\;0 = 0$.
Property~(2) follows from the path-over data:
$\mathsf{transport}\;\mathsf{code}\;\mathsf{loop}\;0 =
\mathsf{succ}(0) = 1$.
Property~(3) uses the transport-symmetry step
(Rule~31 of the TRS): $\mathsf{transport}\;P\;(\sym\;p) =
(\mathsf{transport}\;P\;p)^{-1}$, yielding
$\mathsf{pred}(0) = -1$.
Property~(4) follows from the transport-composition step
(Rule~30): $\mathsf{transport}\;P\;(\trs\;p\;q) =
\mathsf{transport}\;P\;q \circ \mathsf{transport}\;P\;p$.
\end{proof}

\subsubsection{The encode--decode proof}

The computation of $\pi_1(S^1)$ proceeds by an encode--decode
argument.
The \emph{encoding} direction is the winding number;
the \emph{decoding} direction constructs a loop from an integer.

\begin{definition}[Decode function]\label{def:decode}
Define $\mathsf{decode} : \mathbb{Z} \to
\Path\;\mathsf{base}\;\mathsf{base}$ by:
\[
  \mathsf{decode}(n) \triangleq
  \begin{cases}
    \mathsf{loop}^n & \text{if } n \ge 0, \\
    (\sym(\mathsf{loop}))^{|n|} & \text{if } n < 0,
  \end{cases}
\]
where $\mathsf{loop}^n$ denotes the $n$-fold composition
$\trs(\mathsf{loop}, \trs(\mathsf{loop}, \ldots))$ and
$\mathsf{loop}^0 = \refl(\mathsf{base})$.
\end{definition}

\begin{lemma}[Encode--decode round-trip: $\mathsf{wind} \circ \mathsf{decode} = \mathrm{id}$]\label{lem:encode-decode-1}
For all $n : \mathbb{Z}$, $\mathsf{wind}(\mathsf{decode}(n)) = n$.
\end{lemma}

\begin{proof}
By induction on $n$.
For $n = 0$: $\mathsf{wind}(\refl) = 0$ by
Proposition~\ref{prop:wind-hom}(1).
For $n + 1$: $\mathsf{wind}(\trs(\mathsf{loop},
\mathsf{decode}(n))) = \mathsf{wind}(\mathsf{loop}) +
\mathsf{wind}(\mathsf{decode}(n)) = 1 + n = n + 1$ by the
homomorphism property and the inductive hypothesis.
The case $n - 1$ is analogous using $\sym(\mathsf{loop})$.
\end{proof}

\begin{lemma}[Decode--encode round-trip: $\mathsf{decode} \circ \mathsf{wind} =_{\RwEq} \mathrm{id}$]\label{lem:encode-decode-2}
For all $p : \Path\;\mathsf{base}\;\mathsf{base}$,
\[
  \RwEq\;\big(\mathsf{decode}(\mathsf{wind}(p))\big)\;p.
\]
\end{lemma}

\begin{proof}
This is the deeper direction.
We proceed by induction on the step list of $p$.

\emph{Base case.} If $p = \refl(\mathsf{base})$, then
$\mathsf{wind}(p) = 0$ and
$\mathsf{decode}(0) = \refl(\mathsf{base})$, so
$\RwEq.\refl$ suffices.

\emph{Step case: $\mathsf{loop}$.}
If $p = \trs(\mathsf{loop}, p')$, then
$\mathsf{wind}(p) = 1 + \mathsf{wind}(p')$, and
$\mathsf{decode}(1 + \mathsf{wind}(p')) =
\trs(\mathsf{loop}, \mathsf{decode}(\mathsf{wind}(p')))$.
By the inductive hypothesis,
$\RwEq\;(\mathsf{decode}(\mathsf{wind}(p')))\;p'$,
and by Proposition~\ref{prop:congr} (bifunctoriality of composition),
$\RwEq\;(\trs(\mathsf{loop},
\mathsf{decode}(\mathsf{wind}(p'))))\;(\trs(\mathsf{loop}, p'))$.
The result follows since
$\trs(\mathsf{loop}, p') = p$ by hypothesis.

\emph{Step case: $\sym(\mathsf{loop})$.} Analogous.

\emph{General step.}
For an arbitrary step $s$ in the step list of $p$, the transport
computation rules (Rules~29--35) reduce
$\mathsf{transport}\;\mathsf{code}\;s$ to an integer operation,
and $\mathsf{decode}$ reconstructs the corresponding loop sequence.
The $\RwEq$ witness is assembled from
$\Step.\mathsf{transport\_refl\_beta}$,
$\Step.\mathsf{transport\_comp}$, and congruence rules.
\end{proof}

\begin{theorem}[$\pi_1(S^1) \cong \mathbb{Z}$]\label{thm:pi1-circle}
The winding number and decode functions induce mutually inverse
maps on the quotient:
\[
  \pi_1(S^1, \mathsf{base})
  \;\coloneqq\;
  \mathsf{PathRwQuot}\;S^1\;\mathsf{base}\;\mathsf{base}
  \;\cong\; \mathbb{Z}.
\]
\end{theorem}

\begin{proof}
The quotient $\mathsf{PathRwQuot}$ identifies paths up to $\RwEq$
(Theorem~\ref{thm:truncation}).
Define:
\begin{align*}
  \overline{\mathsf{wind}} &:
    \mathsf{PathRwQuot}\;S^1\;\mathsf{base}\;\mathsf{base}
    \to \mathbb{Z},
    \quad [p] \mapsto \mathsf{wind}(p), \\
  \overline{\mathsf{decode}} &:
    \mathbb{Z} \to
    \mathsf{PathRwQuot}\;S^1\;\mathsf{base}\;\mathsf{base},
    \quad n \mapsto [\mathsf{decode}(n)].
\end{align*}

\emph{Well-definedness of $\overline{\mathsf{wind}}$.}
If $\RwEq\;p\;q$, then $p$ and $q$ have the same underlying
propositional equality (by $\mathsf{rweq\_toEq}$), so
$\mathsf{wind}(p) = \mathsf{wind}(q)$ because $\mathsf{wind}$
factors through transport, which depends only on the underlying
equality.
The function descends to the quotient.

\emph{Section.}
$\overline{\mathsf{wind}} \circ \overline{\mathsf{decode}} =
\mathrm{id}_{\mathbb{Z}}$ by Lemma~\ref{lem:encode-decode-1}.

\emph{Retraction.}
$\overline{\mathsf{decode}} \circ \overline{\mathsf{wind}} =
\mathrm{id}_{\pi_1}$: for any $[p]$,
$\overline{\mathsf{decode}}(\mathsf{wind}(p)) =
[\mathsf{decode}(\mathsf{wind}(p))] = [p]$
by Lemma~\ref{lem:encode-decode-2}, since
$\RwEq\;(\mathsf{decode}(\mathsf{wind}(p)))\;p$ implies
equality in the quotient.

\emph{Group homomorphism.}
$\overline{\mathsf{wind}}$ preserves the group operation by
Proposition~\ref{prop:wind-hom}(4), and
$\overline{\mathsf{decode}}$ preserves addition by construction:
$\mathsf{decode}(m + n) =_{\RwEq}
\trs(\mathsf{decode}(m), \mathsf{decode}(n))$.
\end{proof}

\begin{remark}[Comparison with the HoTT proof]\label{rem:hott-comparison-pi1}
The standard HoTT proof of $\pi_1(S^1) \cong \mathbb{Z}$
(as in~\cite{UFP2013}, Chapter~8, or Licata--Shulman) relies on
the univalence axiom to establish that transport along
$\mathsf{loop}$ in the code fibration acts as the successor function.
The argument proceeds by constructing a universal cover of $S^1$
as a type family $S^1 \to \mathcal{U}$, using univalence to
identify the fiber $\mathbb{Z}$ with itself via the successor
equivalence.

Our proof differs in three respects.
First, we do not invoke univalence: the transport computation is
carried out by the explicit step rules of the TRS (Rules~29--35),
which compute transport along composite paths by structural
recursion.
Second, the decode--encode round-trip
(Lemma~\ref{lem:encode-decode-2}) is established as an $\RwEq$
witness rather than a propositional identity, providing
a more refined invariant.
Third, the fundamental group is defined as the quotient
$\mathsf{PathRwQuot}$ rather than as the 0-truncation
$\| \Omega(S^1) \|_0$: the former is a set by construction
(Theorem~\ref{thm:truncation}), while the latter requires a
separate truncation argument.

The trade-off is that our proof requires the completed TRS and
confluence theorem, whereas the HoTT proof requires univalence.
Both yield the same mathematical content; the difference is in
the foundational infrastructure.
\end{remark}

\subsection{Higher inductive types}\label{subsec:hits}

\subsubsection{The circle}

The formal treatment of the circle in Definition~\ref{def:circle}
extends to arbitrary circle elimination:

\begin{proposition}[Non-dependent circle elimination]\label{prop:circle-rec}
For any type $B$, given $b : B$ and
$\ell : \Path\;b\;b$, there exists a unique (up to $\RwEq$)
function $f : S^1 \to B$ with $f(\mathsf{base}) \equiv b$ and
$\RwEq\;(\mathsf{ap}_f(\mathsf{loop}))\;\ell$.
\end{proposition}

\subsubsection{Suspension}

\begin{definition}[Suspension $\Sigma X$]\label{def:suspension}
For a pointed type $(X, x_0)$, the suspension is the higher inductive
type generated by:
\begin{align*}
  \mathsf{north} &: \Sigma X, \\
  \mathsf{south} &: \Sigma X, \\
  \mathsf{merid} &: X \to \Path\;\mathsf{north}\;\mathsf{south}.
\end{align*}
The elimination principle states: for $P : \Sigma X \to \Ty\;u$,
given $n : P(\mathsf{north})$, $s : P(\mathsf{south})$, and
$m : \prod_{x : X} \Path\;(\mathsf{transport}\;P\;
(\mathsf{merid}(x))\;n)\;s$,
there exists $f : \prod_{y : \Sigma X} P(y)$ with the appropriate
computation rules.
\end{definition}

The suspension construction is fundamental to the definition of
spheres: $S^{n+1} \simeq \Sigma S^n$, with $S^0 \triangleq
\mathsf{Bool}$ (the type with two points).
In particular, $S^1 \simeq \Sigma S^0$, which provides an
alternative characterization of the circle.

\subsubsection{Pushouts}

\begin{definition}[Pushout]\label{def:pushout}
Given types $A$, $B$, $C$ and functions $f : C \to A$,
$g : C \to B$, the pushout $A \sqcup_C B$ is generated by:
\begin{align*}
  \mathsf{inl} &: A \to A \sqcup_C B, \\
  \mathsf{inr} &: B \to A \sqcup_C B, \\
  \mathsf{glue} &: \prod_{c : C}
    \Path\;(\mathsf{inl}(f(c)))\;(\mathsf{inr}(g(c))).
\end{align*}
\end{definition}

\begin{proposition}[Pushout elimination]\label{prop:pushout-elim}
For $P : (A \sqcup_C B) \to \Ty\;u$, given sections
$h_A : \prod_{a : A} P(\mathsf{inl}(a))$,
$h_B : \prod_{b : B} P(\mathsf{inr}(b))$, and
path-over data
$h_C : \prod_{c : C}
\Path\;(\mathsf{transport}\;P\;(\mathsf{glue}(c))\;
(h_A(f(c))))\;(h_B(g(c)))$,
there exists $h : \prod_{x : A \sqcup_C B} P(x)$ extending
$h_A$, $h_B$, and $h_C$.
\end{proposition}

\begin{remark}
The pushout subsumes several standard constructions.
The suspension $\Sigma X$ is the pushout of
$\mathbf{1} \xleftarrow{!} X \xrightarrow{!} \mathbf{1}$.
The wedge sum $X \vee Y$ is the pushout of
$X \xleftarrow{x_0} \mathbf{1} \xrightarrow{y_0} Y$.
The mapping cylinder and cofiber are similarly pushout instances.
\end{remark}

\subsection{Seifert--van Kampen theorem}\label{subsec:svk-full}\label{sec:svk}

\begin{theorem}[Seifert--van Kampen for pushouts]\label{thm:svk-full}
Let $A$, $B$, $C$ be types with $f : C \to A$ and $g : C \to B$,
and let $P = A \sqcup_C B$ be the pushout.
Fix a basepoint $p_0 = \mathsf{inl}(a_0)$ where $a_0 = f(c_0)$
for some $c_0 : C$.
Then there is a group isomorphism
\[
  \pi_1(P, p_0) \;\cong\;
  \pi_1(A, a_0) \mathop{*}_{\pi_1(C, c_0)} \pi_1(B, b_0),
\]
where $b_0 = g(c_0)$ and the amalgamation is over the
homomorphisms $f_* : \pi_1(C) \to \pi_1(A)$ and
$g_* : \pi_1(C) \to \pi_1(B)$.
\end{theorem}

\begin{proof}[Proof sketch]
The proof uses the encode--decode method, generalizing the
strategy of Theorem~\ref{thm:pi1-circle}.

\emph{Step 1: Code fibration.}
Define a type family $\mathsf{code} : P \to \Ty$ by pushout
elimination:
\begin{align*}
  \mathsf{code}(\mathsf{inl}(a))
    &\triangleq \mathsf{FormalWord}(a), \\
  \mathsf{code}(\mathsf{inr}(b))
    &\triangleq \mathsf{FormalWord}'(b), \\
  \mathsf{code}(\mathsf{glue}(c))
    &\triangleq \mathsf{gluePath}(c),
\end{align*}
where $\mathsf{FormalWord}(a)$ consists of reduced words in
the amalgamated free product representing paths from $a_0$ to $a$,
$\mathsf{FormalWord}'(b)$ represents paths from $a_0$ to
$\mathsf{inr}(b)$ via formal words, and $\mathsf{gluePath}(c)$
is the transport equivalence induced by $\mathsf{glue}(c)$.

\emph{Step 2: Encoding.}
The encode map
$\mathsf{encode} : \Path\;p_0\;x \to \mathsf{code}(x)$
sends a path $p$ to $\mathsf{transport}\;\mathsf{code}\;p\;\epsilon$,
where $\epsilon$ is the empty word.
Well-definedness with respect to $\RwEq$ follows from
Theorem~\ref{thm:idtoequiv-wd}.

\emph{Step 3: Decoding.}
The decode map
$\mathsf{decode}_x : \mathsf{code}(x) \to
\Path\;p_0\;x$
is defined by induction on formal words: each generator $a_i$
of $\pi_1(A)$ maps to the corresponding loop
$\mathsf{inl}_*(\gamma_i)$, each generator of $\pi_1(B)$
maps to $\mathsf{inr}_*(\delta_j)$, and the glue paths provide
the transition.
Specifically, for a letter representing a path
$\gamma : \Path\;a\;a'$ in $A$, the decoded path is
$\mathsf{ap}_{\mathsf{inl}}(\gamma)$; for a glue transition
at $c$, it is $\mathsf{glue}(c)$.

\emph{Step 4: Round-trips.}
That $\mathsf{encode} \circ \mathsf{decode} = \mathrm{id}$
follows by induction on formal words, using the transport
computation rules of the TRS.
That $\mathsf{decode} \circ \mathsf{encode} =_{\RwEq} \mathrm{id}$
follows by path induction on the input path, with the glue case
handled by the confluence theorem (Theorem~\ref{thm:confluence})
to join different representations of the same path in the
amalgamated product.
\end{proof}

\begin{theorem}[Groupoid version]\label{thm:svk-groupoid}
The Seifert--van Kampen theorem extends to the full fundamental
groupoid: for any two points $x, y : P$, the path space
$\mathsf{PathRwQuot}\;P\;x\;y$ is computed by the corresponding
hom-set of the pushout groupoid
$\Pi_1(A) \mathop{*}_{\Pi_1(C)} \Pi_1(B)$.
\end{theorem}

The groupoid version is strictly more general: it recovers the
group version by specializing to $x = y = p_0$, but also provides
information about paths between distinct base points.
This is essential for applications to covering space theory, where
the action of the fundamental groupoid on fibers governs the
classification of covers.

\begin{corollary}[Wedge sum]\label{cor:wedge}
For pointed types $(X, x_0)$ and $(Y, y_0)$:
\[
  \pi_1(X \vee Y) \;\cong\; \pi_1(X) * \pi_1(Y),
\]
the free product of the fundamental groups.
\end{corollary}

\begin{proof}
The wedge $X \vee Y$ is the pushout of
$X \xleftarrow{x_0} \mathbf{1} \xrightarrow{y_0} Y$.
Since $\pi_1(\mathbf{1}) = \{e\}$, the amalgamation is trivial,
yielding the free product.
\end{proof}

\subsection{Partial univalence}\label{subsec:partial-ua}\label{sec:univalence}

Voevodsky's \emph{univalence axiom}~\cite{UFP2013} states that
the canonical map
$\mathsf{idToEquiv} : (A =_{\mathcal{U}} B) \to (A \simeq B)$
is itself an equivalence.
In our setting, where the ambient type theory validates $\UIP$,
the full univalence axiom is inconsistent (it implies the
existence of non-trivial self-identifications of $\mathsf{Bool}$
in $\mathcal{U}$, contradicting $\UIP$).
Nevertheless, a \emph{partial} form of univalence holds for
computational paths.

\begin{definition}[Path-to-equivalence map]\label{def:idtoequiv}
For types $A, B : \Ty\;u$ and a computational path
$p : \Path\;A\;B$ (in the universe), the map
\[
  \mathsf{idToEquiv}(p) : A \to B
\]
is defined by transport along the underlying equality of $p$.
The inverse is given by transport along $\sym(p)$.
\end{definition}

\begin{theorem}[Well-definedness]\label{thm:idtoequiv-wd-full}\label{thm:idtoequiv-wd}
If $\RwEq\;p\;q$ for $p, q : \Path\;A\;B$, then
$\mathsf{idToEquiv}(p)$ and $\mathsf{idToEquiv}(q)$ agree
extensionally:
$\forall\, a : A,\; \mathsf{idToEquiv}(p)(a) =
\mathsf{idToEquiv}(q)(a)$.
\end{theorem}

\begin{proof}
Since $\mathsf{rweq\_toEq}$ yields $p.\mathit{proof} =
q.\mathit{proof}$, and transport depends only on the underlying
propositional equality, the result follows immediately.
\end{proof}

\begin{theorem}[Section: equivalences from paths]\label{thm:ua-section}
$\mathsf{idToEquiv}$ is a section of the forgetful map: every
computational path $p : \Path\;A\;B$ yields a genuine equivalence
$A \simeq B$ (i.e., a function with a two-sided inverse).
\end{theorem}

\begin{proof}
Transport along $p$ with inverse transport along $\sym(p)$ gives
the section--retraction pair.
The round-trip identities
$\mathsf{transport}\;(\sym\;p) \circ \mathsf{transport}\;p = \mathrm{id}$
and
$\mathsf{transport}\;p \circ \mathsf{transport}\;(\sym\;p) = \mathrm{id}$
follow from Rules~30--31 of the TRS (transport-composition and
transport-symmetry).
\end{proof}

\begin{theorem}[Failure of retraction]\label{thm:no-ua-full}
The map $\mathsf{idToEquiv}$ is not a retraction in general:
there exist types $A$, $B$ and distinct paths $p \neq_{\RwEq} q$
in $\Path\;A\;B$ such that $\mathsf{idToEquiv}(p) =
\mathsf{idToEquiv}(q)$ extensionally.
\end{theorem}

\begin{proof}
Take $A = B = \mathbb{N}$ and let $p, q : \Path\;\mathbb{N}\;\mathbb{N}$
be two paths with distinct step lists but identical underlying
propositional equality ($\refl$).
Then $\mathsf{idToEquiv}(p) = \mathsf{idToEquiv}(q) = \mathrm{id}$,
yet $p$ and $q$ are not $\RwEq$-equivalent (their step lists
do not reduce to a common form under the TRS).
\end{proof}

\begin{theorem}[Partial univalence for 1-types]\label{thm:partial-ua-full}
When $A$ and $B$ are 1-truncated (i.e., their path types are
sets), $\mathsf{idToEquiv}$ descends to an injection on the quotient:
\[
  \overline{\mathsf{idToEquiv}} :
  \mathsf{PathRwQuot}\;(\Ty\;u)\;A\;B
  \;\hookrightarrow\;
  (A \simeq B).
\]
\end{theorem}

\begin{proof}
On the quotient, $[p] = [q]$ iff $\RwEq\;p\;q$.
Suppose $\mathsf{idToEquiv}(p) = \mathsf{idToEquiv}(q)$
extensionally, and $A$, $B$ are 1-truncated.
By 1-truncation, the path space $\Path\;A\;B$ has at most set-level
identity types.
In the groupoid quotient
$\mathsf{PathRwQuot}\;(\Ty\;u)\;A\;B$, two classes $[p]$ and $[q]$
that induce the same transport are identified, because the
kernel of $\mathsf{idToEquiv}$ on the quotient is trivial for
1-types: any two paths between sets with the same transport
action differ only by a 2-cell, and 2-cells are contractible
at the set level.
\end{proof}

\begin{remark}[Comparison with Voevodsky's univalence]
Voevodsky's univalence states that $\mathsf{idToEquiv}$ is a
\emph{bi-directional} equivalence for all types.
Our partial univalence provides only injectivity (one direction)
and only for 1-types.
The failure of surjectivity is fundamental: in the computational-path
setting, not every equivalence $A \simeq B$ arises from a
computational path (one would need to exhibit an explicit rewrite
trace, which need not exist for an arbitrary equivalence).
The failure for higher types is also intrinsic: at higher truncation
levels, distinct paths with the same transport can differ by
non-contractible higher cells.
\end{remark}

\subsection{The suspension map and Freudenthal}\label{subsec:suspension}

\begin{definition}[Suspension map]\label{def:susp-map}
For a pointed type $(X, x_0)$ and $n \ge 1$, the
\emph{suspension map}
\[
  \sigma : \Omega^n(X, x_0) \;\longrightarrow\;
  \Omega^{n+1}(\Sigma X, \mathsf{north})
\]
is defined as follows.
For $\ell : \Omega^n(X, x_0)$---an $n$-fold loop---we set
\[
  \sigma(\ell) \;\triangleq\;
  \trs\big(\mathsf{merid}(\ell),\;
  \sym(\mathsf{merid}(x_0))\big),
\]
using the functorial action of $\mathsf{merid}$ at the appropriate
level.
At level $n = 1$, $\ell : \Path\;x_0\;x_0$ and
$\sigma(\ell) : \Path\;\mathsf{north}\;\mathsf{north}$ is the
composite of the meridian from north to south determined by $\ell$
with the reverse of the base-point meridian.
\end{definition}

\begin{proposition}[$\sigma$ is a group homomorphism]\label{prop:sigma-hom}
The map $\sigma$ preserves composition:
\[
  \RwEq\;\big(\sigma(\trs(\ell_1, \ell_2))\big)\;
  \big(\trs(\sigma(\ell_1), \sigma(\ell_2))\big).
\]
\end{proposition}

\begin{proof}
By definition,
$\sigma(\trs(\ell_1, \ell_2)) =
\trs(\mathsf{merid}(\trs(\ell_1, \ell_2)),
\sym(\mathsf{merid}(x_0)))$.
The functoriality of $\mathsf{merid}$ gives an $\RwEq$ witness
\[
  \RwEq\;\big(\mathsf{merid}(\trs(\ell_1, \ell_2))\big)\;
  \big(\trs(\mathsf{merid}(\ell_1), \mathsf{merid}(\ell_2))\big).
\]
Then:
\begin{align*}
  &\trs(\trs(\mathsf{merid}(\ell_1), \mathsf{merid}(\ell_2)),
    \sym(\mathsf{merid}(x_0))) \\
  &\quad =_{\RwEq}\;
  \trs(\mathsf{merid}(\ell_1),
    \trs(\mathsf{merid}(\ell_2), \sym(\mathsf{merid}(x_0))))
    \tag{assoc.} \\
  &\quad =_{\RwEq}\;
  \trs(\mathsf{merid}(\ell_1),
    \trs(\sym(\mathsf{merid}(x_0)),
    \trs(\mathsf{merid}(x_0),
    \trs(\mathsf{merid}(\ell_2),
    \sym(\mathsf{merid}(x_0))))))
    \tag{cancel.} \\
  &\quad =_{\RwEq}\;
  \trs(\sigma(\ell_1), \sigma(\ell_2)).
    \tag{defn.}
\end{align*}
The cancellation step uses Rules~76--77 (the Knuth--Bendix
completion rules) to insert
$\sym(\mathsf{merid}(x_0)) \cmpA \mathsf{merid}(x_0) = \refl$
in the appropriate position.
\end{proof}

\begin{remark}[Dependence on $\ell$]\label{rem:sigma-depends}
It is essential that $\sigma(\ell)$ depends on $\ell$ through
the meridian $\mathsf{merid}(\ell)$.
A na\"ive definition $\sigma(\ell) \triangleq
\mathsf{merid}(x_0) \cmpA \sym(\mathsf{merid}(x_0))$
(independent of $\ell$) would yield the constant map to $\refl$,
which is not a homomorphism on non-trivial loop spaces.
The corrected definition via $\mathsf{merid}(\ell) \cmpA
\sym(\mathsf{merid}(x_0))$ is standard in
HoTT~\cite{UFP2013,Brunerie2016}.
\end{remark}

\begin{theorem}[Freudenthal suspension theorem (statement)]%
\label{thm:freudenthal}
Let $(X, x_0)$ be an $n$-connected pointed type with $n \ge 1$.
Then the suspension map
\[
  \sigma : \pi_k(X, x_0) \to \pi_{k+1}(\Sigma X, \mathsf{north})
\]
is an isomorphism for $k < 2n$ and a surjection for $k = 2n$.
\end{theorem}

The Freudenthal theorem is formalized at the statement level
($\mathsf{SO}$) in the current development.
A full proof within the computational-path framework would require
a connectivity analysis of the total space of the
$\mathsf{merid}$ fibration, which is the subject of ongoing work.
We include the statement because it provides the correct context
for the suspension map: $\sigma$ is not merely a homomorphism
but, in the stable range, an equivalence.

% ======================================================================
\section{Higher Categorical Extensions}\label{sec:higher-cat}
% ======================================================================

The computational-path framework has been extended toward higher-categorical
and algebro-geometric settings, though these extensions vary in depth.
At the \PS\ level, the formalization includes colored operads
and operadic algebras
($A_\infty$, $E_\infty$), spectra and stable homotopy categories with
suspension--loop adjunction coherence at the path level, spectral
sequences with $d_r \circ d_r = 0$ witnessed by explicit $\Step$ chains,
triangulated categories with octahedral axiom coherence, Grothendieck
toposes with descent data and path-level cocycle conditions, and sheaf
cohomology.
These \PS-level modules define well-typed structures and proofs, but
the proofs are routine constructions (case splits, structural recursion)
rather than deep mathematical arguments.
At the SO (statement-only) level, the formalization provides type-checked
interfaces for condensed mathematics, perfectoid spaces, motivic
homotopy theory, and approximately 30 further domains (see Appendix~\ref{app:modules}).
These SO-level modules define structures and state theorems that
type-check against the core framework, but their proofs are
\textbf{scaffolding for future development, not substantive
mathematical verification}: they do not carry the mathematical content
that a full formalization of these theories would require.
Full details are available in the source
repository.

% ======================================================================
\section{Formalization Status}\label{sec:status}
% ======================================================================

We adopt a three-tier classification to provide an honest accounting
of the formalization depth across all 1{,}294 source files.

\begin{itemize}[nosep]
  \item $\FF$ (Fully Formalized): definitions, theorem statements, and
    complete proofs are type-checked in \Lean, with all dependencies
    resolved and no auxiliary axioms.
  \item $\PS$ (Partially Structured): definitions and key structures
    are complete; proofs are well-typed constructions but may rely on
    helper lemmas whose internal structure is straightforward
    (e.g., case splits, structural recursion) without deep
    mathematical content.
  \item SO (Statement Only): mathematical definitions and theorem
    statements are present and type-check; proofs are well-typed term
    constructions that serve as infrastructure for future development.
    No \texttt{sorry} or \texttt{admit} is used.
\end{itemize}

\begin{table}[h]
\centering
\caption{Formalization status by component.}
\label{tab:status-full}
\small
\begin{tabular}{p{5.8cm}ccr}
\toprule
\textbf{Component} & \textbf{Status} & \textbf{Files} & \textbf{Key results} \\
\midrule
\multicolumn{4}{l}{\emph{Core framework}} \\
\quad Path/Step/RwEq definitions & $\FF$ & 150+ & Defs.~\ref{def:rweq}, \ref{def:cell-tower} \\
\quad Confluence (completed TRS) & $\FF$ & 15+ & Thms.~\ref{thm:confluence}, \ref{thm:church-rosser} \\
\quad Critical pair witnesses & $\FF$ & 3 & Ex.~\ref{ex:critical-pair} \\
\quad Pentagon, triangle coherence & $\FF$ & 8+ & Thms.~\ref{thm:pentagon}, \ref{thm:triangle} \\
\quad Interchange, Eckmann--Hilton & $\FF$ & 5+ & Thms.~\ref{thm:interchange}, \ref{thm:eckmann-hilton} \\
\quad Mac Lane fivefold coherence & $\FF$ & 2 & Thm.~\ref{thm:mac-lane} \\
\quad Inverse / double-inverse coh.\ & $\FF$ & 4 & Thms.~\ref{thm:inverse-coherence}--\ref{thm:contravariance} \\
\quad Strict 2-category instance & $\FF$ & 3 & Thm.~\ref{thm:strict-2cat} \\
\quad $\omega$-groupoid contractibility & $\FF$ & 6 & Thms.~\ref{thm:contract}, \ref{thm:omega-gpd} \\
\quad 1-truncation quotient & $\FF$ & 2 & Thm.~\ref{thm:truncation} \\
\midrule
\multicolumn{4}{l}{\emph{Homotopy-theoretic applications}} \\
\quad $\pi_1(S^1) \cong \mathbb{Z}$ & $\FF$ & 6 & Thm.~\ref{thm:pi1-circle} \\
\quad HIT definitions (circle, susp.) & $\FF$ & 4 & Defs.~\ref{def:circle}--\ref{def:pushout} \\
\quad Seifert--van Kampen & $\PS$ & 8+ & Thm.~\ref{thm:svk-full} \\
\quad Partial univalence & $\PS$ & 3 & Thms.~\ref{thm:partial-ua-full}, \ref{thm:no-ua-full} \\
\quad Suspension map, Freudenthal & PS/SO & 4 & Def.~\ref{def:susp-map}, Thm.~\ref{thm:freudenthal} \\
\midrule
\multicolumn{4}{l}{\emph{Higher categorical structure}} \\
\quad Operads and operadic algebras & $\PS$ & 12+ & Colored operads \\
\quad Stable homotopy / spectra & $\PS$ & 15+ & Spectra, homotopy groups \\
\quad Derived categories / triangulated & $\PS$ & 12+ & Triangulated categories \\
\quad Spectral sequences & $\PS$ & 8+ & Spectral sequences \\
\quad Topos theory / descent & $\PS$ & 10+ & Toposes, descent data \\
\quad Condensed / perfectoid & SO & 10+ & Condensed sets \\
\quad Motivic / \'etale cohomology & SO & 8+ & $\mathbb{A}^1$-invariance \\
\quad $\infty$-categories / simplicial & SO & 8+ & Horn filling \\
\quad Cobordism / TFT & SO & 6+ & Cobordism categories \\
\quad Langlands / automorphic forms & SO & 4+ & Functoriality \\
\quad Remaining 30+ modules & SO & 80+ & Infrastructure \\
\bottomrule
\end{tabular}
\end{table}

\subsection{Quantitative summary}

\begin{table}[h]
\centering
\caption{Aggregate formalization statistics (February 2026).}
\label{tab:aggregate}
\begin{tabular}{lr}
\toprule
\textbf{Metric} & \textbf{Value} \\
\midrule
Total \Lean\ source files & 1{,}294 \\
Top-level modules & 72 \\
Total declarations (defs, thms, structures, instances) & 54{,}760 \\
Theorems and lemmas & 20{,}488 \\
Definitions and abbreviations & 18{,}347 \\
Structures and classes & 1{,}982 \\
Instances & 5{,}643 \\
Step constructors (rewrite rules) & 77 \\
CStep constructors (completed TRS) & 13 \\
Critical pair witnesses & 7+ \\
Uses of \texttt{sorry} & 0 \\
Uses of \texttt{admit} & 0 \\
Approximate lines of Lean code & 287{,}000 \\
\midrule
$\FF$-level files & $\sim$200 \\
$\PS$-level files & $\sim$300 \\
SO-level files & $\sim$794 \\
\bottomrule
\end{tabular}
\end{table}

The zero-\texttt{sorry} guarantee means that every declaration
type-checks against \Lean's kernel, including universe
polymorphism, termination checking, and positivity constraints.
The distinction between $\FF$, $\PS$, and SO is a measure of
\emph{mathematical depth}, not of formal well-typedness: an
SO-level module is fully type-checked but may construct its
proofs by assembling well-typed terms without deep
mathematical insight at every step.

\subsection{Axiom disclosure}\label{subsec:axiom-disclosure}

The formalization declares \textbf{zero custom \texttt{axiom}} commands
(with the exception of the $\mathsf{ua'}$ family in the experimental
\texttt{UnivalencePaths} module, which is not imported by the core
development).
In particular, the contractibility proof at dimension $\ge 3$
uses no $\mathsf{Subsingleton.elim}$: the
$\mathsf{rweq\_transport}$ constructor's proof obligation
($\mathsf{derivation_2\_toEq\_eq}$) is discharged by $\mathsf{rfl}$
(definitional equality).
The formalization relies on the following \emph{Lean kernel
axioms}, which are built into the trusted kernel and cannot be avoided:

\begin{enumerate}[nosep]
  \item \textbf{Propositional extensionality} ($\mathsf{propext}$):
    two propositions with the same truth value are equal.
  \item \textbf{Quotient types} ($\mathsf{Quot}$, $\mathsf{Quot.mk}$,
    $\mathsf{Quot.lift}$, $\mathsf{Quot.sound}$):
    used for $\mathsf{PathRwQuot}$ and the fundamental group quotient.
  \item \textbf{Function extensionality} ($\mathsf{funext}$):
    used in several path congruence proofs.
  \item \textbf{Classical choice} ($\mathsf{Classical.choice}$):
    used in $\mathsf{rweq\_toEq}$ and several noncomputable definitions.
\end{enumerate}

\noindent
The use of $\mathsf{Classical.choice}$ means that certain definitions
(notably $\mathsf{rweq\_toEq}$ and functions built on it) are
\texttt{noncomputable}.
The $\mathsf{Step}$ relation is $\Prop$-valued, so it inherits proof
irrelevance from Lean's kernel---this is essential for the
$\mathsf{step\_eq}$ constructor of $\mathsf{MetaStep}_3$.

% ======================================================================
\section{Related Work}\label{sec:related}
% ======================================================================

\paragraph{The groupoid interpretation.}
Hofmann and Streicher~\cite{HofmannStreicher1998} introduced the
groupoid model of type theory, establishing that $\UIP$ is not
derivable in intensional Martin-L\"of type theory.
Their construction interprets types as groupoids, terms as
functors, and identity proofs as natural isomorphisms.
Our computational-path framework may be viewed as internalizing the
Hofmann--Streicher construction: paths are the morphisms of the
groupoid, $\RwEq$ witnesses are the 2-cells, and the coherence
theorems establish the weak groupoid structure that Hofmann and
Streicher identified semantically.
Warren~\cite{Warren2008} further developed the groupoid model,
establishing the connection between identity types and weak
$\omega$-groupoid structure that Lumsdaine and van den Berg--Garner
later made precise.

\paragraph{Types as weak $\omega$-groupoids.}
Lumsdaine~\cite{Lumsdaine2010} proved that the identity types of
intensional MLTT carry the structure of a weak $\omega$-groupoid.
Van den Berg and Garner~\cite{vdBG2011} established the same result
independently, using a different notion of weak $\omega$-category
(based on Batanin's globular operads~\cite{Batanin1998}).
Our contribution is to obtain an analogous structure in a proof-irrelevant
setting by replacing identity types with computational paths and
deriving contractibility from confluence combined with UIP
(Remark~\ref{rem:rweq-eq-honesty}).
At the 3-cell level, the $\mathsf{rweq\_transport}$ constructor
connects normalized forms via definitionally-equal proofs ($\mathsf{rfl}$),
while Squier-style $\mathsf{diamond\_filler}$ constructors at levels $\ge 4$
connect normalized higher cells across confluence diamonds.
The resulting structure is
genuinely non-degenerate at levels 0--2 but contractible above,
in contrast to the Lumsdaine/vdBG construction which is
non-degenerate at all levels.
Batanin's~\cite{Batanin1998} globular operads and
Leinster's~\cite{Leinster2004} systematic development provide the
categorical framework within which our cell tower
(Definition~\ref{def:cell-tower}) is situated.

\paragraph{Univalent foundations.}
Voevodsky's univalent foundations program, codified in the HoTT
book~\cite{UFP2013}, takes the univalence axiom as foundational.
Our partial univalence result (Theorem~\ref{thm:partial-ua-full})
recovers a fragment of this principle without assuming univalence as
an axiom.
The Cubical Type Theory of Cohen, Coquand, Huber, and
M\"ortberg~\cite{CCHM2018} provides a computational interpretation
of univalence via De Morgan algebras and Kan operations
(see also the simplicial model of Bezem, Coquand, and
Huber~\cite{BezemCoquandHuber2014}); the
relationship between our step-list paths and cubical paths remains
an open question.

\paragraph{Homotopy groups of spheres.}
Brunerie~\cite{Brunerie2016} computed $\pi_4(S^3) \cong
\mathbb{Z}/2\mathbb{Z}$ in HoTT, a landmark result in synthetic
homotopy theory.
His proof relies on the Hopf fibration, James construction, and
Freudenthal suspension theorem---all in an intensional setting with
univalence and higher inductive types.
Our computation of $\pi_1(S^1)$
(Theorem~\ref{thm:pi1-circle}) is far less ambitious in scope but
demonstrates that the encode--decode method can be carried out
within the computational-path framework without univalence.

\paragraph{Covering spaces and van Kampen.}
Favonia and Shulman~\cite{FavoniaShulman2018} formalized the
Seifert--van Kampen theorem in HoTT, including a covering-space
version.
Our Theorem~\ref{thm:svk-full} follows the same encode--decode
strategy but operates within the computational-path quotient
$\mathsf{PathRwQuot}$ rather than the 0-truncation of the identity
type.
Rijke~\cite{Rijke2023} provides a comprehensive textbook account
of synthetic homotopy theory, including descent; our descent
formalization draws on his framework.

\paragraph{Higher-dimensional rewriting and the Squier program.}
Squier~\cite{Squier1994} connected term rewriting to homological
algebra, showing that a finitely presented monoid with solvable word
problem need not have a finite complete rewriting system.
Guiraud and Malbos~\cite{GuiraudMalbos2012} developed this
connection via \emph{polygraphs} (higher-dimensional computads),
showing that a convergent presentation generates a \emph{finite
derivation type} (FDT): the 3-cells needed for coherence arise
precisely from the critical pairs of the rewriting system.
Our framework is a type-theoretic instance of this program.
At the 1-cell level, $\Step$ (which is $\Prop$-valued) provides the
rewrite relation, while $\mathsf{StepStar}$ (the reflexive-transitive
closure, which is $\Ty$-valued) carries explicit computational content
for multi-step reductions.
At the 2-cell level, $\RwEq$ witnesses are homotopies between
rewrite sequences.
At the 3-cell level, $\mathsf{MetaStep}_3.\mathsf{diamond\_filler}$
directly implements Squier's FDT concept: given a local peak
$q \xleftarrow{s_1} p \xrightarrow{s_2} r$ with joining chains
$j_1 : q \to^* m$ and $j_2 : r \to^* m$, the diamond filler provides
the 3-cell witnessing commutativity of the resulting diamond.
The 33 critical pairs of the completed groupoid TRS generate these
3-cells, yielding the ``coherent convergence'' condition of
Guiraud--Malbos.
(The blanket $\mathsf{rweq\_transport}$ constructor provides an alternative
route to contractibility via UIP; see Remark~\ref{rem:rweq-eq-honesty}
for the precise status.)

\paragraph{Computational paths.}
The computational-paths program was initiated by de~Queiroz and
Gabbay~\cite{deQueirozGabbay1994}, who proposed treating
normalization sequences as first-class proof objects.
De~Queiroz, de~Oliveira, and Ramos~\cite{RQGO2016} developed the
LNDEQ equational system, establishing the algebraic laws of
path composition and inversion.
Ramos and de~Queiroz proved that computational paths form a weak
groupoid~\cite{RamosQueiroz2022} and a fundamental
groupoid~\cite{RamosQueiroz2024}.
The present formalization extends this line to machine-checked
proofs at the scale of 1{,}294 files, and develops the theory into
domains (operads, stable homotopy, derived categories, condensed
mathematics) not previously treated in the computational-paths
literature.

\paragraph{Large-scale formalizations.}
Mathlib~\cite{Mathlib2020}, the community Lean~4 mathematics library,
provides extensive coverage of algebra, analysis, topology, and number
theory, but does not formalize proof-relevant rewriting or
$\omega$-groupoid structures.
Our formalization is complementary: where Mathlib emphasizes breadth
across classical mathematics with proof-irrelevant equality, we
develop a single proof-relevant methodology across many domains.
The two libraries share the \Lean\ kernel and could in principle be
integrated, with Mathlib providing the ``classical'' background
(groups, rings, topological spaces) and our library providing the
proof-relevant overlay.

\paragraph{Observational type theory.}
Altenkirch, McBride, and Swierstra~\cite{AltenkirchMcBrideSwierstra2007}
introduced Observational Type Theory (OTT), which achieves a form of
proof relevance by defining equality observationally (by cases on type
formers) rather than inductively.
Our approach is orthogonal: we retain the standard inductive identity
type but record rewrite traces as a parallel structure.
The two approaches share the goal of distinguishing computational
content in equalities while maintaining decidable type-checking.
% ======================================================================
% PART 4: Conclusion, Appendices, Bibliography
% ======================================================================

% ======================================================================
\section{Conclusion and Future Work}\label{sec:conclusion}
% ======================================================================

We have presented a 1{,}294-file, 46{,}000+-declaration, sorry-free
Lean~4 formalization of \emph{computational paths}: a proof-relevant
equality framework in which distinct derivations of the same equation
carry distinguishable computational content.

\subsection{Summary of main results}

The principal contributions are:

\begin{enumerate}[label=(\roman*),nosep]
  \item A \textbf{$\Ty$-valued rewrite equivalence} $\RwEq$ that
    inhabits $\Ty\;u$ rather than $\Prop$, ensuring that coherence
    witnesses cannot be trivialized by $\mathsf{Subsingleton.elim}$.
    This single design decision is the foundation on which all
    subsequent results rest (\S\ref{sec:framework}).

  \item A \textbf{Church--Rosser confluence theorem} for the completed
    13-constructor groupoid TRS, proved via free-group interpretation
    with 7+ explicit critical pair witnesses justifying the Knuth--Bendix
    completion rules (\S\ref{sec:confluence}).

  \item \textbf{Explicit higher coherence}: pentagon, triangle,
    interchange, Mac~Lane fivefold, inverse, double-inverse, and
    contravariance coherences, together with Eckmann--Hilton
    commutativity for 2-cell loops---all constructed as $\Step$ chains
    that record the precise sequence of rewrite rules applied
    (\S\ref{sec:coherence}).

  \item A \textbf{weak $\omega$-groupoid structure} adapted from the
    Batanin--Leinster framework~\cite{Batanin1998,Leinster2004}, with
    genuine non-degeneracy at levels 0--2 and contractible higher
    cells.  Contractibility at dimensions $\ge 3$ is achieved via
    normalization: a real normalization pipeline
    ($\mathsf{IsReduced}$, $\mathsf{normalize}$,
    $\mathsf{to\_normal\_form}_3$) reduces 2-cells to canonical form.
    At level~3, normalized forms are connected via $\mathsf{rweq\_transport}$
    with proof obligations discharged by $\mathsf{rfl}$ (definitional equality).
    At levels~4+, Squier-style $\mathsf{diamond\_filler}$ cells connect
    normalized higher cells.
    This eliminates all uses of $\mathsf{Subsingleton.elim}$ from the
    contractibility proof (Remark~\ref{rem:rweq-eq-honesty})
    (\S\ref{sec:omega}).

  \item A \textbf{strict 2-category instance} with Godement interchange
    and whiskering naturality (\S\ref{sec:twocat}).

  \item A \textbf{Seifert--van Kampen theorem} for pushouts at the
    computational-path level, yielding
    $\pi_1(\mathsf{Pushout}) \simeq \pi_1(A) *_{\pi_1(C)} \pi_1(B)$
    (\S\ref{sec:svk}).

  \item \textbf{Partial univalence} for 1-types, with a precise
    characterization of why full univalence fails in the
    computational-path setting (\S\ref{sec:univalence}).

  \item \textbf{Extensions to 72 mathematical modules}
    (\S\ref{sec:extensions}), of which ${\sim}26$ are FF or PS level,
    with honest formalization status reporting
    distinguishing $\FF$, $\PS$, and SO levels (\S\ref{sec:status}).
\end{enumerate}

\subsection{The key insight}

The central message of this work is that computational paths provide
an \emph{alternative} to HoTT's identity types for proof-relevant
equality.
Where HoTT takes the identity type $\mathsf{Id}_A(a,b)$ as primitive
and derives its higher structure from the type-theoretic rules,
computational paths arise from \emph{rewriting}: the
higher-dimensional structure emerges from the algebra of rewrite steps.
Paths are \emph{concrete} (each carries a list of elementary rewrite
steps), coherence is \emph{constructive} (explicit $\Step$ chains),
the $\omega$-groupoid structure is \emph{derived} (from confluence),
and the framework is \emph{compatible with proof-irrelevant kernels}
(we work inside Lean~4 with UIP on $\Eq$).

\subsection{Future directions}

Several directions for future work present themselves, organized by
increasing ambition.

\paragraph{Full univalence.}
The partial univalence result (\S\ref{sec:univalence}) applies only
to 1-types.
Extending it to higher-truncated types, or finding a suitable
modification of the univalence principle that holds for computational
paths in full generality, is a natural next step.
One approach is to enrich the path syntax with a ``universe step''
constructor that witnesses type equivalences, analogous to the
\texttt{ua} axiom of HoTT~\cite{Voevodsky2010,UFP2013}.

\paragraph{Synthetic homotopy theory via paths.}
The HoTT modules (\S\ref{sec:extensions}) include higher inductive
types, Postnikov towers, and loop space constructions at the
$\PS$ level.
Deepening these to $\FF$ status would yield a synthetic homotopy theory
entirely within the rewriting framework, providing an alternative to
the cubical~\cite{CCHM2018} and simplicial approaches.
The proof of $\pi_1(S^1) \cong \mathbb{Z}$ via computational-path
winding numbers is already complete (\S\ref{subsec:pi1-circle});
remaining targets include a computational-path proof of the Hopf
fibration.

\paragraph{Connection to cubical type theory.}
Cubical type theory~\cite{CCHM2018} provides computational content to
the univalence axiom via De~Morgan algebra operations on the interval.
The step-list representation of computational paths bears a structural
resemblance to cubical paths: both record ``how'' an equality is
derived, not just ``that'' it holds.
A formal comparison---perhaps a translation functor from step-list
paths to cubical paths, preserving the groupoid structure---would
clarify the relationship and potentially allow importing cubical
results into the computational-path setting.

\paragraph{$\infty$-category theory.}
The weak $\omega$-groupoid theorem (\S\ref{sec:omega}) provides
the ``fully invertible'' case.
Extending the framework to non-invertible cells would yield weak
$\omega$-categories, relevant to Lurie's $\infty$-categorical
foundations~\cite{Lurie2009,Lurie2017} and
Riehl--Verity's model-independent $\infty$-category
theory~\cite{RiehlVerity2022}.
The key challenge is defining directed rewrite steps that are not
required to have inverses.

\paragraph{Machine-verified mathematical physics.}
The TFT, cobordism, and Floer homology modules
(\S\ref{sec:extensions}) formalize structures from mathematical
physics at the SO level.
Deepening these to include verified Atiyah--Segal axioms for
topological quantum field theories~\cite{Atiyah1988}, path-level
cobordism composition, and Floer differentials with
$d^2 = 0$ as a $\Step$-chain identity, would provide the first
machine-checked foundations for aspects of mathematical physics.

\paragraph{Higher inductive-inductive types.}
The current formalization treats higher inductive types
(circle, suspension, truncation, pushouts) via interfaces that
postulate their elimination principles.
A direct construction of HITs within the computational-path
framework---where point and path constructors are both primitive
step constructors---would provide a more native treatment and
is related to the quotient inductive-inductive types of
Altenkirch and Kaposi~\cite{AltenkirchKaposi2016}, and could
potentially resolve the known coherence issues with HITs in
intensional type theory.

\paragraph{Syntactic confluence for the full system.}
The Church--Rosser theorem (\S\ref{sec:confluence}) applies to the
13-constructor completed groupoid TRS.
Extending the syntactic confluence proof to the full 77-constructor
$\Step$ system (including type former rules, context rules, and
bicontext rules) remains open.
A semantic confluence argument (via the $\mathsf{toEq}$ projection)
applies, but a syntactic proof would yield a decision procedure for
the rewrite equivalence relation.

\paragraph{Deepening extension modules.}
The SO-level modules (condensed mathematics~\cite{Scholze2019},
Langlands structures, motivic cohomology, $\infty$-categories) provide
mathematical infrastructure.
Deepening selected modules to $\FF$ level---particularly condensed
abelian groups (where the sheaf condition can be expressed as a
$\RwEq$ cocycle identity) and motivic $\mathbb{A}^1$-invariance---is
ongoing work.

\medskip

The computational-paths program demonstrates that proof-relevant
equality need not require abandoning proof-irrelevant foundations.
By recording rewrite traces as first-class data in $\Ty$, we obtain
the full richness of higher-dimensional algebra---groupoids,
coherence, confluence, homotopy---within a conventional proof
assistant.
The 1{,}294-file formalization, with zero uses of \texttt{sorry}
or \texttt{admit}, provides evidence that this approach scales to
substantial mathematics.

% ======================================================================
% APPENDICES
% ======================================================================
\appendix

% ======================================================================
\section{Full List of Step Constructors}\label{app:steps}
% ======================================================================

We list all 77 constructors of the $\Step$ inductive type, organized by
category.
Each entry gives the constructor name, the rule it implements in
mathematical notation, and a brief description.
The notation $p \Rrightarrow q$ means $\Step\;p\;q$.

\subsection*{Category 1: Basic Path Algebra (8 rules)}

These rules form the \emph{core groupoid TRS}, corresponding to the
LNDEQ system of de~Queiroz, de~Oliveira, and
Ramos~\cite{RQGO2016}.

\begin{enumerate}[label=\textbf{R\arabic*},nosep]
  \item \texttt{symm\_refl}:
    $\mathsf{symm}(\refl(a)) \Rrightarrow \refl(a)$
    \hfill (symmetry of reflexivity)

  \item \texttt{symm\_symm}:
    $\mathsf{symm}(\mathsf{symm}(p)) \Rrightarrow p$
    \hfill (double symmetry cancellation)

  \item \texttt{trans\_refl\_left}:
    $\refl(a) \cmpA p \Rrightarrow p$
    \hfill (left identity)

  \item \texttt{trans\_refl\_right}:
    $p \cmpA \refl(b) \Rrightarrow p$
    \hfill (right identity)

  \item \texttt{trans\_symm}:
    $p \cmpA \mathsf{symm}(p) \Rrightarrow \refl(a)$
    \hfill (right inverse)

  \item \texttt{symm\_trans}:
    $\mathsf{symm}(p) \cmpA p \Rrightarrow \refl(b)$
    \hfill (left inverse)

  \item \texttt{symm\_trans\_congr}:
    $\mathsf{symm}(p \cmpA q) \Rrightarrow \mathsf{symm}(q) \cmpA \mathsf{symm}(p)$
    \hfill (contravariance)

  \item \texttt{trans\_assoc}:
    $(p \cmpA q) \cmpA r \Rrightarrow p \cmpA (q \cmpA r)$
    \hfill (associativity)
\end{enumerate}

\subsection*{Category 2: Map Decomposition (1 rule)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=9]
  \item \texttt{map2\_subst}:
    $\mathsf{map2}\;f\;p\;q \Rrightarrow
     \mathsf{mapRight}\;f\;a_1\;q \cmpA \mathsf{mapLeft}\;f\;p\;b_2$
    \hfill (binary map decomposition)
\end{enumerate}

\subsection*{Category 3: Product Types (7 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=10]
  \item \texttt{prod\_fst\_beta}:
    $\mathsf{fst}(\mathsf{mk}(p, q)) \Rrightarrow p$
    \hfill (first projection $\beta$)

  \item \texttt{prod\_snd\_beta}:
    $\mathsf{snd}(\mathsf{mk}(p, q)) \Rrightarrow q$
    \hfill (second projection $\beta$)

  \item \texttt{prod\_rec\_beta}:
    $\mathsf{rec}\;f\;(\mathsf{mk}(p, q)) \Rrightarrow \mathsf{map2}\;f\;p\;q$
    \hfill (product recursor $\beta$)

  \item \texttt{prod\_eta}:
    $\mathsf{mk}(\mathsf{fst}(p),\, \mathsf{snd}(p)) \Rrightarrow p$
    \hfill (product $\eta$-expansion)

  \item \texttt{prod\_mk\_symm}:
    $\mathsf{symm}(\mathsf{mk}(p, q)) \Rrightarrow
     \mathsf{mk}(\mathsf{symm}(p),\, \mathsf{symm}(q))$
    \hfill (symmetry distributes over products)

  \item \texttt{prod\_map\_congrArg}:
    $\mathsf{congrArg}\;(g \times h)\;(\mathsf{mk}(p,q)) \Rrightarrow
     \mathsf{mk}(\mathsf{congrArg}\;g\;p,\, \mathsf{congrArg}\;h\;q)$
    \hfill (componentwise map)
\end{enumerate}

\subsection*{Category 4: Sigma Types (4 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=16]
  \item \texttt{sigma\_fst\_beta}:
    $\pi_1(\mathsf{sigmaMk}(p, q)) \Rrightarrow \mathsf{stepChain}(p.\mathsf{toEq})$
    \hfill (sigma first projection $\beta$)

  \item \texttt{sigma\_snd\_beta}:
    $\pi_2(\mathsf{sigmaMk}(p, q)) \Rrightarrow
     \mathsf{stepChain}(q.\mathsf{toEq})$
    \hfill (sigma second projection $\beta$)

  \item \texttt{sigma\_eta}:
    $\mathsf{sigmaMk}(\mathsf{sigmaFst}(p),\, \mathsf{sigmaSnd}(p))
     \Rrightarrow p$
    \hfill (sigma $\eta$-expansion)

  \item \texttt{sigma\_mk\_symm}:
    $\mathsf{symm}(\mathsf{sigmaMk}(p, q)) \Rrightarrow
     \mathsf{sigmaMk}(\mathsf{symm}(p),\, \mathsf{sigmaSymmSnd}(p,q))$
    \hfill (symmetry distributes over sigma)
\end{enumerate}

\subsection*{Category 5: Sum Types (2 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=20]
  \item \texttt{sum\_rec\_inl\_beta}:
    $\mathsf{rec}\;f\;g\;(\mathsf{inl}(p)) \Rrightarrow
     \mathsf{congrArg}\;f\;p$
    \hfill (left injection $\beta$)

  \item \texttt{sum\_rec\_inr\_beta}:
    $\mathsf{rec}\;f\;g\;(\mathsf{inr}(p)) \Rrightarrow
     \mathsf{congrArg}\;g\;p$
    \hfill (right injection $\beta$)
\end{enumerate}

\subsection*{Category 6: Function Types (3 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=22]
  \item \texttt{fun\_app\_beta}:
    $(\lambda x.\, p\;x)\;a \Rrightarrow p\;a$
    \hfill (function application $\beta$)

  \item \texttt{fun\_eta}:
    $\lambda x.\, \mathsf{app}(p, x) \Rrightarrow p$
    \hfill (function $\eta$-expansion)

  \item \texttt{lam\_congr\_symm}:
    $\mathsf{symm}(\lambda x.\, p\;x) \Rrightarrow
     \lambda x.\, \mathsf{symm}(p\;x)$
    \hfill (symmetry into lambda)
\end{enumerate}

\subsection*{Category 7: Dependent Application (1 rule)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=25]
  \item \texttt{apd\_refl}:
    $\mathsf{apd}\;f\;\refl(a) \Rrightarrow \refl(f\;a)$
    \hfill (dependent application on reflexivity)
\end{enumerate}

\subsection*{Category 8: Transport (7 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=26]
  \item \texttt{transport\_refl\_beta}:
    $\mathsf{transport}\;\refl(a)\;x \Rrightarrow \refl(x)$
    \hfill (transport along reflexivity)

  \item \texttt{transport\_trans\_beta}:
    $\mathsf{transport}\;(p \cmpA q)\;x \Rrightarrow
     \mathsf{transport}\;q\;(\mathsf{transport}\;p\;x)$
    \hfill (transport along composition)

  \item \texttt{transport\_symm\_left\_beta}:
    $\mathsf{transport}\;(\mathsf{symm}\;p)\;
     (\mathsf{transport}\;p\;x) \Rrightarrow x$
    \hfill (left transport inverse)

  \item \texttt{transport\_symm\_right\_beta}:
    $\mathsf{transport}\;p\;
     (\mathsf{transport}\;(\mathsf{symm}\;p)\;y) \Rrightarrow y$
    \hfill (right transport inverse)

  \item \texttt{transport\_sigmaMk\_fst\_beta}:
    $\mathsf{transport}_{\Sigma,1}\;(\mathsf{sigmaMk}\;p\;q)\;x
     \Rrightarrow \mathsf{transport}\;p\;x$
    \hfill (sigma-fst transport)

  \item \texttt{transport\_sigmaMk\_dep\_beta}:
    $\mathsf{transport}_{\Sigma,\mathsf{dep}}\;
     (\mathsf{sigmaMk}\;p\;q)\;x \Rrightarrow
     \mathsf{transportSigma}\;p\;q\;x$
    \hfill (sigma-dependent transport)

  \item \texttt{subst\_sigmaMk\_dep\_beta}:
    $\mathsf{subst}_{\Sigma,\mathsf{dep}}\;
     (\mathsf{sigmaMk}\;p\;q)\;x \Rrightarrow
     \mathsf{substSigma}\;p\;q\;x$
    \hfill (sigma-dependent substitution)
\end{enumerate}

\subsection*{Category 9: Context Rules (16 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=33]
  \item \texttt{context\_congr}:
    $\Step\;p\;q \Rightarrow \Step\;(C[p])\;(C[q])$
    \hfill (context congruence)

  \item \texttt{context\_map\_symm}:
    $\mathsf{symm}(C[p]) \Rrightarrow C[\mathsf{symm}(p)]$
    \hfill (symmetry commutes with context)

  \item \texttt{context\_tt\_cancel\_left}:
    $C[p] \cmpA (C[\mathsf{symm}(p)] \cmpA v) \Rrightarrow
     C[p \cmpA \mathsf{symm}(p)] \cmpA v$
    \hfill (left context cancellation)

  \item \texttt{context\_tt\_cancel\_right}:
    $(v \cmpA C[p]) \cmpA C[\mathsf{symm}(p)] \Rrightarrow
     v \cmpA C[p \cmpA \mathsf{symm}(p)]$
    \hfill (right context cancellation)

  \item \texttt{context\_subst\_left\_beta}:
    $r \cmpA C[p] \Rrightarrow \mathsf{substLeft}\;C\;r\;p$
    \hfill (left substitution $\beta$)

  \item \texttt{context\_subst\_left\_of\_right}:
    $r \cmpA \mathsf{substRight}\;C\;p\;\refl \Rrightarrow
     \mathsf{substLeft}\;C\;r\;p$
    \hfill (left--right substitution relation)

  \item \texttt{context\_subst\_left\_assoc}:
    $\mathsf{substLeft}\;C\;r\;p \cmpA t \Rrightarrow
     r \cmpA \mathsf{substRight}\;C\;p\;t$
    \hfill (left substitution associativity)

  \item \texttt{context\_subst\_right\_beta}:
    $C[p] \cmpA t \Rrightarrow \mathsf{substRight}\;C\;p\;t$
    \hfill (right substitution $\beta$)

  \item \texttt{context\_subst\_right\_assoc}:
    $\mathsf{substRight}\;C\;p\;t \cmpA u \Rrightarrow
     \mathsf{substRight}\;C\;p\;(t \cmpA u)$
    \hfill (right substitution associativity)

  \item \texttt{context\_subst\_left\_refl\_right}:
    $\mathsf{substLeft}\;C\;r\;\refl \Rrightarrow r$
    \hfill (left subst, refl right)

  \item \texttt{context\_subst\_left\_refl\_left}:
    $\mathsf{substLeft}\;C\;\refl\;p \Rrightarrow C[p]$
    \hfill (left subst, refl left)

  \item \texttt{context\_subst\_right\_refl\_left}:
    $\mathsf{substRight}\;C\;\refl\;r \Rrightarrow r$
    \hfill (right subst, refl left)

  \item \texttt{context\_subst\_right\_refl\_right}:
    $\mathsf{substRight}\;C\;p\;\refl \Rrightarrow C[p]$
    \hfill (right subst, refl right)

  \item \texttt{context\_subst\_left\_idempotent}:
    $\mathsf{substLeft}\;C\;(\mathsf{substLeft}\;C\;r\;\refl)\;p
     \Rrightarrow \mathsf{substLeft}\;C\;r\;p$
    \hfill (idempotence)

  \item \texttt{context\_subst\_right\_cancel\_inner}:
    $\mathsf{substRight}\;C\;p\;
     (\mathsf{substRight}\;C\;\refl\;t) \Rrightarrow
     \mathsf{substRight}\;C\;p\;t$
    \hfill (inner cancellation)

  \item \texttt{context\_subst\_right\_cancel\_outer}:
    $\mathsf{substRight}\;C\;\refl\;
     (\mathsf{substRight}\;C\;p\;t) \Rrightarrow
     \mathsf{substRight}\;C\;p\;t$
    \hfill (outer cancellation)
\end{enumerate}

\subsection*{Category 10: Dependent Context Rules (12 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=49]
  \item \texttt{depContext\_congr}:
    $\Step\;p\;q \Rightarrow \Step\;(C_{\mathrm{dep}}[p])\;(C_{\mathrm{dep}}[q])$
    \hfill (dependent context congruence)

  \item \texttt{depContext\_map\_symm}:
    $\mathsf{symm}(C_{\mathrm{dep}}[p]) \Rrightarrow
     C_{\mathrm{dep}}.\mathsf{symmMap}(p)$
    \hfill (dependent symmetry)

  \item \texttt{depContext\_subst\_left\_beta}:
    $\mathsf{transport}(p, r) \cmpA C_{\mathrm{dep}}[p]
     \Rrightarrow \mathsf{depSubstLeft}\;C\;r\;p$
    \hfill (dependent left subst $\beta$)

  \item \texttt{depContext\_subst\_left\_assoc}:
    $\mathsf{depSubstLeft}\;C\;r\;p \cmpA t \Rrightarrow
     \mathsf{transport}(p,r) \cmpA \mathsf{depSubstRight}\;C\;p\;t$
    \hfill (dependent left subst assoc)

  \item \texttt{depContext\_subst\_right\_beta}:
    $C_{\mathrm{dep}}[p] \cmpA t \Rrightarrow
     \mathsf{depSubstRight}\;C\;p\;t$
    \hfill (dependent right subst $\beta$)

  \item \texttt{depContext\_subst\_right\_assoc}:
    $\mathsf{depSubstRight}\;C\;p\;t \cmpA u \Rrightarrow
     \mathsf{depSubstRight}\;C\;p\;(t \cmpA u)$
    \hfill (dependent right subst assoc)

  \item \texttt{depContext\_subst\_left\_refl\_right}:
    $\mathsf{depSubstLeft}\;C\;r\;\refl \Rrightarrow r$

  \item \texttt{depContext\_subst\_left\_refl\_left}:
    $\mathsf{depSubstLeft}\;C\;\refl\;p \Rrightarrow C_{\mathrm{dep}}[p]$

  \item \texttt{depContext\_subst\_right\_refl\_left}:
    $\mathsf{depSubstRight}\;C\;\refl\;r \Rrightarrow r$

  \item \texttt{depContext\_subst\_right\_refl\_right}:
    $\mathsf{depSubstRight}\;C\;p\;\refl \Rrightarrow C_{\mathrm{dep}}[p]$

  \item \texttt{depContext\_subst\_left\_idempotent}:
    nested left subst with refl simplifies
    \hfill (idempotence)

  \item \texttt{depContext\_subst\_right\_cancel\_inner}:
    nested right subst with refl simplifies
    \hfill (inner cancellation)
\end{enumerate}

\subsection*{Category 11: Bicontext and Dependent Bicontext Congruences (8 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=61]
  \item \texttt{depBiContext\_mapLeft\_congr}:
    $\Step\;p\;q \Rightarrow
     \Step\;(K_{\mathrm{dep}}.\mathsf{mapLeft}\;p\;b)\;
     (K_{\mathrm{dep}}.\mathsf{mapLeft}\;q\;b)$

  \item \texttt{depBiContext\_mapRight\_congr}:
    $\Step\;p\;q \Rightarrow
     \Step\;(K_{\mathrm{dep}}.\mathsf{mapRight}\;a\;p)\;
     (K_{\mathrm{dep}}.\mathsf{mapRight}\;a\;q)$

  \item \texttt{depBiContext\_map2\_congr\_left}:
    $\Step\;p\;q \Rightarrow
     \Step\;(K_{\mathrm{dep}}.\mathsf{map2}\;p\;r)\;
     (K_{\mathrm{dep}}.\mathsf{map2}\;q\;r)$

  \item \texttt{depBiContext\_map2\_congr\_right}:
    $\Step\;q\;r \Rightarrow
     \Step\;(K_{\mathrm{dep}}.\mathsf{map2}\;p\;q)\;
     (K_{\mathrm{dep}}.\mathsf{map2}\;p\;r)$

  \item \texttt{biContext\_mapLeft\_congr}:
    $\Step\;p\;q \Rightarrow
     \Step\;(K.\mathsf{mapLeft}\;p\;b)\;(K.\mathsf{mapLeft}\;q\;b)$

  \item \texttt{biContext\_mapRight\_congr}:
    $\Step\;p\;q \Rightarrow
     \Step\;(K.\mathsf{mapRight}\;a\;p)\;(K.\mathsf{mapRight}\;a\;q)$

  \item \texttt{biContext\_map2\_congr\_left}:
    $\Step\;p\;q \Rightarrow
     \Step\;(K.\mathsf{map2}\;p\;r)\;(K.\mathsf{map2}\;q\;r)$

  \item \texttt{biContext\_map2\_congr\_right}:
    $\Step\;q\;r \Rightarrow
     \Step\;(K.\mathsf{map2}\;p\;q)\;(K.\mathsf{map2}\;p\;r)$
\end{enumerate}

\subsection*{Category 12: Mapping Congruences (4 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=69]
  \item \texttt{mapLeft\_congr}:
    $\Step\;p\;q \Rightarrow
     \Step\;(\mathsf{mapLeft}\;f\;p\;b)\;(\mathsf{mapLeft}\;f\;q\;b)$

  \item \texttt{mapRight\_congr}:
    $\Step\;p\;q \Rightarrow
     \Step\;(\mathsf{mapRight}\;f\;a\;p)\;(\mathsf{mapRight}\;f\;a\;q)$

  \item \texttt{mapLeft\_ofEq}:
    $\mathsf{mapLeft}\;f\;(\mathsf{stepChain}\;h)\;b \Rrightarrow
     \mathsf{stepChain}(\mathsf{congrArg}\;(\lambda x.\, f\;x\;b)\;h)$

  \item \texttt{mapRight\_ofEq}:
    $\mathsf{mapRight}\;f\;a\;(\mathsf{stepChain}\;h) \Rrightarrow
     \mathsf{stepChain}(\mathsf{congrArg}\;(f\;a)\;h)$
\end{enumerate}

\subsection*{Category 13: Congruence Closure (3 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=73]
  \item \texttt{symm\_congr}:
    $\Step\;p\;q \Rightarrow
     \Step\;(\mathsf{symm}\;p)\;(\mathsf{symm}\;q)$
    \hfill (symmetry congruence)

  \item \texttt{trans\_congr\_left}:
    $\Step\;p\;q \Rightarrow
     \Step\;(p \cmpA r)\;(q \cmpA r)$
    \hfill (left composition congruence)

  \item \texttt{trans\_congr\_right}:
    $\Step\;q\;r \Rightarrow
     \Step\;(p \cmpA q)\;(p \cmpA r)$
    \hfill (right composition congruence)
\end{enumerate}

\subsection*{Category 14: Knuth--Bendix Completion (2 rules)}

\begin{enumerate}[label=\textbf{R\arabic*},nosep,start=76]
  \item \texttt{trans\_cancel\_left}:
    $p \cmpA (\mathsf{symm}(p) \cmpA q) \Rrightarrow q$
    \hfill (left cancellation)

  \item \texttt{trans\_cancel\_right}:
    $\mathsf{symm}(p) \cmpA (p \cmpA q) \Rrightarrow q$
    \hfill (right cancellation)
\end{enumerate}

\medskip
\noindent
\textbf{Total: 77 constructors} across 14 categories.
The labeling R1--R77 follows the order of declaration in the
\texttt{Step} inductive type.
Constructors R1--R8 form the core groupoid TRS; R76--R77 are the
Knuth--Bendix completion rules that close critical pairs
(see~\S\ref{sec:confluence}); R73--R75 provide congruence closure
enabling step application under $\mathsf{symm}$ and $\trs$
constructors.

\begin{remark}
Rules R76--R77 are the Knuth--Bendix completion rules that close
critical pairs (see~\S\ref{sec:confluence}); R73--R75 provide
congruence closure enabling step application under $\mathsf{symm}$
and $\trs$ constructors.
\end{remark}

% ======================================================================
\section{Module Index}\label{app:modules}\label{sec:extensions}

The formalization comprises 1,294 source files organized into 72
top-level modules.
Of these, 4~modules (core path infrastructure and coherence) are
\FF\ (Fully Formalized), 22~modules (category theory, algebraic topology,
homological algebra, selected HoTT and sheaf-theoretic constructions) are
\PS\ (Partially Structured), and 46~modules (algebraic geometry, number
theory, condensed mathematics, mathematical physics, motivic theory,
representation theory) are SO (Statement Only).
The SO-level modules provide type-checked definitions and theorem
statements that serve as infrastructure for future development; they do
not constitute substantive mathematical verification of the domains
they cover.
The complete module listing with per-file status is available in the
source repository.

\begin{thebibliography}{99}

\bibitem{AltenkirchMcBrideSwierstra2007}
T.~Altenkirch, C.~McBride, and W.~Swierstra.
\newblock Observational equality, now!
\newblock In \emph{Proceedings of the ACM Workshop on Programming Languages
  meets Program Verification (PLPV)}, pages 57--68, 2007.

\bibitem{Atiyah1988}
M.~F. Atiyah.
\newblock Topological quantum field theories.
\newblock \emph{Institut des Hautes \'Etudes Scientifiques. Publications
  Math\'ematiques}, 68:175--186, 1988.

\bibitem{Batanin1998}
M.~A. Batanin.
\newblock Monoidal globular categories as a natural environment for the theory
  of weak $n$-categories.
\newblock \emph{Advances in Mathematics}, 136(1):39--103, 1998.

\bibitem{Brunerie2016}
G.~Brunerie.
\newblock On the homotopy groups of spheres in homotopy type theory.
\newblock PhD thesis, Universit\'e de Nice Sophia Antipolis, 2016.
\newblock arXiv:1606.05916.

\bibitem{CCHM2018}
C.~Cohen, T.~Coquand, S.~Huber, and A.~M\"ortberg.
\newblock Cubical type theory: a constructive interpretation of the univalence
  axiom.
\newblock \emph{Journal of Automated Reasoning}, 60(2):199--241, 2018.

\bibitem{Connes1994}
A.~Connes.
\newblock \emph{Noncommutative Geometry}.
\newblock Academic Press, San Diego, 1994.

\bibitem{deQueirozGabbay1994}
R.~J.~G.~B. de~Queiroz and D.~M. Gabbay.
\newblock Equality in labelled deductive systems and the functional
  interpretation of propositional equality.
\newblock In P.~Dekker and M.~Stokhof, editors, \emph{Proceedings of the 9th
  Amsterdam Colloquium}, pages 547--565. ILLC, University of Amsterdam, 1994.

\bibitem{RQGO2016}
R.~J.~G.~B. de~Queiroz, A.~G. de~Oliveira, and A.~F. Ramos.
\newblock Propositional equality, identity types, and direct computational
  paths.
\newblock \emph{South American Journal of Logic}, 2(2):245--296, 2016.

\bibitem{FavoniaShulman2018}
K.-B.~Hou (Favonia) and M.~Shulman.
\newblock The Seifert--van Kampen theorem in homotopy type theory.
\newblock In \emph{27th EACSL Annual Conference on Computer Science Logic
  (CSL)}, volume 119 of \emph{LIPIcs}, pages 22:1--22:16, 2018.

\bibitem{GuiraudMalbos2012}
Y.~Guiraud and P.~Malbos.
\newblock Higher-dimensional normalisation strategies for acyclicity.
\newblock \emph{Advances in Mathematics}, 231(3--4):2294--2351, 2012.

\bibitem{HofmannStreicher1998}
M.~Hofmann and T.~Streicher.
\newblock The groupoid interpretation of type theory.
\newblock In G.~Sambin and J.~M. Smith, editors, \emph{Twenty-Five Years of
  Constructive Type Theory}, Oxford Logic Guides~36, pages 83--111.
  Oxford University Press, 1998.

\bibitem{Joyal2002}
A.~Joyal.
\newblock Quasi-categories and Kan complexes.
\newblock \emph{Journal of Pure and Applied Algebra}, 175(1--3):207--222, 2002.

\bibitem{Leinster2004}
T.~Leinster.
\newblock \emph{Higher Operads, Higher Categories}.
\newblock London Mathematical Society Lecture Note Series~298.
\newblock Cambridge University Press, 2004.

\bibitem{LodayVallette2012}
J.-L. Loday and B.~Vallette.
\newblock \emph{Algebraic Operads}.
\newblock Grundlehren der mathematischen Wissenschaften~346.
\newblock Springer, Berlin, 2012.

\bibitem{Lumsdaine2010}
P.~L. Lumsdaine.
\newblock Weak $\omega$-categories from intensional type theory.
\newblock \emph{Logical Methods in Computer Science}, 6(3:24):1--19, 2010.

\bibitem{Lurie2009}
J.~Lurie.
\newblock \emph{Higher Topos Theory}.
\newblock Annals of Mathematics Studies~170.
\newblock Princeton University Press, 2009.

\bibitem{Lurie2017}
J.~Lurie.
\newblock \emph{Higher Algebra}.
\newblock Preprint, available at \url{https://www.math.ias.edu/~lurie/papers/HA.pdf}, 2017.

\bibitem{MacLane1963}
S.~Mac~Lane.
\newblock Natural associativity and commutativity.
\newblock \emph{Rice University Studies}, 49(4):28--46, 1963.

\bibitem{MacLane1998}
S.~Mac~Lane.
\newblock \emph{Categories for the Working Mathematician}.
\newblock Graduate Texts in Mathematics~5.
\newblock Springer, New York, second edition, 1998.

\bibitem{Mathlib2020}
The mathlib Community.
\newblock The {Lean} mathematical library.
\newblock In \emph{Proceedings of the 9th ACM SIGPLAN International Conference
  on Certified Programs and Proofs (CPP)}, pages 367--381. ACM, 2020.

\bibitem{May1972}
J.~P. May.
\newblock \emph{The Geometry of Iterated Loop Spaces}.
\newblock Lecture Notes in Mathematics~271.
\newblock Springer, Berlin, 1972.

\bibitem{MilnorStasheff1974}
J.~W. Milnor and J.~D. Stasheff.
\newblock \emph{Characteristic Classes}.
\newblock Annals of Mathematics Studies~76.
\newblock Princeton University Press, 1974.

\bibitem{Moura2021}
L.~de~Moura, S.~Kong, J.~Avigad, F.~van~Doorn, and M.~von~Raumer.
\newblock The {Lean~4} theorem prover and programming language.
\newblock In \emph{Automated Deduction -- CADE~28}, volume 12699 of
  \emph{LNAI}, pages 625--635. Springer, 2021.

\bibitem{RamosQueirozOliveira2017}
A.~F. Ramos, R.~J.~G.~B. de~Queiroz, and A.~G. de~Oliveira.
\newblock On the identity type as the type of computational paths.
\newblock \emph{Logic Journal of the IGPL}, 25(4):562--584, 2017.

\bibitem{RamosEtAl2018}
A.~F. Ramos, R.~J.~G.~B. de~Queiroz, A.~G. de~Oliveira, and
  M.~R.~F. Benevides.
\newblock Explicit computational paths.
\newblock \emph{South American Journal of Logic}, 4(2):441--484, 2018.

\bibitem{RamosQueiroz2022}
A.~Ramos and R.~J.~G.~B. de~Queiroz.
\newblock Computational paths --- a weak groupoid.
\newblock \emph{Journal of Logic and Computation}, 32(3):489--526, 2022.

\bibitem{RamosQueiroz2024}
A.~Ramos and R.~J.~G.~B. de~Queiroz.
\newblock Computational paths and the fundamental groupoid of a type.
\newblock \emph{Logical Methods in Computer Science}, 20(2):6:1--6:36, 2024.

\bibitem{RiehlVerity2022}
E.~Riehl and D.~Verity.
\newblock \emph{Elements of $\infty$-Category Theory}.
\newblock Cambridge Studies in Advanced Mathematics~194.
\newblock Cambridge University Press, 2022.

\bibitem{Rijke2023}
E.~Rijke.
\newblock \emph{Introduction to Homotopy Type Theory}.
\newblock Cambridge Studies in Advanced Mathematics.
\newblock Cambridge University Press, 2023.
\newblock arXiv:2212.11082.

\bibitem{Scholze2019}
P.~Scholze.
\newblock Lectures on condensed mathematics.
\newblock Lecture notes, University of Bonn, 2019.
\newblock Available at \url{https://www.math.uni-bonn.de/people/scholze/Condensed.pdf}.

\bibitem{Serre1951}
J.-P. Serre.
\newblock Homologie singuli\`ere des espaces fibr\'es.
\newblock \emph{Annals of Mathematics}, 54(3):425--505, 1951.

\bibitem{Squier1987}
C.~C. Squier.
\newblock Word problems and a homological finiteness condition for monoids.
\newblock \emph{Journal of Pure and Applied Algebra}, 49(1--2):201--217, 1987.

\bibitem{Squier1994}
C.~C. Squier.
\newblock A finiteness condition for rewriting systems.
\newblock \emph{Theoretical Computer Science}, 131(2):271--294, 1994.

\bibitem{Stasheff1963}
J.~D. Stasheff.
\newblock Homotopy associativity of {$H$}-spaces. {I}, {II}.
\newblock \emph{Transactions of the American Mathematical Society},
  108:275--292 and 293--312, 1963.

\bibitem{UFP2013}
The {Univalent Foundations Program}.
\newblock \emph{Homotopy Type Theory: Univalent Foundations of Mathematics}.
\newblock Institute for Advanced Study, Princeton, 2013.
\newblock Available at \url{https://homotopytypetheory.org/book/}.

\bibitem{vdBG2011}
B.~van~den Berg and R.~Garner.
\newblock Types are weak $\omega$-groupoids.
\newblock \emph{Proceedings of the London Mathematical Society},
  102(2):370--394, 2011.

\bibitem{Voevodsky2010}
V.~Voevodsky.
\newblock Univalent foundations.
\newblock Lecture at the Institute for Advanced Study, Princeton, 2010.
\newblock Notes available at \url{https://www.math.ias.edu/vladimir/sites/math.ias.edu.vladimir/files/Univalent_Foundations_Lecture.pdf}.

\bibitem{Warren2008}
M.~A. Warren.
\newblock \emph{Homotopy Theoretic Aspects of Constructive Type Theory}.
\newblock PhD thesis, Carnegie Mellon University, 2008.

\bibitem{AltenkirchKaposi2016}
T.~Altenkirch and A.~Kaposi.
\newblock Type theory in type theory using quotient inductive types.
\newblock In \emph{Proceedings of the 43rd Annual ACM SIGPLAN-SIGACT
  Symposium on Principles of Programming Languages (POPL)}, pages 18--29. ACM, 2016.

\bibitem{KrausVonRaumer2019}
N.~Kraus and J.~von~Raumer.
\newblock Coherence via well-foundedness: taming set-quotients in homotopy
  type theory.
\newblock In \emph{Proceedings of the 34th Annual ACM/IEEE Symposium on
  Logic in Computer Science (LICS)}, pages 1--13. IEEE, 2019.

\bibitem{BezemCoquandHuber2014}
M.~Bezem, T.~Coquand, and S.~Huber.
\newblock A model of type theory in cubical sets.
\newblock In \emph{19th International Conference on Types for Proofs
  and Programs (TYPES 2013)}, volume~26 of \emph{LIPIcs},
  pages 107--128. Schloss Dagstuhl, 2014.

\bibitem{North2019}
P.~R. North.
\newblock Type-theoretic weak factorization systems.
\newblock \emph{Mathematical Structures in Computer Science}, 29(5):736--756, 2019.
\newblock arXiv:1906.00259.

\bibitem{BaaderNipkow1998}
F.~Baader and T.~Nipkow.
\newblock \emph{Term Rewriting and All That}.
\newblock Cambridge University Press, 1998.

\bibitem{KnuthBendix1970}
D.~E. Knuth and P.~B. Bendix.
\newblock Simple word problems in universal algebras.
\newblock In J.~Leech, editor, \emph{Computational Problems in Abstract
  Algebra}, pages 263--297. Pergamon Press, 1970.

\bibitem{repo}
A.~F. Ramos.
\newblock Computational Paths in Lean~4: source code.
\newblock \url{https://github.com/Arthur742Ramos/ComputationalPathsLean}, 2026.

\bibitem{Weibel1994}
C.~A. Weibel.
\newblock \emph{An Introduction to Homological Algebra}.
\newblock Cambridge Studies in Advanced Mathematics~38.
\newblock Cambridge University Press, 1994.

\end{thebibliography}

\bigskip
\noindent\textsc{Arthur Freitas Ramos}\\
\textit{Microsoft}\\
\textit{E-mail}: \texttt{arfreita@microsoft.com}

\medskip
\noindent\textsc{Ruy J.G.B. de Queiroz}\\
\textit{Center for Informatics (CIn), Universidade Federal de Pernambuco (UFPE)}\\
\textit{E-mail}: \texttt{ruy@cin.ufpe.br}

\medskip
\noindent\textsc{Anjolina G. de Oliveira}\\
\textit{Center for Informatics (CIn), Universidade Federal de Pernambuco (UFPE)}\\
\textit{E-mail}: \texttt{ago@cin.ufpe.br}

\end{document}
